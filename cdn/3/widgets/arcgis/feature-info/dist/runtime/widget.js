System.register(["jimu-core","jimu-arcgis","jimu-ui"],(function(e,t){var a={},i={},s={};return{setters:[function(e){a.AllDataSourceTypes=e.AllDataSourceTypes,a.BaseVersionManager=e.BaseVersionManager,a.CONSTANTS=e.CONSTANTS,a.ClauseLogic=e.ClauseLogic,a.ClauseOperator=e.ClauseOperator,a.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.Immutable=e.Immutable,a.JSAPILayerTypes=e.JSAPILayerTypes,a.MessageManager=e.MessageManager,a.React=e.React,a.ReactResizeDetector=e.ReactResizeDetector,a.appConfigUtils=e.appConfigUtils,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.esri=e.esri,a.getAppStore=e.getAppStore,a.jsx=e.jsx,a.lodash=e.lodash,a.uuidv1=e.uuidv1},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent,i.MapViewManager=e.MapViewManager,i.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){s.Alert=e.Alert,s.Button=e.Button,s.DataActionList=e.DataActionList,s.DataActionListStyle=e.DataActionListStyle,s.DistanceUnits=e.DistanceUnits,s.Dropdown=e.Dropdown,s.DropdownButton=e.DropdownButton,s.DropdownItem=e.DropdownItem,s.DropdownMenu=e.DropdownMenu,s.WidgetPlaceholder=e.WidgetPlaceholder,s.defaultMessages=e.defaultMessages}],execute:function(){e((()=>{var e={4583:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path fill="#000" fill-rule="evenodd" d="M0 12v-1.5h1V12h1.5v1H1a1 1 0 0 1-1-1M1 1h1.5v1H1v1.5H0V2a1 1 0 0 1 1-1m0 7.5H0v-3h1zM4.5 2V1h3v1zm5 0V1H11a1 1 0 0 1 1 1v1.5h-1V2zm4.813 14.02-3.535-3.535-3.536 3.535-.707-.707 3.536-3.535-3.536-3.536.707-.707 3.536 3.536 3.535-3.536.707.707-3.535 3.536 3.535 3.535z" clip-rule="evenodd"></path></svg>'},6821:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M8.5 4a.5.5 0 0 0 0 1h8a.5.5 0 0 0 0-1zM8.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1zM8 10.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5M3.5 10a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1zM4 7.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5M3.5 4a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1zM4 15.5 6 14v3zM16 15.5 14 14v3z"></path><path fill="#000" fill-rule="evenodd" d="M20 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2zM2 1h16a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=s},62686:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=a}},t={};function o(a){var i=t[a];if(void 0!==i)return i.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,o),s.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var r={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(r),o.d(r,{__set_webpack_public_path__:()=>O,default:()=>B});var e,t,a=o(79244),i=o(62686),s=o(14321);function n(e,i,s,o,r){let n;const u=s.backgroundColor?s.backgroundColor:e.sys.color.surface.paper;let d;const l="";let c,h,p=l,g=l,f=l,S=l,v=l,D=l;"custom"===i?(n=s.textColor?s.textColor:e.ref.palette.neutral[1200],d=s.fontSize,d&&0!==d.distance&&s.fontSizeType!==t.auto&&(c=d.unit,h=d.distance,p=h+c,g=Math.round(1.428*h)+c,f=Math.round(1.142*h)+c,S=h,v=Math.round(.857*h)+c,D=Math.round(.857*h)+c)):"syncWithTheme"===i?(h=l,n=e.ref.palette.neutral[1200]):(h=l,n="");let m="10px",y="auto";return o&&(m="auto",y="10px"),a.css`
    .widget-featureInfo{
      overflow: auto;
      word-break: break-word;
      min-width: min-content;
      min-height: 53px;
      ${r?"width: max-content":""};
      height: 100%;
      background-color: ${u};
      color: ${n};
      --calcite-color-text-1: ${n};
      --calcite-color-text-3: ${n};
      font-size: ${p};
      --calcite-font-size--0: ${p};
      --calcite-font-size--1: ${p};
      --calcite-font-size--2: ${p};
      --calcite-color-foreground-1: ${u};

      .warning-icon{
        position: absolute;
        bottom: 10px;
        right: ${m};
        left: ${y};
      }
      .warning-inaccessible{
        position: absolute;
        left: 0.25rem;
        right: 0.25rem;
        bottom: 0.25rem;
        width: auto;
      }
      .header-section{
        min-width: max-content;
        display: flex;
        justify-content: space-between;
        height: 40px;
        border-bottom: 1px solid #a8a8a8;
        background-color: ${u};
      }
      .header-control-section{
        display: flex;
        justify-content: flex-end;
        align-items: center;
        height: 40px;
        flex-grow: 2;
        margin: 0 10px;
        /*
        position: absolute;
        right: 0;
        */
      }
      .data-action-dropdown-content{
      }
      .nav-section{
        height: 40px;
        background-color: transparent;
        color: ${e.ref.palette.neutral[1200]};
        .nav-btn{
          margin: 0 5px;
          color: ${e.sys.color.primary.main};
        }
        .nav-btn: hover{
          color: ${e.sys.color.primary.light};
        }
        .nav-btn: disabled{
          color: ${e.sys.color.action.disabled.text};
        }
        .nav-btn:focus{
          box-shadow: none;
        }
      }
      .feature-info-component{
        background-color: ${"transparent"};
        padding: 4px;
        .esri-feature__size-container{
          background-color: ${u};
          color: ${n};
        }
        .esri-widget * {
          font-size: ${p};
          color: ${n} !important;
        }
        .esri-widget {
          background-color: transparent !important;
        }
        .esri-feature__title{
          padding: 10px 7px 0 7px;
          margin: auto;
        }
        .esri-widget__heading {
          margin: 0 0 0.5rem 0;
        }
        .esri-feature__content-element{
          padding-top: 7px;
        }
        .esri-widget__table tr td, .esri-widget__table tr th {
          font-size: ${D};
          word-break: break-word !important;
        }
        .esri-feature__main-container{
        }
        .esri-feature__media-previous:focus{
          outline: none;
        }
        .esri-feature__media-next:focus{
          outline: none;
        }
        .esri-feature__title {
          font-size: ${p};
        }
        .esri-feature h1 {
          font-size: ${g};
        }
        .esri-feature h2 {
          font-size: ${f};
        }
        .esri-feature h3,
        .esri-feature h4,
        .esri-feature h5,
        .esri-feature h6 {
          font-size: ${S};
        }
        .esri-feature p {
          font-size: ${p};
        }

        .esri-feature-content {
          padding: 0 15px;
        }
        .esri-feature-content p {
          margin: 0 0 1.2em
        }

        .esri-feature-content a[href] {
          text-decoration-line: underline;
        }

        .esri-feature figcaption {
          font-size: ${D};
        }

        .esri-feature__media-item-title {
          font-size: ${f};
        }
        .esri-feature__media-item-caption {
          font-size: ${v};
        }
        .esri-feature__last-edited-info {
          font-size: ${D};
        }
        .esri-widget__table tr td, .esri-widget__table tr th {
          word-break: normal;
        }

      }
    }
  `}!function(e){e.syncWithTheme="syncWithTheme",e.usePopupDefined="usePopupDefined",e.custom="custom"}(e||(e={})),function(e){e.auto="auto",e.custom="custom"}(t||(t={}));const u="Feature Info",d="No data found.",l="{index} of {count}",c="{layer} feature info current record";var h;!function(e){e.Pending="Pending",e.Fulfilled="Fulfilled",e.Rejected="Rejected"}(h||(h={}));class p extends a.React.PureComponent{constructor(e){super(e),this.featureContainerRef=a.React.createRef(),this.state={loadStatus:h.Pending}}componentDidMount(){this.createFeature()}componentDidUpdate(e){if(this.features){this.updateDataSource(e);const t={popupTemplate:{content:""}},a=this.props.graphic?[this.props.graphic]:[t];this.updateGraphic(e,a),this.features.timeZone=this.getTimezone(),this.updateVisibleElementsContent(a)}}updateGraphic(e,t){var a,i,s,o,r,n,u,d,l,c,h;let p=(null===(a=this.props.graphic)||void 0===a?void 0:a.popupTemplate)||(null===(s=null===(i=this.props.graphic)||void 0===i?void 0:i.layer)||void 0===s?void 0:s.popupTemplate);p||(null===(r=null===(o=this.props.graphic)||void 0===o?void 0:o.layer)||void 0===r||(r.popupTemplate=this.props.defaultPopupTemplate),p=null===(u=null===(n=this.props.graphic)||void 0===n?void 0:n.layer)||void 0===u?void 0:u.popupTemplate);const g=this.isOutputDSFromChart();null===(d=null==p?void 0:p.fieldInfos)||void 0===d||d.forEach((e=>{var t,a,i,s,o;const r=null===(o=null===(s=null===(i=null===(a=null===(t=this.props.graphic)||void 0===t?void 0:t.layer)||void 0===a?void 0:a.fields)||void 0===i?void 0:i.find((t=>t.name===e.fieldName)))||void 0===s?void 0:s.toJSON())||void 0===o?void 0:o.type;r&&"esriFieldTypeTimestampOffset"===r?e.visible=!1:g&&(e.visible=!0)})),void 0!==(null===(l=this.props.graphic)||void 0===l?void 0:l.uid)&&(null===(c=this.props.graphic)||void 0===c?void 0:c.uid)===(null===(h=e.graphic)||void 0===h?void 0:h.uid)||setTimeout((()=>{this.features.features=t}),1)}updateDataSource(e){var t,a;const i=this.props.dataSource.getRootDataSource(),s=this.getViewByDataSourceId(null==i?void 0:i.id);this.features.spatialReference=(null==s?void 0:s.spatialReference)||(null===(a=null===(t=this.props.graphic)||void 0===t?void 0:t.layer)||void 0===a?void 0:a.spatialReference)||null,this.features.map=(null==i?void 0:i.map)||null,this.props.useMapWidget&&(this.features.view=s||null)}updateVisibleElementsContent(e){const t={actionBar:!1,closeButton:!1,heading:this.props.visibleElements.title};this.features.visibleElements=t;const a=this.features.viewModel.featureViewModelAbilities,i=this.props.visibleElements.content;if((null==a?void 0:a.attachmentsContent)!==i.attachments||(null==a?void 0:a.customContent)!==i.text||(null==a?void 0:a.fieldsContent)!==i.fields||(null==a?void 0:a.mediaContent)!==i.media||(null==a?void 0:a.textContent)!==i.text){const t={attachmentsContent:i.attachments,customContent:i.text,fieldsContent:i.fields,mediaContent:i.media,textContent:i.text};this.features.viewModel.featureViewModelAbilities=t,this.features.features=e}}getTimezone(){var e;return a.dataSourceUtils.getTimezoneAPIFromRuntime(null===(e=this.props.dataSource)||void 0===e?void 0:e.getTimezone())}isOutputDSFromChart(){var e;const t=null===(e=this.props.dataSource)||void 0===e?void 0:e.getDataSourceJson();return t.isOutputFromWidget&&t.schema}destroyFeature(){this.features&&!this.features.destroyed&&this.features.destroy()}getViewByDataSourceId(e){const t=i.MapViewManager.getInstance().getAllJimuMapViews().find((t=>t.dataSourceId===e));return(null==t?void 0:t.view)||null}createFeature(){let e;return e=this.Features?Promise.resolve():(0,i.loadArcGISJSAPIModules)(["esri/widgets/Features"]).then((e=>{[this.Features]=e})),e.then((()=>{this.destroyFeature(),this.features=new this.Features({container:this.featureContainerRef.current,visible:!0,features:[this.props.graphic],defaultPopupTemplateEnabled:!0,timeZone:this.props.timeZone,visibleElements:{actionBar:!1,closeButton:!1}})})).then((()=>{this.setState({loadStatus:h.Fulfilled})}))}render(){return a.React.createElement("div",{className:"feature-info-component"},a.React.createElement("div",{id:"features-container",role:"document",tabIndex:0,ref:this.featureContainerRef}))}}var g=function(e,t,a,i){return new(a||(a=Promise))((function(s,o){function r(e){try{u(i.next(e))}catch(e){o(e)}}function n(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,n)}u((i=i.apply(e,t||[])).next())}))};class f extends a.React.PureComponent{constructor(e){super(e),this.countOfQueryGraphics=0,this.initDataLoader=()=>{this.previousIndex=0,this.previousData={id:null,count:-1,index:null,graphic:null,record:null,defaultPopupTemplate:null,dataSourceVersion:void 0,dataSourceId:null},this.dataBuffer={count:-1,dataMapByIndex:{},dataMapByObjectId:{},pagingNum:30},this.isFirstLoad=!1,this.previousSelectedId=null},this.getCurrentData=()=>{const e=this.props.objectId,t=this.getDataFromBuffer(this.props.index,e);t?this.onDataChanged(this.dataSource,t):e?this.getCurrentDataByObjectId(e):this.getCurrentDataByIndex()},this.getCurrentDataByObjectId=e=>{let t=null;this.queryGraphicByObjectId(e).then((a=>{0!==a.graphics.length&&(this.addObjectIdDataToBuffer(a,this.dataSource.id),t=this.getDataFromBuffer(-1,e)),this.onDataChanged(this.dataSource,t)}))},this.getCurrentDataByIndex=()=>g(this,void 0,void 0,(function*(){let e=this.props.index;this.props.index===this.previousIndex?this.clearDataBuffer():this.previousIndex=this.props.index,this.countOfQueryGraphics++;const t=this.countOfQueryGraphics,a=this.props.needCountInfo?this.dataSource.queryCount({}):Promise.resolve({count:-1});yield a.then((a=>{if(t<this.countOfQueryGraphics)return;const i=a.count;this.dataBuffer.count<0&&this.setDataBufferCount(i),e<0&&(e=0),this.queryGraphicByIndex(e).then((e=>{if(t<this.countOfQueryGraphics)return;let a=null;0!==e.graphics.length&&(this.addIndexDataToBuffer(e,this.dataSource.id),a=this.getDataFromBuffer(e.index)),this.onDataChanged(this.dataSource,a),this.isFirstLoad=!1}))}))})),this.onDataSourceStatusChanged=(e,t)=>{this.props.active&&this.props.onDataSourceStatusChanged(e,t)},this.getWherePhraseForField=(e,t)=>{var i;let s="";const o=(this.dataSource.getFetchedSchema().fields||{})[t].esriType;if("esriFieldTypeDate"===o){const o=a.dataSourceUtils.createSQLClause(t,a.ClauseOperator.DateOperatorIsBefore,[{value:e.attributes[t],label:""}]),r=(null===(i=a.dataSourceUtils.createSQLExpression(a.ClauseLogic.Or,[o],this.dataSource))||void 0===i?void 0:i.sql)||"";s=r.slice(r.indexOf("timestamp"))}else s="esriFieldTypeString"===o?`'${e.attributes[t]}'`:`${e.attributes[t]}`;return s},this.serializeDSQueryCondition=()=>{var e,t,a,i;const s=this.getQueryParamsFromDataSource(),o=(null==s?void 0:s.where)||"",r=null==s?void 0:s.geometry;return`${o}_${(null===(e=null==r?void 0:r.xmax)||void 0===e?void 0:e.toString())||""}_${(null===(t=null==r?void 0:r.xmin)||void 0===t?void 0:t.toString())||""}_${(null===(a=null==r?void 0:r.ymax)||void 0===a?void 0:a.toString())||""}_${(null===(i=null==r?void 0:r.ymin)||void 0===i?void 0:i.toString())||""}`},this.onDataSourceCreated=e=>{this.initDataLoader(),this.dataSource=e,this.previousIndex=this.props.index,this.isFirstLoad=!0,this.setState({dataSourceId:this.dataSource.id})},this.onCreateDataSourceFailed=e=>{this.onDataSourceStatusChanged(a.DataSourceStatus.CreateError)},this.onDataSourceInfoChange=e=>{var t;if(!e)return;const i=e.status;if(i===a.DataSourceStatus.NotReady&&(this.clearDataBuffer(),this.onDataSourceStatusChanged(a.DataSourceStatus.NotReady,null===(t=this.dataSource)||void 0===t?void 0:t.getLabel())),this.setState({dataSourceStatus:i,dataSourceWidgetQueries:e.widgetQueries,dataSourceQueriesWhere:this.serializeDSQueryCondition(),dataSourceVersion:e.version,dataSourceSourceVersion:e.sourceVersion}),this.dataSource&&this.dataSource.isDataView&&this.dataSource.dataViewId===a.CONSTANTS.SELECTION_DATA_VIEW_ID){const e=this.dataSource.getMainDataSource(),t=null==e?void 0:e.getSelectedRecordIds();this.clearDataBuffer(),t&&t[0]&&this.props.onSelectedRecordIdChanged(this.props.dsConfigId,0)}else{const t=e.selectedIds&&e.selectedIds[0];t?this.previousSelectedId!==t&&(this.previousSelectedId=t,this.props.isBaseOnObjectId?this.props.onSelectedRecordIdChanged(this.props.dsConfigId,-1,t):this.getDataIndexByObjectId(t).then((e=>{e>-1&&this.props.onSelectedRecordIdChanged(this.props.dsConfigId,e)}))):this.previousSelectedId&&(this.previousSelectedId=null)}},this.state={dataSourceId:null,dataSourceStatus:a.DataSourceStatus.Loaded,dataSourceVersion:void 0,dataSourceSourceVersion:void 0,dataSourceWidgetQueries:void 0,dataSourceQueriesWhere:""},this.initDataLoader()}componentDidUpdate(e,t){this.prevProps=e;const i=this.state.dataSourceQueriesWhere!==t.dataSourceQueriesWhere,s=e.isBaseOnObjectId&&!this.props.isBaseOnObjectId,o=!e.needCountInfo&&this.props.needCountInfo,r=this.state.dataSourceSourceVersion!==t.dataSourceSourceVersion;(i||s||o||r)&&this.clearDataBuffer(),this.props.useDataSource&&this.props.active&&this.state.dataSourceId===this.props.useDataSource.dataSourceId&&this.state.dataSourceStatus!==a.DataSourceStatus.NotReady&&this.state.dataSourceStatus!==a.DataSourceStatus.Loading&&this.getCurrentData()}onDataChanged(e,t){var i,s,o,r,n,u,d,l;this.props.active&&(t?this.props.active!==this.prevProps.active?this.props.onDataChanged(this.props.dsConfigId,this.dataSource,t,this.isFirstLoad):(null===(i=this.previousData)||void 0===i?void 0:i.dataSourceId)===(null==t?void 0:t.dataSourceId)&&(null===(s=this.previousData)||void 0===s?void 0:s.id)===(null==t?void 0:t.id)&&(null===(o=this.previousData)||void 0===o?void 0:o.count)===(null==t?void 0:t.count)&&(null===(r=this.previousData)||void 0===r?void 0:r.index)===(null==t?void 0:t.index)&&(null===(n=this.previousData)||void 0===n?void 0:n.dataSourceVersion)===(null==t?void 0:t.dataSourceVersion)&&a.lodash.isDeepEqual(null===(d=null===(u=this.previousData)||void 0===u?void 0:u.graphic)||void 0===d?void 0:d.attributes,null===(l=null==t?void 0:t.graphic)||void 0===l?void 0:l.attributes)||this.props.onDataChanged(this.props.dsConfigId,this.dataSource,t,this.isFirstLoad):this.props.onDataChanged(this.props.dsConfigId,this.dataSource,t),this.previousData=t)}addObjectIdDataToBuffer(e,t){e.records.forEach(((a,i)=>{const s=a.getId();this.dataBuffer.dataMapByObjectId[s]={id:s,count:-1,index:-1,graphic:e.graphics[i],defaultPopupTemplate:e.defaultPopupTemplate,record:a,dataSourceId:t,dataSourceVersion:this.state.dataSourceVersion}}))}addIndexDataToBuffer(e,t){e.records.forEach(((a,i)=>{const s=e.start+i;this.dataBuffer.dataMapByIndex[s]={id:a.getId(),count:this.dataBuffer.count,index:s,graphic:e.graphics[i],defaultPopupTemplate:e.defaultPopupTemplate,record:a,dataSourceId:t,dataSourceVersion:this.state.dataSourceVersion}}))}setDataBufferCount(e){this.dataBuffer.count=e}getDataFromBuffer(e,t){let a=null;return t?(a=this.dataBuffer.dataMapByObjectId[t],a||(a=Object.values(this.dataBuffer.dataMapByIndex).find((e=>e.id===t)))):e>=0&&(a=this.dataBuffer.dataMapByIndex[e]),a}getDataIndexByObjectId(e){return g(this,void 0,void 0,(function*(){var t;let a=-1;if(Object.entries(this.dataBuffer.dataMapByIndex).some((t=>{var i;return e===(null===(i=t[1])||void 0===i?void 0:i.id)&&(a=Number(t[0]),!0)})),a<0&&this.dataSource){const i=this.dataSource.getIdField(),s=null===(t=this.getQueryParamsFromDataSource())||void 0===t?void 0:t.orderByFields;if(s&&(null==s?void 0:s.length)>0){let t=0;const o=yield this.dataSource.queryById(e);let r=" ";if(null==o?void 0:o.feature)for(let e=0;e<s.length;e++){const n=s[e],u=null==n?void 0:n.split(" "),d=u[0],l=u[1]&&0===u[1].indexOf("DESC"),c=this.getWherePhraseForField(o.feature,d),h=s[e+1]||i,p=null==h?void 0:h.split(" "),g=p[0],f=p[1]&&0===p[1].indexOf("DESC"),S=this.getWherePhraseForField(o.feature,g);if(0===e){const e=l?`${d} > ${c}`:`${d} < ${c} or ${d} is NULL`;t+=(yield this.dataSource.queryCount({where:e}).then((e=>e.count)).catch((e=>-1)))}let v;v=f?g===i?">=":">":g===i?"<=":"<",r+=`${d} = ${c} and `;const D=f?`${r} ${g} ${v} ${S}`:`${r} ${g} ${v} ${S} or ${g} is NULL`;if(t+=(yield this.dataSource.queryCount({where:D}).then((e=>e.count)).catch((e=>-1))),g===i){a=t-1;break}}}else a=yield this.dataSource.queryCount({where:`${i}<=${e}`}).then((e=>(a=e.count-1,a)))}return Promise.resolve(a)}))}clearDataBuffer(){this.dataBuffer.count=-1,this.dataBuffer.dataMapByIndex={},this.dataBuffer.dataMapByObjectId={}}getLayerObject(e){const t=this.dataSource.isDataView&&this.dataSource.dataViewId===a.CONSTANTS.SELECTION_DATA_VIEW_ID?e.getMainDataSource():e;return t.layer?t.layer.load().then((()=>Promise.resolve(t.layer))):t.createJSAPILayerByDataSource().then((e=>e.load().then((()=>Promise.resolve(e)))))}queryGraphicByObjectId(e){var t;return this.onDataSourceStatusChanged(a.DataSourceStatus.Loading,null===(t=this.dataSource)||void 0===t?void 0:t.getLabel()),this.getLayerObject(this.dataSource).then((t=>this.dataSource.queryById(e).then((e=>{var i,s;e.feature.sourceLayer=t.associatedLayer||t,e.feature.layer=t.associatedLayer||t;const o=(null===(i=t.associatedLayer)||void 0===i?void 0:i.defaultPopupTemplate)||t.defaultPopupTemplate;return this.onDataSourceStatusChanged(a.DataSourceStatus.Loaded,null===(s=this.dataSource)||void 0===s?void 0:s.getLabel()),{graphics:[e.feature],records:[e],defaultPopupTemplate:(null==o?void 0:o.clone())||{content:""}}})))).catch((e=>{var t;return console.warn(e),this.onDataSourceStatusChanged(a.DataSourceStatus.Loaded,null===(t=this.dataSource)||void 0===t?void 0:t.getLabel()),{graphics:[],records:[]}}))}queryGraphicByIndex(e){var t;let i,s,o=e;return this.onDataSourceStatusChanged(a.DataSourceStatus.Loading,null===(t=this.dataSource)||void 0===t?void 0:t.getLabel()),this.getLayerObject(this.dataSource).then((e=>g(this,void 0,void 0,(function*(){s=e;const t=this.dataSource&&this.dataSource.isDataView&&this.dataSource.dataViewId===a.CONSTANTS.SELECTION_DATA_VIEW_ID;if(this.isFirstLoad&&!t){const e=this.dataSource.getSelectedRecordIds()[0];void 0!==e&&(yield this.getDataIndexByObjectId(e).then((e=>{o=-1===e?0:e})))}})))).then((()=>{i=Math.floor(o/this.dataBuffer.pagingNum)*this.dataBuffer.pagingNum;const e={outFields:["*"],notAddFieldsToClient:!0,returnGeometry:!0,page:Math.floor(i/this.dataBuffer.pagingNum)+1,pageSize:this.dataBuffer.pagingNum};return this.dataSource.query(e)})).then((e=>{const t=e.records;if(this.dataSource.isDataView&&this.dataSource.dataViewId===a.CONSTANTS.SELECTION_DATA_VIEW_ID&&t.length>0){const e={objectIds:t.map((e=>e.feature.attributes[s.objectIdField])),outFields:["*"],notAddFieldsToClient:!0,returnGeometry:!0};return this.dataSource.getMainDataSource().query(e)}return e})).then((e=>{var t,r;const n=e.records,u=this.getQueryParamsFromDataSource().where;s.definitionExpression=u;const d=n.map((e=>(e.feature.sourceLayer=s.associatedLayer||s,e.feature.layer=s.associatedLayer||s,e.feature))),l=(null===(t=s.associatedLayer)||void 0===t?void 0:t.defaultPopupTemplate)||s.defaultPopupTemplate;return this.onDataSourceStatusChanged(a.DataSourceStatus.Loaded,null===(r=this.dataSource)||void 0===r?void 0:r.getLabel()),{index:o,start:i,num:this.dataBuffer.pagingNum,graphics:d,records:n,defaultPopupTemplate:(null==l?void 0:l.clone())||{content:""}}})).catch((e=>{var t;return console.warn(e),this.onDataSourceStatusChanged(a.DataSourceStatus.Loaded,null===(t=this.dataSource)||void 0===t?void 0:t.getLabel()),{graphics:[],records:[]}}))}getQueryParamsFromDataSource(){var e;return null===(e=this.dataSource)||void 0===e?void 0:e.getRealQueryParams({},"query")}render(){return a.React.createElement(a.DataSourceComponent,{useDataSource:this.props.useDataSource,widgetId:this.props.widgetId,onDataSourceCreated:this.onDataSourceCreated,onDataSourceInfoChange:this.onDataSourceInfoChange,onCreateDataSourceFailed:this.onCreateDataSourceFailed})}}class S extends a.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.1.0",description:"added [styleType] and [fontSizeType]",upgrader:e=>{let t=e;return t=t.set("styleType","usePopupDefined"),t.getIn(["style","fontSize","distance"])||t.getIn(["style","textColor"])?t=t.setIn(["style","fontSizeType"],"custom"):(t=t.setIn(["style","fontSizeType"],"auto"),t=t.setIn(["style","fontSize","distance"],14)),t}},{version:"1.15.0",description:"added [styleType] and [fontSizeType]",upgrader:(e,t)=>{var i,s;const o=null===(s=null===(i=(0,a.getAppStore)().getState())||void 0===i?void 0:i.appConfig)||void 0===s?void 0:s.widgets[t],r=(null==o?void 0:o.useDataSources)&&o.useDataSources[0],n=e.asMutable();if(r){const t={id:"default_data_source_config",useDataSourceId:r.dataSourceId,contentConfig:{title:e.title,fields:e.fields,media:e.media,attachments:e.attachments,lastEditInfo:e.lastEditInfo}};n.dsConfigs=[t]}else n.dsConfigs=[];return n.dsNavigator=!0,n.featureNavigator=!0,delete n.title,delete n.fields,delete n.media,delete n.attachments,delete n.lastEditInfo,(0,a.Immutable)(n)}},{version:"1.16.0",description:"set useMapWidget property to false",upgrader:(e,t)=>{let a=e;return a=a.set("useMapWidget",!1),a}}]}}const v=new S;var D=o(6821),m=o.n(D);function y(e){const t=e.dsConfigs.find((t=>t.id===e.activeDSConfigId));return(0,a.jsx)("div",{className:"data_source_selector",style:{}},(0,a.jsx)(s.Dropdown,{activeIcon:!0},(0,a.jsx)(s.DropdownButton,{type:"tertiary",size:"sm",style:{maxWidth:e.width},title:null==t?void 0:t.label},null==t?void 0:t.label),(0,a.jsx)(s.DropdownMenu,{offsetOptions:4},e.dsConfigs.map(((t,i)=>(0,a.jsx)(s.DropdownItem,{key:i,active:e.activeDSConfigId===t.id,onClick:()=>{e.onCurrentDSChange(t.id)}}," ",t.label," "))))))}const C=(0,a.Immutable)([a.AllDataSourceTypes.FeatureLayer,a.AllDataSourceTypes.SceneLayer,a.AllDataSourceTypes.BuildingComponentSubLayer,a.AllDataSourceTypes.OrientedImageryLayer,a.AllDataSourceTypes.ImageryLayer,a.AllDataSourceTypes.SubtypeSublayer]);(0,a.Immutable)([a.JSAPILayerTypes.FeatureLayer,a.JSAPILayerTypes.SceneLayer,a.JSAPILayerTypes.BuildingComponentSublayer,a.JSAPILayerTypes.OrientedImageryLayer,a.JSAPILayerTypes.ImageryLayer,a.JSAPILayerTypes.SubtypeSublayer]),(0,a.Immutable)([a.AllDataSourceTypes.FeatureLayer,a.AllDataSourceTypes.SceneLayer,a.AllDataSourceTypes.WebMap,a.AllDataSourceTypes.WebScene,a.AllDataSourceTypes.MapService,a.AllDataSourceTypes.FeatureService,a.AllDataSourceTypes.SceneService,a.AllDataSourceTypes.GroupLayer,a.AllDataSourceTypes.BuildingComponentSubLayer,a.AllDataSourceTypes.BuildingGroupSubLayer,a.AllDataSourceTypes.BuildingSceneLayer,a.AllDataSourceTypes.OrientedImageryLayer,a.AllDataSourceTypes.ImageryLayer,a.AllDataSourceTypes.SubtypeGroupLayer,a.AllDataSourceTypes.SubtypeSublayer]),(0,a.Immutable)([a.AllDataSourceTypes.WebMap,a.AllDataSourceTypes.WebScene,a.AllDataSourceTypes.MapService,a.AllDataSourceTypes.FeatureService,a.AllDataSourceTypes.SceneService,a.AllDataSourceTypes.GroupLayer,a.AllDataSourceTypes.BuildingGroupSubLayer,a.AllDataSourceTypes.BuildingSceneLayer,a.AllDataSourceTypes.SubtypeGroupLayer]);function I(e){var t,a;return C.includes(null==e?void 0:e.type)&&!(null===(t=null==e?void 0:e.dataSourceJson)||void 0===t?void 0:t.isHidden)&&(null===(a=null==e?void 0:e.getSchema())||void 0===a?void 0:a.fields)}function w(e){var t,i;return(0,a.Immutable)({dataSourceId:e.id,mainDataSourceId:null===(t=e.getMainDataSource())||void 0===t?void 0:t.id,dataViewId:e.dataViewId,rootDataSourceId:null===(i=e.getRootDataSource())||void 0===i?void 0:i.id})}function b(e,t){const i=a.DataSourceManager.getInstance().getDataSource(e);return{id:(0,a.uuidv1)(),label:t||(null==i?void 0:i.getLabel())||e,useDataSourceId:e,contentConfig:{title:!0,fields:!0,media:!0,attachments:!0,lastEditInfo:!0}}}var M=o(4583),L=o.n(M),x=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(a[i[s]]=e[i[s]])}return a};const V=e=>{const t=window.SVG,{className:i}=e,s=x(e,["className"]),o=(0,a.classNames)("jimu-icon jimu-icon-component",i);return t?a.React.createElement(t,Object.assign({className:o,src:L()},s)):a.React.createElement("svg",Object.assign({className:o},s))};var T=function(e,t,a,i){return new(a||(a=Promise))((function(s,o){function r(e){try{u(i.next(e))}catch(e){o(e)}}function n(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,n)}u((i=i.apply(e,t||[])).next())}))};class j extends a.React.PureComponent{constructor(e){super(e),this.featureInfoConRef=a.React.createRef(),this.getDSConfigs=()=>{let e;if(this.props.config.useMapWidget){const e=[],t=[],a=i.MapViewManager.getInstance().getJimuMapViewById(this.state.jimuMapViewId);return this.dsConfigsOfMapView.forEach((i=>{const s=null==a?void 0:a.getJimuLayerViewByDataSourceId(i.useDataSourceId);!s&&t.push(i),(null==s?void 0:s.isLayerVisible())&&e.push(i)})),e.concat(t)}return e=this.props.config.dsConfigs||(0,a.Immutable)([]),e.map((e=>{if(null===e.label||void 0===e.label){const t=a.DataSourceManager.getInstance().getDataSource(e.useDataSourceId);return e.set("label",(null==t?void 0:t.getLabel())||"")}return e}))},this.getDSConfigById=e=>{const t=this.getDSConfigs();return t?t.find((t=>t.id===e)):null},this.getCurrentDSConfig=()=>this.getDSConfigById(this.state.currentDSConfigId),this.getDefaultDSConfig=()=>this.getDSConfigs()[0],this.isValidData=e=>{var t;if(this.props.config.useMapWidget)return(null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t.length)>0;return(this.props.useDataSources||(0,a.Immutable)([])).some((t=>t.dataSourceId===e))},this.loadUseDataSourceById=e=>{const t=i.MapViewManager.getInstance().getJimuMapViewById(this.state.jimuMapViewId),s=null==t?void 0:t.getJimuLayerViewByDataSourceId(e);null==s||s.createLayerDataSource().then((e=>{const t=w(e);this.useDataSourcesOfMapView.push(t),this.setState({useDataSourceChangedFlag:(0,a.uuidv1)()})}))},this.getUseDataSourceById=e=>{if(this.props.config.useMapWidget)return this.useDataSourcesOfMapView.find((t=>t.dataSourceId===e));return(this.props.useDataSources||(0,a.Immutable)([])).find((t=>t.dataSourceId===e))},this.clearSelection=()=>{var e;((null===(e=this.dataSource)||void 0===e?void 0:e.getSelectedRecordIds())||[]).length>0&&(this.dataSource.selectRecordsByIds([]),a.MessageManager.getInstance().publishMessage(new a.DataRecordsSelectionChangeMessage(this.props.id,[],[this.dataSource.id])))},this.onPreGraphicBtnClick=()=>{let e=this.state.currentDataIndex;e>0&&(this.setState({currentDataIndex:--e}),this.lockSelection=!1)},this.onNextGraphicBtnClick=()=>{let e=this.state.currentDataIndex;(!this.props.config.showCount||e<this.currentData.count-1)&&(this.setState({currentDataIndex:++e}),this.lockSelection=!1)},this.onClearSelectionBtnClick=()=>{this.clearSelection()},this.onSelectedRecordIdChanged=(e,t,a)=>{this.setState({currentDSConfigId:e,currentDataIndex:t,currentDataObjectId:a})},this.onUnselectedRecordIdChanged=e=>{var t;(null===(t=this.dataSource)||void 0===t?void 0:t.id)===e&&a.MessageManager.getInstance().publishMessage(new a.DataRecordsSelectionChangeMessage(this.props.id,[],[e]))},this.onDataSourceStatusChanged=(e,t)=>{this.setState({loadDataStatus:e,dataSourceLabel:t})},this.onDataChanged=(e,t,a,i)=>{e===this.state.currentDSConfigId&&(this.dataSource=t,this.previousData=this.currentData,this.currentData=a,this.setState({currentDataId:this.currentData?this.currentData.id:null,currentDataIndex:this.currentData?this.currentData.index:0,currentDataSourceVersion:this.currentData?this.currentData.dataSourceVersion:null}),this.lockSelection||(this.selectGraphic(),this.lockSelection=!0))},this.onCurrentFeatureClick=()=>{this.selectGraphic()},this.onCurrentDSChange=e=>{this.setState({currentDSConfigId:e,currentDataIndex:0})},this.onResize=({width:e,height:t})=>{let a=80;a=e<350?e/3:e/2,a=10*Math.floor(a/10),this.setState({widthOfDSSelector:Math.floor(a)})},this.onJimuLayerViewCreate=(e,t)=>T(this,void 0,void 0,(function*(){var a,i;if(t.find((t=>e.id===t.id))||!e.isLayerVisible())return;const s=yield e.createLayerDataSource();if(!I(s))return;const o=w(s);this.useDataSourcesOfMapView.push(o),this.dsConfigsOfMapView.push(b(e.layerDataSourceId,null===(a=e.layer)||void 0===a?void 0:a.title)),this.setState({jimuLayerViewChangedFlag:e.id,currentDSConfigId:null===(i=this.getDefaultDSConfig())||void 0===i?void 0:i.id})})),this.onJimuLayerViewRemove=e=>{var t;this.dsConfigsOfMapView.some(((t,a)=>t.useDataSourceId===e.layerDataSourceId&&(this.dsConfigsOfMapView.splice(a,1),!0))),this.useDataSourcesOfMapView.some(((t,a)=>t.dataSourceId===e.layerDataSourceId&&(this.useDataSourcesOfMapView.splice(a,1),!0)));const i=null===(t=this.getDefaultDSConfig())||void 0===t?void 0:t.id;i||(this.currentData=null,this.dataSource=null),this.setState({jimuLayerViewChangedFlag:(0,a.uuidv1)(),currentDSConfigId:i})},this.onJimuLayerViewVisibilityChange=e=>{var t;e.forEach((e=>T(this,void 0,void 0,(function*(){var t,i;const s=this.getDSConfigs().find((t=>t.useDataSourceId===e.layerDataSourceId));if(!e.isLayerVisible()||s)return;const o=yield e.createLayerDataSource();if(I(o)){const s=w(o);this.useDataSourcesOfMapView.push(s),this.dsConfigsOfMapView.push(b(e.layerDataSourceId,null===(t=e.layer)||void 0===t?void 0:t.title)),this.setState({jimuLayerViewChangedFlag:(0,a.uuidv1)(),currentDSConfigId:null===(i=this.getDefaultDSConfig())||void 0===i?void 0:i.id})}}))));const i=null===(t=this.getDefaultDSConfig())||void 0===t?void 0:t.id;i||(this.currentData=null,this.dataSource=null),this.setState({jimuLayerViewChangedFlag:(0,a.uuidv1)(),currentDSConfigId:i})},this.addNewDataForMapView=(e,t)=>{var a;if(I(e)){const i=w(e);this.useDataSourcesOfMapView.push(i),this.dsConfigsOfMapView.push(b(e.id,t)),this.setState({jimuLayerViewChangedFlag:e.id,currentDSConfigId:null===(a=this.getDefaultDSConfig())||void 0===a?void 0:a.id})}},this.onJimuMapViewLoaded=e=>{const t=a.DataSourceManager.getInstance().getDataSource(e.dataSourceId);t&&e.getJimuTables().forEach((a=>T(this,void 0,void 0,(function*(){var i;const s=e.getDataSourceIdByAPILayer(a.table),o=yield t.createDataSourceById(s);this.addNewDataForMapView(o,null===(i=a.table)||void 0===i?void 0:i.title)}))))},this.onActiveViewChange=e=>{if(this.currentData=null,this.dataSource=null,this.dsConfigsOfMapView=[],this.useDataSourcesOfMapView=[],this.onDataSourceStatusChanged(a.DataSourceStatus.Loaded),!e)return void this.setState({jimuMapViewId:null});const t=e.getAllJimuLayerViews();t.forEach((e=>T(this,void 0,void 0,(function*(){var t,a;if(!e.isLayerVisible())return;const i=yield e.createLayerDataSource();if(I(i)){const s=w(i);this.useDataSourcesOfMapView.push(s),this.dsConfigsOfMapView.push(b(e.layerDataSourceId,null===(t=e.layer)||void 0===t?void 0:t.title)),this.setState({jimuLayerViewChangedFlag:e.id,currentDSConfigId:null===(a=this.getDefaultDSConfig())||void 0===a?void 0:a.id})}})))),this.prevJimuMapView&&(this.jimuLayerViewCreatedListener&&this.prevJimuMapView.removeJimuLayerViewCreatedListener(this.jimuLayerViewCreatedListener),this.jimuLayerViewRemovedListener&&this.prevJimuMapView.removeJimuLayerViewRemovedListener(this.jimuLayerViewRemovedListener),this.jimuLayerViewsVisibleChangedListener&&this.prevJimuMapView.removeJimuLayerViewsVisibleChangeListener(this.jimuLayerViewsVisibleChangedListener)),this.prevJimuMapView=e,this.jimuLayerViewCreatedListener=e=>{this.onJimuLayerViewCreate(e,t)},e.addJimuLayerViewCreatedListener(this.jimuLayerViewCreatedListener),this.jimuLayerViewRemovedListener=e=>{this.onJimuLayerViewRemove(e)},e.addJimuLayerViewRemovedListener(this.jimuLayerViewRemovedListener),this.jimuLayerViewsVisibleChangedListener=e=>{this.onJimuLayerViewVisibilityChange(e)},e.addJimuLayerViewsVisibleChangeListener(this.jimuLayerViewsVisibleChangedListener),e.whenJimuMapViewLoaded().then((()=>{this.onJimuMapViewLoaded(e)})),this.setState({jimuMapViewId:e.id})},this.isDataSourceAccessible=e=>{var t;return!!this.props.config.useMapWidget||!!(null===(t=this.props.useDataSources)||void 0===t?void 0:t.find((t=>e===t.dataSourceId)))},this.getPlaceholderContent=()=>(0,a.jsx)("div",{className:"widget-featureInfo"},(0,a.jsx)(s.WidgetPlaceholder,{icon:m(),name:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:u}),widgetId:this.props.id})),this.getLoadingContent=()=>{let e=null;return this.state.loadDataStatus===a.DataSourceStatus.Loading&&(e=(0,a.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%"},className:"jimu-secondary-loading"})),e},this.getHeaderContent=()=>{var e,t,i,o,r;let n=null;const u=this.props.intl.formatMessage({id:"featureInfoDataActionLabel",defaultMessage:c},{layer:(null===(e=this.dataSource)||void 0===e?void 0:e.getLabel())||""}),d=(void 0===this.props.enableDataAction||this.props.enableDataAction)&&this.dataSource&&this.currentData;d&&(n=(0,a.jsx)("div",{className:"data-action-dropdown-content"},(0,a.jsx)(s.DataActionList,{widgetId:this.props.id,dataSets:[{dataSource:this.dataSource,records:(null===(t=this.currentData)||void 0===t?void 0:t.record)?[null===(i=this.currentData)||void 0===i?void 0:i.record]:[],name:u,type:"current",fields:this.dataSource.getPopupInfoFields()}],listStyle:s.DataActionListStyle.Dropdown,buttonType:"tertiary"})));let h=null;const p=!this.props.config.showCount||(null===(o=this.currentData)||void 0===o?void 0:o.count)>1,g=this.currentData&&this.props.config.featureNavigator&&p;if(g){const e=this.props.intl.formatMessage({id:"featureNumbers",defaultMessage:l},{index:this.currentData.index+1,count:this.currentData.count});h=(0,a.jsx)("div",{className:"nav-section d-flex justify-content-center align-items-center"},(0,a.jsx)(s.Button,{className:"nav-btn",type:"tertiary",size:"sm",disabled:this.currentData.index<=0,onClick:this.onPreGraphicBtnClick,"aria-label":this.props.intl.formatMessage({id:"previous",defaultMessage:s.defaultMessages.previous}),"aria-describedby":"feature-numbers"}," ","<"," "),(0,a.jsx)("span",{id:"feature-numbers"}," ",this.props.config.showCount?e:""," "),(0,a.jsx)(s.Button,{className:"nav-btn",type:"tertiary",size:"sm",disabled:!!this.props.config.showCount&&this.currentData.index+1>=this.currentData.count,onClick:this.onNextGraphicBtnClick,"aria-label":this.props.intl.formatMessage({id:"next",defaultMessage:s.defaultMessages.next}),"aria-describedby":"feature-numbers"}," ",">"," "))}let f=null;const S=this.props.config.dsNavigator&&this.getDSConfigs().length>1;if(S){const e=this.getDSConfigs().filter((e=>this.isDataSourceAccessible(e.useDataSourceId)));f=(0,a.jsx)(y,{width:this.state.widthOfDSSelector,dsConfigs:e,activeDSConfigId:this.state.currentDSConfigId,onCurrentDSChange:this.onCurrentDSChange})}let v=null;const D=this.props.intl.formatMessage({id:"clearSelection",defaultMessage:"Clear selection"});if(this.props.config.clearSelection){const e=(null===(r=this.dataSource)||void 0===r?void 0:r.getSelectedRecordIds())||[];v=(0,a.jsx)("div",{className:"clear-selection d-flex justify-content-center align-items-center"},(0,a.jsx)(s.Button,{title:D,type:"tertiary",size:"sm",icon:!0,disabled:e.length<=0,onClick:this.onClearSelectionBtnClick,"aria-label":D},(0,a.jsx)(V,{size:16})))}let m=null;return(g||S||d)&&this.state.loadDataStatus!==a.DataSourceStatus.CreateError&&this.state.loadDataStatus!==a.DataSourceStatus.NotReady&&(m=(0,a.jsx)("div",{className:"header-section"},h,(0,a.jsx)("div",{className:"header-control-section"},f,v,n))),m},this.getDsErrorMessageContent=()=>(0,a.jsx)("div",{className:"widget-featureInfo"},(0,a.jsx)(s.WidgetPlaceholder,{icon:m(),name:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:u}),widgetId:this.props.id}),(0,a.jsx)(s.Alert,{className:"warning-inaccessible",type:"warning",withIcon:!0,text:this.props.intl.formatMessage({id:"dataSourceCreateError",defaultMessage:"warning"})})),this.getWarningMessageContent=()=>{const e=this.props.dataSourceWidgetLabelInfos.find((e=>{var t;return e.dataSourceId===(null===(t=this.getCurrentDSConfig())||void 0===t?void 0:t.useDataSourceId)})),t=this.props.intl.formatMessage({id:"outputDataIsNotGenerated",defaultMessage:"warning"},{outputDsLabel:this.state.dataSourceLabel,sourceWidgetName:(null==e?void 0:e.label)||""});return(0,a.jsx)("div",{className:"widget-featureInfo"},(0,a.jsx)(s.WidgetPlaceholder,{icon:m(),name:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:u}),widgetId:this.props.id}),(0,a.jsx)(s.Alert,{className:"warning-icon",form:"tooltip",size:"small",type:"warning",text:t}))},this.getDefaultMessageContent=()=>{const e=new a.esri.Sanitizer;return(0,a.jsx)("div",{className:"no-data-message p-5 font-weight-bold",dangerouslySetInnerHTML:{__html:e.sanitize(this.props.config.noDataMessage)||this.props.intl.formatMessage({id:"noDataMessageDefaultText",defaultMessage:d})}})},this.getFeaturesContent=()=>{var e,t,i,s,o,r;const n=this.getCurrentDSConfig(),u=null==n?void 0:n.contentConfig,d={title:null==u?void 0:u.title,content:{fields:null===(e=null==u?void 0:u.fields)||void 0===e||e,text:null===(t=null==u?void 0:u.fields)||void 0===t||t,media:null===(i=null==u?void 0:u.media)||void 0===i||i,attachments:null===(s=null==u?void 0:u.attachments)||void 0===s||s,expression:!0},lastEditedInfo:null===(o=null==u?void 0:u.lastEditInfo)||void 0===o||o},l=((null===(r=this.dataSource)||void 0===r?void 0:r.getSelectedRecordIds())||[]).some((e=>{var t;return e===(null===(t=this.currentData)||void 0===t?void 0:t.id)})),c=l?"default":"pointer";return(0,a.jsx)("div",{style:{cursor:c},onClick:this.onCurrentFeatureClick},(0,a.jsx)(p,{graphic:this.currentData.graphic,defaultPopupTemplate:this.currentData.defaultPopupTemplate,visibleElements:d,dataSource:this.dataSource,timezone:this.props.timezone,useMapWidget:this.props.config.useMapWidget}))},this.getFeatureInfoContent=()=>{let e;return this.state.loadDataStatus===a.DataSourceStatus.CreateError?e=this.getDsErrorMessageContent():this.state.loadDataStatus===a.DataSourceStatus.NotReady?e=this.getWarningMessageContent():this.currentData&&this.dataSource?e=this.getFeaturesContent():this.state.loadDataStatus===a.DataSourceStatus.Loaded&&(e=this.getDefaultMessageContent()),e},this.getDataSourceContent=()=>{var e,t;let s=null,o=null;return s=this.getDSConfigs().map(((e,t)=>{const i=this.getUseDataSourceById(null==e?void 0:e.useDataSourceId),s=!this.props.config.featureNavigator;return(0,a.jsx)(f,{key:t,active:this.state.currentDSConfigId===e.id,useDataSource:i,dsConfigId:e.id,widgetId:this.props.id,index:this.state.currentDataIndex,objectId:s?this.state.currentDataObjectId:null,limitGraphics:this.props.config.limitGraphics,maxGraphics:this.props.config.maxGraphics,onSelectedRecordIdChanged:this.onSelectedRecordIdChanged,onUnselectedRecordIdChanged:this.onUnselectedRecordIdChanged,onDataSourceStatusChanged:this.onDataSourceStatusChanged,needCountInfo:this.props.config.showCount,isBaseOnObjectId:s,onDataChanged:this.onDataChanged})})),o=(0,a.jsx)("div",{style:{position:"absolute",display:"block"}},s,this.props.config.useMapWidget&&(null===(e=this.props.useMapWidgetIds)||void 0===e?void 0:e[0])&&(0,a.jsx)(i.JimuMapViewComponent,{useMapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onActiveViewChange:this.onActiveViewChange})),o},this.previousData=null,this.currentData=null,this.lockSelection=!0,this.dsConfigsOfMapView=[],this.useDataSourcesOfMapView=[],this.jimuLayerViewCreatedListener=null,this.jimuLayerViewRemovedListener=null,this.jimuLayerViewsVisibleChangedListener=null,this.prevJimuMapView=null;const t=this.props.config;this.state={currentDataId:null,currentDataIndex:0,currentDataObjectId:"",currentDataSourceVersion:null,loadDataStatus:a.DataSourceStatus.Loaded,dataSourceWidgetId:null,dataSourceLabel:"",currentDSConfigId:t.dsConfigs&&t.dsConfigs[0]&&t.dsConfigs[0].id,widthOfDSSelector:80,jimuMapViewId:null,jimuLayerViewChangedFlag:"",useDataSourceChangedFlag:""}}componentDidUpdate(e){var t,a,i,s,o,r;if((null===(a=null===(t=this.props)||void 0===t?void 0:t.stateProps)||void 0===a?void 0:a.currentDSConfigId)&&(null===(i=null==e?void 0:e.stateProps)||void 0===i?void 0:i.currentDSConfigId)!==this.props.stateProps.currentDSConfigId)return void this.onCurrentDSChange(null===(o=null===(s=this.props)||void 0===s?void 0:s.stateProps)||void 0===o?void 0:o.currentDSConfigId);const n=this.getCurrentDSConfig(),u=this.getDefaultDSConfig();if(!this.isValidData(null===(r=n||u)||void 0===r?void 0:r.useDataSourceId))return this.dsConfigsOfMapView=[],this.useDataSourcesOfMapView=[],this.setState({currentDSConfigId:"",currentDataId:null,currentDataIndex:0}),void(this.currentData=null);n||this.setState({currentDSConfigId:null==u?void 0:u.id})}selectGraphic(){var e;const t=null===(e=this.currentData)||void 0===e?void 0:e.record;if(t&&this.dataSource){a.MessageManager.getInstance().publishMessage(new a.DataRecordsSelectionChangeMessage(this.props.id,[t],[this.dataSource.id]));const e=this.dataSource.getSelectedRecordIds(),i=t.getId();e.includes(i)||this.dataSource.queryById(i).then((e=>{this.dataSource.selectRecordsByIds([i],[e])}))}}getStyleConfig(){const e=this.props.config;return e.style?e.style:{textColor:"",fontSizeType:t.auto,fontSize:null,backgroundColor:""}}render(){var e,t,i;let s=null;return this.isValidData(null===(e=this.getCurrentDSConfig())||void 0===e?void 0:e.useDataSourceId)?s=(0,a.jsx)("div",{className:"widget-featureInfo",ref:this.featureInfoConRef},this.getLoadingContent(),this.getHeaderContent(),this.getFeatureInfoContent(),this.getDataSourceContent(),(0,a.jsx)(a.ReactResizeDetector,{targetRef:this.featureInfoConRef,handleWidth:!0,onResize:this.onResize})):(s=this.getPlaceholderContent(),this.currentData=null),(0,a.jsx)("div",{css:n(this.props.theme,this.props.config.styleType,this.getStyleConfig(),null===(i=null===(t=(0,a.getAppStore)().getState())||void 0===t?void 0:t.appContext)||void 0===i?void 0:i.isRTL,this.props.autoWidth),className:"jimu-widget"},s)}}j.getFullConfig=i=>(0,a.Immutable)({useMapWidget:!0,limitGraphics:!1,maxGraphics:0,noDataMessage:"",styleType:e.usePopupDefined,style:{textColor:"",fontSizeType:t.auto,fontSize:{distance:14,unit:s.DistanceUnits.PIXEL},backgroundColor:""},dsNavigator:!0,featureNavigator:!0,showCount:!0,clearSelection:!0,dsConfigs:[],dsConfigsOfMapWidget:[]}).merge(i),j.versionManager=v,j.mapExtraStateProps=(e,t)=>{var i,s;const o=(t.useDataSources||[]).map((t=>{var i,s;const o=a.appConfigUtils.getWidgetIdByOutputDataSource(t);return{dataSourceId:t.dataSourceId,label:null===(s=null===(i=e.appConfig)||void 0===i?void 0:i.widgets[o])||void 0===s?void 0:s.label}}));return{dataSourceWidgetLabelInfos:o,timezone:null===(s=null===(i=e.appConfig)||void 0===i?void 0:i.attributes)||void 0===s?void 0:s.timezone}};const B=j;function O(e){o.p=e}})(),r})())}}}));