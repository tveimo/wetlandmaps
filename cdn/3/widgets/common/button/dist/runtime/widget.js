System.register(["jimu-core","jimu-ui"],(function(e,t){var i={},o={};return{setters:[function(e){i.AppMode=e.AppMode,i.BaseVersionManager=e.BaseVersionManager,i.ButtonClickMessage=e.ButtonClickMessage,i.DynamicStyleResolverComponent=e.DynamicStyleResolverComponent,i.ExpressionPartType=e.ExpressionPartType,i.ExpressionResolverComponent=e.ExpressionResolverComponent,i.ExpressionResolverErrorCode=e.ExpressionResolverErrorCode,i.Immutable=e.Immutable,i.LinkType=e.LinkType,i.MessageManager=e.MessageManager,i.React=e.React,i.appActions=e.appActions,i.classNames=e.classNames,i.css=e.css,i.getAppStore=e.getAppStore,i.jsx=e.jsx},function(e){o.DistanceUnits=e.DistanceUnits,o.Icon=e.Icon,o.Link=e.Link,o.Popper=e.Popper,o.defaultMessages=e.defaultMessages,o.styleUtils=e.styleUtils,o.utils=e.utils}],execute:function(){e((()=>{var e={14321:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=i}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var n={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(n),s.d(n,{__set_webpack_public_path__:()=>u,default:()=>c});var e,t=s(79244),i=s(14321);!function(e){e.Left="LEFT",e.Right="RIGHT"}(e||(e={}));class o extends t.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.0.0",description:"The first release.",upgrader:e=>{let t=e;return t.getIn(["styleConfig","name"])&&(t=t.set("styleConfig",t.styleConfig.without("name"))),t.getIn(["styleConfig","customStyle"])&&(t=t.set("styleConfig",t.styleConfig.without("customStyle"))),t.getIn(["styleConfig","themeStyle","quickStyleType"])&&(t=t.setIn(["styleConfig","themeStyle"],{quickStyleType:t.styleConfig.themeStyle.quickStyleType})),t=t.setIn(["styleConfig","useCustom"],!1),t}},{version:"1.1.0",description:"1.1.0",upgrader:e=>{let t=e;return t.getIn(["styleConfig","useCustom"])&&t.getIn(["styleConfig","customStyle","regular","border","width"])&&(t=t.setIn(["styleConfig","customStyle","regular","border","width"],i.utils.stringOfLinearUnit(t.getIn(["styleConfig","customStyle","regular","border","width"])))),t.getIn(["styleConfig","useCustom"])&&t.getIn(["styleConfig","customStyle","hover","border","width"])&&(t=t.setIn(["styleConfig","customStyle","hover","border","width"],i.utils.stringOfLinearUnit(t.getIn(["styleConfig","customStyle","hover","border","width"])))),t}},{version:"1.12.0",description:"fix icon picker config",upgrader:e=>{let t=e;if(t.getIn(["functionConfig","icon","data"])){const e={svg:t.getIn(["functionConfig","icon","data"]),properties:{filename:""}};t=t.setIn(["functionConfig","icon","data"],e)}return t}}]}}const r=new o,l={rootBoundary:"viewport",crossAxis:!0,padding:4},a={boundary:document.body,fallbackPlacements:["right-start","left-start","top","bottom","left","right","top-start","bottom-start"]};class p extends t.React.PureComponent{constructor(o){var s,n,r,l,a;super(o),this.lastClickTimestamp=null,this.getTextFromProps=()=>{var e,t,o,s;return"string"==typeof(null===(t=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===t?void 0:t.text)?null===(s=null===(o=this.props.config)||void 0===o?void 0:o.functionConfig)||void 0===s?void 0:s.text:this.props.intl.formatMessage({id:"variableButton",defaultMessage:i.defaultMessages.variableButton})},this.getTipExpression=()=>{var e,i;return this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTipExpression&&this.props.config.functionConfig.toolTipExpression||(0,t.Immutable)({name:"",parts:[{type:t.ExpressionPartType.String,exp:`"${(null===(i=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===i?void 0:i.toolTip)||""}"`}]})},this.getTextExpression=()=>{var e,i;return this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.textExpression&&this.props.config.functionConfig.textExpression||(0,t.Immutable)({name:"",parts:[{type:t.ExpressionPartType.String,exp:`"${(null===(i=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===i?void 0:i.text)||this.getTextFromProps()}"`}]})},this.getUrlExpression=()=>this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.expression||null,this.onTextExpResolveChange=e=>{if(e.isSuccessful)this.setState({text:e.value});else{let i="";e.value===t.ExpressionResolverErrorCode.Failed&&(i=this.state.textExpression&&this.state.textExpression.name),this.setState({text:i})}},this.onTipExpResolveChange=e=>{e.isSuccessful?this.setState({toolTip:e.value}):this.setState({toolTip:""})},this.onUrlExpResolveChange=e=>{if(e.isSuccessful)this.setState({url:e.value});else{let i="";e.value===t.ExpressionResolverErrorCode.Failed&&(i=this.state.urlExpression&&this.state.urlExpression.name),this.setState({url:i})}},this.getWhetherUseQuickStyle=e=>!!(e&&e.styleConfig&&e.styleConfig.themeStyle&&e.styleConfig.themeStyle.quickStyleType),this.getIconStyle=(e,o)=>{const s=e||{},n=o||{};return t.css`
      & img, & svg{
        color: ${s.color};
        fill: ${s.color};
        width: ${s.size}${i.DistanceUnits.PIXEL};
        height: ${s.size}${i.DistanceUnits.PIXEL};
      }
      &:hover{
        img, svg{
          color: ${n.color};
          fill: ${n.color};
          width: ${n.size}${i.DistanceUnits.PIXEL};
          height: ${n.size}${i.DistanceUnits.PIXEL};
        }
      }
    `},this.getMixinStyleSettings=(e,o)=>{const s=(null==o?void 0:o.without("iconProps").without("dynamicStyleConfig").without("enableDynamicStyle").asMutable({deep:!0}))||{},n=null==e?void 0:e.without("icon").asMutable({deep:!0});if(null==n?void 0:n.border){n.border=i.styleUtils.mixinBorderWithDynamicStyle(null==n?void 0:n.border,s),Object.assign(n,n.border);["border","borderLeft","borderRight","borderTop","borderBottom"].forEach((e=>delete s[e]))}(null==n?void 0:n.borderRadius)&&(n.borderRadius=i.styleUtils.mixinBorderRadiusWithDynamicStyle(null==n?void 0:n.borderRadius,s.borderRadius),delete s.borderRadius);let r=null;return n&&(r=(0,t.Immutable)(s).merge((0,t.Immutable)(n),{deep:!0}).asMutable({deep:!0})),r},this.removeUndefinedStyle=e=>{if(!e)return e;const t={};return Object.keys(e).forEach((i=>{("string"==typeof e[i]&&!e[i].includes("undefined")||"number"==typeof e[i])&&(t[i]=e[i])})),t},this.updateIconWithDynamicStyle=(e,i)=>{if(!i)return e;const o=i.without("color").without("size");return e?(0,t.Immutable)(Object.assign(Object.assign({},e.asMutable({deep:!0})),o)):(0,t.Immutable)(i)},this.getLinkComponent=()=>{var o,s,n,r,l,a,p,c;const u=this.props.config,d=u.functionConfig.linkParam,g=this.state.text,h=this.state.toolTip,y=this.getWhetherUseQuickStyle(u);let f,v,m,S,x,C,b=null===(o=u.functionConfig)||void 0===o?void 0:o.icon;if(u.styleConfig&&u.styleConfig.useCustom&&u.styleConfig.customStyle){let e=u.styleConfig.customStyle.regular;const o=u.styleConfig.customStyle.hover;if(e.borderRadius){const t=e.borderRadius.number.map((e=>null===e?0:e));e=e.setIn(["borderRadius","number"],t)}const p=e.enableDynamicStyle,c=this.state.regularDynamicStyles,d=p&&this.getMixinStyleSettings(c,e),g=null===(l=null===(r=null===(n=null===(s=this.props.config)||void 0===s?void 0:s.styleConfig)||void 0===n?void 0:n.customStyle)||void 0===r?void 0:r.hover)||void 0===l?void 0:l.enableDynamicStyle,h=this.state.hoverDynamicStyles,E=g&&this.getMixinStyleSettings(h,o);if(p&&c?(m=i.styleUtils.toCSSStyle(d),S=Object.assign(Object.assign({},null==e?void 0:e.iconProps),null==c?void 0:c.icon)):(m=i.styleUtils.toCSSStyle(e&&e.without("iconProps").asMutable({deep:!0})),S=null==e?void 0:e.iconProps),g&&h?(C=i.styleUtils.toCSSStyle(E),x=Object.assign(Object.assign({},null==o?void 0:o.iconProps),null==h?void 0:h.icon)):(C=i.styleUtils.toCSSStyle(o&&o.without("iconProps").asMutable({deep:!0})),x=null==o?void 0:o.iconProps),C=Object.assign(Object.assign({},m),C),x=Object.assign(Object.assign({},S),x),y&&"link"===(null===(a=u.styleConfig.themeStyle)||void 0===a?void 0:a.quickStyleType)&&((null==m?void 0:m.textDecoration)&&(m.textDecoration=`${m.textDecoration} !important`),(null==C?void 0:C.textDecoration)&&(C.textDecoration=`${C.textDecoration} !important`)),this.props.active&&this.props.appMode!==t.AppMode.Run){const e=(0,t.getAppStore)().getState().widgetsState[this.props.id]||(0,t.Immutable)({});f={style:e.isConfiguringHover?Object.assign(Object.assign({},this.removeUndefinedStyle(m)),this.removeUndefinedStyle(C)):m,hoverStyle:C},v=this.getIconStyle(e.isConfiguringHover?x:S,x)}else f={style:m,hoverStyle:C},v=this.getIconStyle(S,o&&x);(null==c?void 0:c.icon)&&(b=this.updateIconWithDynamicStyle(b,c.icon)),this.state.isHovered&&(null==h?void 0:h.icon)&&(b=this.updateIconWithDynamicStyle(b,h.icon))}const E=y?{type:u.styleConfig.themeStyle.quickStyleType}:{type:"default"};let I,D,w;d&&d.linkType&&(D=d.openType,w={linkType:d.linkType},d.linkType===t.LinkType.WebAddress?w.value=this.state.url:(w.value=d.value,I=this.props.queryObject));const T=null===(p=null==b?void 0:b.data)||void 0===p?void 0:p.properties,k=(null==T?void 0:T.isUploaded)?null==T?void 0:T.originalName:null==T?void 0:T.filename;let R=this.state.toolTip||g||k;const j=this.props.isRTL,M=null===(c=null==b?void 0:b.data)||void 0===c?void 0:c.svg,P=M&&(!b.position||b.position===e.Left)&&(0,t.jsx)(i.Icon,{icon:b.data.svg,className:(0,t.classNames)({"mr-2 ml-0":!!g&&!j,"ml-2 mr-0":!!g&&j,"mx-0":!g}),"aria-hidden":!0}),U=M&&b.position===e.Right&&(0,t.jsx)(i.Icon,{icon:b.data.svg,className:(0,t.classNames)({"ml-2 mr-0":!!g&&!j,"mr-2 ml-0":!!g&&j,"mx-0":!g}),"aria-hidden":!0});"_blank"===D&&(R=`${R}, ${this.props.intl.formatMessage({id:"openInNewWindow"})}`);const O=this.props.autoWidth&&this.props.autoHeight,L=b&&!g;return(0,t.jsx)(i.Link,Object.assign({to:w,target:D,queryObject:I,title:h,className:"widget-button-link text-truncate w-100 h-100 p-0 d-flex align-items-center justify-content-center",role:"button",customStyle:f},E,{css:v,"aria-label":R,onMouseEnter:()=>{this.setState({isHovered:!0})},onMouseLeave:()=>{this.setState({isHovered:!1})}}),(0,t.jsx)("span",{className:(0,t.classNames)("widget-button-text d-flex align-items-center justify-content-center",{"auto-size-icon":O&&L})},j?U:P,(0,t.jsx)("span",{className:"text-truncate"},g),j?P:U))},this.onClick=e=>{const i=(new Date).getTime();this.lastClickTimestamp&&i-this.lastClickTimestamp<200||(this.lastClickTimestamp=i,e.exbEventType="linkClick",t.MessageManager.getInstance().publishMessage(new t.ButtonClickMessage(this.props.id)))},this.onRegularDynamicStyleChange=e=>{this.setState({regularDynamicStyles:e})},this.onHoverDynamicStyleChange=e=>{this.setState({hoverDynamicStyles:e})},this.getDynamicActive=()=>((e,t,i)=>{var o,s;if(e&&t){const{widgetId:e,recordIndex:n}=t;if(e&&void 0!==n&&(null===(s=null===(o=null==i?void 0:i.previewRepeatedRecordInfo)||void 0===o?void 0:o[e])||void 0===s?void 0:s.recordIndex)!==n)return!1}return e})(this.props.isDynamicActive,this.props.repeatedDataSource,this.props.dynamicStyleState),this.state={text:this.getTextFromProps(),toolTip:(null===(n=null===(s=this.props.config)||void 0===s?void 0:s.functionConfig)||void 0===n?void 0:n.toolTip)||"",url:(null===(a=null===(l=null===(r=this.props.config)||void 0===r?void 0:r.functionConfig)||void 0===l?void 0:l.linkParam)||void 0===a?void 0:a.value)||"",textExpression:this.props.useDataSourcesEnabled&&this.getTextExpression(),tipExpression:this.props.useDataSourcesEnabled&&this.getTipExpression(),urlExpression:this.props.useDataSourcesEnabled&&this.getUrlExpression(),regularDynamicStyles:null,hoverDynamicStyles:null,isHovered:!1},this.domNode=t.React.createRef()}componentDidUpdate(e,i){var o,s;if(this.props.useDataSourcesEnabled||this.props.config===e.config&&!e.useDataSourcesEnabled||this.setState({text:this.getTextFromProps(),toolTip:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTip,url:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.value}),!this.props.useDataSourcesEnabled||this.props.config===e.config&&e.useDataSourcesEnabled||this.setState({textExpression:this.getTextExpression(),tipExpression:this.getTipExpression(),urlExpression:this.getUrlExpression()}),this.props.isDynamicActive!==e.isDynamicActive&&this.props.isDynamicActive&&this.props.repeatedDataSource){const e=this.props.repeatedDataSource,i=(null===(s=null===(o=this.props.dynamicStyleState)||void 0===o?void 0:o.previewRepeatedRecordInfo)||void 0===s?void 0:s[e.widgetId])||{};this.props.dispatch(t.appActions.changeDynamicStylePreviewRepeatedRecordInfo(e.widgetId,Object.assign(Object.assign({},i),{needUpdateRecordIndex:!0})))}}render(){var e,o,s,n,r,p,c,u;const d=this.props.useDataSourcesEnabled,g=this.getLinkComponent();return(0,t.jsx)("div",{className:"jimu-widget widget-button w-100 h-100",css:(this.props.theme,t.css`
    &>a {
      display: flex !important;
      justify-content: center;
      &.jimu-link-link {
        text-decoration: underline;
      }
    }

    .auto-size-icon {
      line-height: 1;
    }
    .widget-button-text{
        width: 100%;
        height: 100%;
    }
  `),ref:this.domNode,onClick:this.onClick,onTouchEnd:this.onClick,onKeyUp:e=>{" "!==e.key&&"Enter"!==e.key||this.onClick(e)}},g,(0,t.jsx)(i.Popper,{open:this.getDynamicActive(),offsetOptions:[0,4],css:t.css`
      white-space: nowrap;
      z-index: 12;
      background-color: var(--sys-color-info-dark);
      font-size: 12px;
      font-weight: 400;
      border: none;
      box-shadow: none;
      color: var(--sys-color-info-text);
  `,autoUpdate:!0,shiftOptions:l,flipOptions:a,reference:this.domNode,placement:"right-start"},(0,t.jsx)("div",{className:"pl-2 pr-2 pt-1 pb-1"},this.props.intl.formatMessage({id:"conditionalStylePreview",defaultMessage:i.defaultMessages.conditionalStylePreview}))),(0,t.jsx)("div",{style:{display:"none"}},d&&(0,t.jsx)("div",null,(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.textExpression,onChange:this.onTextExpResolveChange,widgetId:this.props.id}),(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.tipExpression,onChange:this.onTipExpResolveChange,widgetId:this.props.id}),(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.urlExpression,onChange:this.onUrlExpResolveChange,widgetId:this.props.id}))),(0,t.jsx)(t.DynamicStyleResolverComponent,{widgetId:this.props.widgetId,useDataSources:this.props.useDataSources,dynamicStyleConfig:null===(n=null===(s=null===(o=null===(e=this.props.config)||void 0===e?void 0:e.styleConfig)||void 0===o?void 0:o.customStyle)||void 0===s?void 0:s.regular)||void 0===n?void 0:n.dynamicStyleConfig,onChange:this.onRegularDynamicStyleChange}),(0,t.jsx)(t.DynamicStyleResolverComponent,{widgetId:this.props.widgetId,useDataSources:this.props.useDataSources,dynamicStyleConfig:null===(u=null===(c=null===(p=null===(r=this.props.config)||void 0===r?void 0:r.styleConfig)||void 0===p?void 0:p.customStyle)||void 0===c?void 0:c.hover)||void 0===u?void 0:u.dynamicStyleConfig,onChange:this.onHoverDynamicStyleChange}))}}p.mapExtraStateProps=(e,t)=>{var i,o,s,n;let r=!1;const l=e.appRuntimeInfo.selection;if(l&&e.appConfig.layouts[l.layoutId]){const i=e.appConfig.layouts[l.layoutId].content[l.layoutItemId];r=i&&i.widgetId===t.id}const a=e.appContext.isInBuilder&&r,p="number"==typeof(null===(s=null===(o=null===(i=e.dynamicStyleState)||void 0===i?void 0:i.previewConditionInfo)||void 0===o?void 0:o[t.id])||void 0===s?void 0:s.conditionId);return{active:a,appMode:e.appRuntimeInfo.appMode,queryObject:e.queryObject,isRTL:e.appContext.isRTL,browserSizeMode:e.browserSizeMode,uri:null===(n=e.appConfig.widgets[t.id])||void 0===n?void 0:n.uri,dynamicStyleState:e.dynamicStyleState,isDynamicActive:p}},p.versionManager=r;const c=p;function u(e){s.p=e}})(),n})())}}}));