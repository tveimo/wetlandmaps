System.register(["jimu-core","jimu-theme","jimu-ui","jimu-core/react","esri/widgets/FeatureTable/support/TableTemplate","esri/core/reactiveUtils","esri/widgets/FeatureTable","jimu-arcgis","jimu-layouts/layout-runtime","esri/geometry/Polygon"],(function(e,t){var n={},l={},a={},o={},i={},s={},r={},c={},d={},u={};return{setters:[function(e){n.AppMode=e.AppMode,n.BaseVersionManager=e.BaseVersionManager,n.CONSTANTS=e.CONSTANTS,n.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,n.DataSourceComponent=e.DataSourceComponent,n.DataSourceManager=e.DataSourceManager,n.DataSourceStatus=e.DataSourceStatus,n.DataSourceTypes=e.DataSourceTypes,n.Immutable=e.Immutable,n.JSAPILayerTypes=e.JSAPILayerTypes,n.MessageManager=e.MessageManager,n.MutableStoreManager=e.MutableStoreManager,n.QueryScope=e.QueryScope,n.React=e.React,n.ReactRedux=e.ReactRedux,n.ReactResizeDetector=e.ReactResizeDetector,n.ServiceManager=e.ServiceManager,n.SessionManager=e.SessionManager,n.WidgetState=e.WidgetState,n.appActions=e.appActions,n.appConfigUtils=e.appConfigUtils,n.classNames=e.classNames,n.css=e.css,n.dataSourceUtils=e.dataSourceUtils,n.defaultMessages=e.defaultMessages,n.esri=e.esri,n.focusElementInKeyboardMode=e.focusElementInKeyboardMode,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.jsx=e.jsx,n.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,n.lodash=e.lodash,n.polished=e.polished,n.privilegeUtils=e.privilegeUtils,n.useIntl=e.useIntl},function(e){l.Global=e.Global,l.useTheme=e.useTheme},function(e){a.AdvancedSelect=e.AdvancedSelect,a.Alert=e.Alert,a.Button=e.Button,a.DataActionList=e.DataActionList,a.DataActionListStyle=e.DataActionListStyle,a.Dropdown=e.Dropdown,a.DropdownButton=e.DropdownButton,a.DropdownItem=e.DropdownItem,a.DropdownMenu=e.DropdownMenu,a.Popper=e.Popper,a.Select=e.Select,a.Tab=e.Tab,a.Tabs=e.Tabs,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.WidgetPlaceholder=e.WidgetPlaceholder,a.defaultMessages=e.defaultMessages},function(e){o.Fragment=e.Fragment,o.useEffect=e.useEffect},function(e){i.default=e.default},function(e){s.watch=e.watch},function(e){r.default=e.default},function(e){c.JimuMapViewComponent=e.JimuMapViewComponent},function(e){d.LayoutItemSizeModes=e.LayoutItemSizeModes},function(e){u.default=e.default}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=l},4583:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path fill="#000" fill-rule="evenodd" d="M0 12v-1.5h1V12h1.5v1H1a1 1 0 0 1-1-1M1 1h1.5v1H1v1.5H0V2a1 1 0 0 1 1-1m0 7.5H0v-3h1zM4.5 2V1h3v1zm5 0V1H11a1 1 0 0 1 1 1v1.5h-1V2zm4.813 14.02-3.535-3.535-3.536 3.535-.707-.707 3.536-3.535-3.536-3.536.707-.707 3.536 3.536 3.535-3.536.707.707-3.535 3.536 3.535 3.535z" clip-rule="evenodd"></path></svg>'},4651:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2m5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0m6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0" clip-rule="evenodd"></path></svg>'},7835:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M.438 1C.196 1 0 1.224 0 1.5s.196.5.438.5h15.125c.241 0 .437-.224.437-.5s-.196-.5-.437-.5zM0 7.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 8 0 7.776 0 7.5M0 13.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 14 0 13.776 0 13.5"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},13440:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M2 1h16a1 1 0 0 1 1 1v5H1V2a1 1 0 0 1 1-1m11 7H7v3h6zm0 4H7v3h6zm1 3v-3h5v3zm-1 1H7v3h6zm1 3h4a1 1 0 0 0 1-1v-2h-5zm0-8V8h5v3zM1 8h5v3H1zm0 4h5v3H1zm0 4h5v3H2a1 1 0 0 1-1-1zM0 2a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2z" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=a},20904:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M15.88 2.825a.5.5 0 0 0-.759-.65l-2.323 2.71-1.265-1.265a.5.5 0 1 0-.707.707l1.265 1.265a1 1 0 0 0 1.466-.056zm0 8a.5.5 0 0 0-.759-.65l-2.323 2.71-1.265-1.265a.5.5 0 1 0-.707.708l1.265 1.264a1 1 0 0 0 1.466-.056zM9 4.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M8.5 13a.5.5 0 0 0 0-1h-8a.5.5 0 0 0 0 1z" clip-rule="evenodd"></path></svg>'},21935:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.986 1a6.99 6.99 0 0 1 5.723 2.969l-2.551-.938a.5.5 0 1 0-.345.938l4.228 1.555.163-.944.013-.005-.009-.019.6-3.471a.5.5 0 1 0-.985-.17l-.403 2.33A8 8 0 0 0 0 7.5c-.016.277.21.501.486.501a.53.53 0 0 0 .517-.5A7 7 0 0 1 7.986 1M8.015 15a6.99 6.99 0 0 1-5.724-2.969l2.551.938a.497.497 0 0 0 .642-.296.5.5 0 0 0-.297-.642L.96 10.476l-.163.944-.013.005.009.019-.6 3.471a.5.5 0 1 0 .985.17l.403-2.33A8 8 0 0 0 16 8.5a.477.477 0 0 0-.485-.501.53.53 0 0 0-.518.5A7 7 0 0 1 8.015 15"></path></svg>'},27964:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 4.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M16 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 .5.5M5.146 2.12a.5.5 0 0 1 .055.705l-2.324 2.71a1 1 0 0 1-1.466.057L.146 4.327a.5.5 0 0 1 .708-.707l1.264 1.265 2.323-2.71a.5.5 0 0 1 .705-.055M5.146 10.12a.5.5 0 0 1 .055.705l-2.324 2.71a1 1 0 0 1-1.466.057L.146 12.328a.5.5 0 1 1 .708-.708l1.264 1.265 2.323-2.71a.5.5 0 0 1 .705-.055" clip-rule="evenodd"></path></svg>'},31526:e=>{"use strict";e.exports=u},41496:e=>{"use strict";e.exports=d},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},49419:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M16 0H0v1h16z"></path><path fill="#000" fill-rule="evenodd" d="M5 11a3 3 0 1 0 6 0 3 3 0 0 0-6 0m3 2a2 2 0 1 0 0-4 2 2 0 0 0 0 4" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M8 6q3.874 0 7.75 4.349a.97.97 0 0 1 0 1.302Q11.874 16.001 8 16T.25 11.651a.97.97 0 0 1 0-1.302Q4.126 5.999 8 6m0 1c-2.237 0-4.558 1.303-6.961 4 2.403 2.698 4.724 4 6.96 4 2.238 0 4.559-1.303 6.962-4C12.558 8.303 10.237 7 8 7" clip-rule="evenodd"></path><path fill="#000" d="M0 3h13v1H0zM3 6H0v1h3z"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},59374:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M2 1h16a1 1 0 0 1 1 1v5H1V2a1 1 0 0 1 1-1m11 7H7v3h6zm0 4H7v3h6zm1 3v-3h5v3zm-1 1H7v3h6zm1 3h4a1 1 0 0 0 1-1v-2h-5zm0-8V8h5v3zM1 8h5v3H1zm0 4h5v3H1zm0 4h5v3H2a1 1 0 0 1-1-1zM0 2a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2z" clip-rule="evenodd"></path></svg>'},62243:e=>{"use strict";e.exports=s},62686:e=>{"use strict";e.exports=c},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},65959:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13 1v1.5h-.058L7.944 7.689v7.821c0 .27-.207.49-.464.49a.45.45 0 0 1-.325-.14l-2.1-2.18V7.681L.066 2.5H0V1zm-.929.98H.93v.041l5.055 5.25v5.998l1.031 1.071V7.278l5.056-5.25z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M10.359 14.118 9 14.878v-1.146l.75-.42v-3.52l-.75.42V9.066l1.402-.785 2.049 1.331L15.25 8v5.825l-2.906 1.626zM10.75 9.7v3.476l1.25.84v-3.504zm2.25.75 1.25-.72v3.508l-1.25.7z" clip-rule="evenodd"></path></svg>'},68972:e=>{"use strict";e.exports=o},71758:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=n},92799:e=>{"use strict";e.exports=r},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'}},t={};function v(n){var l=t[n];if(void 0!==l)return l.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,v),a.exports}v.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return v.d(t,{a:t}),t},v.d=(e,t)=>{for(var n in t)v.o(t,n)&&!v.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},v.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},v.p="";var p={};return v.p=window.jimuConfig.baseUrl,(()=>{"use strict";v.r(p),v.d(p,{__set_webpack_public_path__:()=>wt,default:()=>St});var e,t,n,l,a,o,i,s=v(79244);!function(e){e.Layer="LAYER",e.Map="MAP"}(e||(e={})),function(e){e.Dropdown="DROPDOWN",e.Tabs="TABS"}(t||(t={})),function(e){e.Start="start",e.Center="center",e.End="end"}(n||(n={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE"}(l||(l={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(a||(a={})),function(e){e.Fit="FIT",e.Fixed="FIXED"}(o||(o={})),function(e){e.View="VIEW",e.Add="ADD"}(i||(i={}));class r extends s.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.6.0",description:"Add editable to table fields.",upgrader:(e,t)=>{let n=e;return 0===n.layersConfig.length||n.layersConfig.forEach(((e,t)=>{const l=e.tableFields.map((e=>Object.assign(Object.assign({},e),{editAuthority:!0})));n=n.setIn(["layersConfig",t,"tableFields"],l)})),n}},{version:"1.10.0",description:"Add visible to table fields.",upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach(((e,n)=>{const l=e.tableFields.map((e=>Object.assign(Object.assign({},e),{visible:!0})));t=t.setIn(["layersConfig",n,"tableFields"],l)})),t}},{version:"1.12.0",description:"Add header setting options.",upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach(((e,n)=>{e=e.set("headerFontSetting",{backgroundColor:"",fontSize:14,bold:!1,color:""}),t=t.setIn(["layersConfig",n],e)})),t}},{version:"1.13.0",description:'Add "showCount" and "updateText" options.',upgrader:e=>{let t=e;return 0===t.layersConfig.length||t.layersConfig.forEach(((e,n)=>{if(e=e.set("showCount",!1).set("updateText",!0),t=t.setIn(["layersConfig",n],e),(null==e?void 0:e.searchFields)&&"string"==typeof(null==e?void 0:e.searchFields)){const l=e.searchFields.split(",")||[];t=t.setIn(["layersConfig",n,"searchFields"],l)}else(null==e?void 0:e.searchFields)||(t=t.setIn(["layersConfig",n,"searchFields"],[]))})),t}},{version:"1.14.0",description:"Update honor webmap options",upgrader:e=>{let t=e;const n=t.layersConfig.map((e=>Object.assign(Object.assign({},e),{layerHonorMode:a.Custom})));return t=t.setIn(["layersConfig"],n),t}},{version:"1.15.0",description:"Update column setting",upgrader:e=>{let t=e;const n=t.layersConfig.map((e=>Object.assign(Object.assign({},e),{columnSetting:{responsiveType:o.Fixed,columnWidth:200}})));return t=t.setIn(["layersConfig"],n),t}},{version:"1.16.0",description:"Modify a property spelling error",upgrader:t=>{let n=t;const l=n.layersConfig.map((e=>{const t=e.enableAttachements,n=Object.assign(Object.assign({},e),{enableAttachments:t});return delete n.enableAttachements,n}));return n=n.setIn(["layersConfig"],l).setIn(["tableMode"],e.Layer),n}}]}}const c=new r;var d=v(1888),u=v(62838),m=v.n(u),g=function(e,t){var n={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(l=Object.getOwnPropertySymbols(e);a<l.length;a++)t.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(e,l[a])&&(n[l[a]]=e[l[a]])}return n};const h=e=>{const t=window.SVG,{className:n}=e,l=g(e,["className"]),a=(0,s.classNames)("jimu-icon jimu-icon-component",n);return t?s.React.createElement(t,Object.assign({className:a,src:m()},l)):s.React.createElement("svg",Object.assign({className:a},l))};var f=v(14321);const b=e=>{const{allLayersConfig:t,isHorizontalTab:n,activeTabId:l,searchOn:a,toolListNode:o,onTabClick:i,onCloseTab:r}=e;return(0,s.jsx)("div",{className:"d-flex table-tab-select "+(n?"horizontal-tab-select":"dropdown-tab-select"),css:s.css`
  &.table-tab-select{
    .horizontal-tab-select{
      margin-bottom: 4px;
      .activeBtn{
        color: #fff;
        background-color: #076fe5;
      }
    }
    .dropdown-tab-select{
      height: 40px;
      margin-bottom: 4px;
      .dropdown-button{
        height: 32px;
      }
    }
    .tab-flex{
      width: 100%;
      overflow-x: auto;
      .closeable{
        height: 31px;
      }
    }
  }
`},n?(0,s.jsx)(f.Tabs,{scrollable:!0,type:"underline",className:"tab-flex",value:l,onChange:i,onClose:r},t.map((e=>{const t=!!e.dataActionObject;return(0,s.jsx)(f.Tab,{key:e.id,id:e.id,title:e.name,className:"text-truncate",closeable:t},(0,s.jsx)("div",{className:"mt-2"}))}))):(0,s.jsx)(f.Select,{size:"sm",value:l,onChange:e=>{var t;i(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)},className:"top-drop"},t.map((e=>(0,s.jsx)("option",{key:e.id,value:e.id,title:e.name},(0,s.jsx)("div",{className:"table-action-option"},(0,s.jsx)("div",{className:"table-action-option-tab",title:e.name},e.name),e.dataActionObject&&(0,s.jsx)("div",{className:"table-action-option-close"},(0,s.jsx)(f.Button,{size:"sm",icon:!0,type:"tertiary",onClick:t=>{r(e.id,t)}},(0,s.jsx)(h,{size:"s"})))))))),!a&&o)},y={_widgetLabel:"Table",_widgetDescription:"This is an interactive table widget",showAllRecords:"Show all records",showHideCols:"Show/hide columns",toggleSelect:"Show selection/all",_action_viewInTable_label:"View in table",tableDataActionLabel:"{layer} table selection",tableCount:"Total: {total} | Selection: {selected}",_action_addToTable_label:"Add to table",deleteRecords:"Delete selection",enableMapExtentFilter:"Filter by the connected map extent",openSearch:"Open search",closeSearch:"Close search"};var S=v(50170),w=v.n(S),x=function(e,t){var n={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(l=Object.getOwnPropertySymbols(e);a<l.length;a++)t.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(e,l[a])&&(n[l[a]]=e[l[a]])}return n};const j=e=>{const t=window.SVG,{className:n}=e,l=x(e,["className"]),a=(0,s.classNames)("jimu-icon jimu-icon-component",n);return t?s.React.createElement(t,Object.assign({className:a,src:w()},l)):s.React.createElement("svg",Object.assign({className:a},l))};var R=v(96300),I=v.n(R),O=function(e,t){var n={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(l=Object.getOwnPropertySymbols(e);a<l.length;a++)t.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(e,l[a])&&(n[l[a]]=e[l[a]])}return n};const T=e=>{const t=window.SVG,{className:n}=e,l=O(e,["className"]),a=(0,s.classNames)("jimu-icon jimu-icon-component",n);return t?s.React.createElement(t,Object.assign({className:a,src:I()},l)):s.React.createElement("svg",Object.assign({className:a},l))},C=e=>s.css`
  &.table-search-div{
    .table-search{
      .search-icon{
        z-index: 2;
      }
      .search-input{
        border: 1px solid ${e.ref.palette.neutral[500]};
        border-radius: 2px;
        .input-wrapper{
          height: 30px;
          border: none;
        }
      }
    }
  }
`,E=e=>{const{searchToolTowed:t,hint:n,tableLoaded:l,searchText:a,handleSearchChange:o,closeSuggestionAndSearch:i,closeSuggestion:r}=e,[c,u]=s.React.useState(!1),v=s.React.useRef(),p=s.hooks.useTranslation(y,s.defaultMessages),m=(0,d.useTheme)(),g=n||p("search"),h=e=>{e&&e.target&&"Enter"===e.key&&i()},b=()=>(0,s.jsx)(j,{color:m.ref.palette.neutral[700]});return(0,s.jsx)("div",{className:"table-search-div",css:C(m)},t?(0,s.jsx)("div",{className:"table-search-popper"},(0,s.jsx)(f.Button,{type:"tertiary",icon:!0,size:"sm",className:"tools-menu",title:p("openSearch"),"aria-label":p("openSearch"),onClick:e=>{u(!c)},ref:v},(0,s.jsx)(j,null)),(0,s.jsx)(f.Popper,{placement:"right-start",reference:v.current,offsetOptions:[-10,-30],open:c,arrowOptions:!1,hideOptions:!1},(0,s.jsx)("div",{className:"d-flex align-items-center table-popup-search m-2"},(0,s.jsx)(f.Button,{type:"tertiary",icon:!0,size:"sm",onClick:e=>{r(),u(!1),(0,s.focusElementInKeyboardMode)(v.current,!0)},className:"search-back mr-1",title:p("closeSearch"),"aria-label":p("closeSearch")},(0,s.jsx)(T,{color:m.ref.palette.neutral[1100]})),(0,s.jsx)(f.TextInput,{className:"popup-search-input",placeholder:g,onChange:e=>{o(e.target.value)},value:a||"",onKeyDown:e=>{h(e)},prefix:b(),allowClear:!0,title:g,disabled:!l,"aria-label":g})))):(0,s.jsx)("div",{className:"d-flex align-items-center table-search"},(0,s.jsx)(f.TextInput,{className:"search-input",placeholder:g,onChange:e=>{o(e.target.value)},value:a||"",onKeyDown:e=>{h(e)},prefix:b(),allowClear:!0,title:g,disabled:!l,"aria-label":g})))};function D(e,t,n,l){const{id:a,isHeightAuto:o,isWidthAuto:i,headerFontSetting:r,widgetWidth:c}=l;return s.css`
    ${"&.table-widget-"+a} {
      .hide-table{
        display: none;
      }
      .table-indent{
        width: calc(100% - 32px);
        height: calc(100% - 26px);
        margin: 10px 16px 16px;
        display: inline-block;
        ${o&&"min-height: 190px;"};
        ${i&&"min-width: 360px;"};
        .horizontal-action-dropdown{
          button{
            width: 32px;
            height: 32px;
          }
        }
        .tool-dividing-line{
          height: 16px;
          width: 1px;
          display: inline-flex;
          background-color: ${e.ref.palette.neutral[500]};
          margin: 8px 4px;
        }
        .data-action-btn{
          position: relative;
        }
      }
      .tab-title{
        user-select: none;
        margin: auto;
      }
      .tab-flex{
        width: 100%;
        overflow-x: auto;
        .closeable{
          height: 31px;
        }
      }
      .top-drop{
        width: 30%;
        min-width: 150px;
        button{
          line-height: 1.5;
        }
      }
      .nav-underline{
        height: 32px;
        border-bottom: 1px solid ${e.ref.palette.neutral[400]};
        .nav-item{
          height: 31px;
          max-width: calc(${c/2}px - ${t?"40px":"120px"});
        }
      }
      .nav-item + .nav-item{
        margin-left: 0;
      }
      .csv-dropdown-con{
        button{
          border-radius: 13px;
        }
      }
      .vertical-tab-select{
        width: 20%;
        display: inline-block;
        .tagBtn{
          width: 100%;
        }
      }
      .horizontal-tab-select{
        .tagBtn{
          width: 150px;
        }
        .tab-content{
          height: 8px;
        }
      }
      .vertical-tab-select,
      .horizontal-tab-select{
        margin-bottom: 4px;
        .activeBtn{
          color: #fff;
          background-color: #076fe5;
        }
      }
      .dropdown-tab-select{
        height: 40px;
        margin-bottom: 4px;
        .dropdown-button{
          height: 32px;
        }
      }
      .vertical-render-con{
        width: 80%;
        position: absolute;
        left: 20%;
        height: 100%;
        top: 0;
      }
      .dropdown-render-con,
      .horizontal-render-con{
        width: 100%;
        height: calc(100% - 45px);
      }
      .mobile-map-button{
        display: inline-flex;
        button{
          width: 32px;
          height: 32px;
        }
      }
      .table-header{
        height: ${n?"40px":"0"};
        width: 100%;
        display: flex;
        justify-content: space-between;
      }
      .table-con{
        width: 100%;
        height: ${n?"calc(100% - 40px);":"100%"};
        .esri-widget{
          background-color: transparent;
          vaadin-grid-cell-content:has(.esri-column__header-content) {
            ${(null==r?void 0:r.backgroundColor)&&`background-color: ${r.backgroundColor};`}
            ${(null==r?void 0:r.fontSize)&&`font-size: ${r.fontSize}px;`}
            ${(null==r?void 0:r.bold)&&"font-weight: bold;"}
            ${(null==r?void 0:r.color)&&`color: ${r.color};`}
            ${function(e){const t=[];e&&(e.backgroundColor&&(t.push(`--calcite-color-foreground-1: ${e.backgroundColor};`),t.push("--calcite-color-foreground-2: #0000000a;"),t.push("--calcite-color-foreground-3: #0000000a;")),e.color&&(t.push(`--calcite-color-text-3: ${e.color};`),t.push(`--calcite-color-text-1: ${e.color};`)),e.fontSize&&t.push(`--calcite-font-size--2: ${e.fontSize};`),e.bold&&t.push("--calcite-ui-text-3: bold;"));return t.join(" ")}(r)}
            .esri-column__header-content {
              ${(null==r?void 0:r.bold)&&"font-weight: bold;"}
            }
          }
        }
        .esri-grid .esri-column__sorter{
          overflow-x: auto;
          overflow-y: hidden;
        }
        .esri-field-column__header-content{
          width: calc(100% - 26px);
          overflow: unset;
        }
        .esri-feature-table__loader-container{
          position: absolute;
          left: 50%;
          top: 50%;
          margin-left: -16px;
          margin-top: -20px;
          z-index: 2;
        }
        .esri-feature-table__content{
          min-height: 145px;
        }
      }
      .table-bottom-info {
        position: absolute;
        width: 100%;
        left: 0;
        bottom: 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .adv-select-con{
        width: 200px;
        visibility: hidden;
        position: absolute;
        right: 17px;
        top: 56px;
      }
      .ds-container{
        position: absolute;
        display: none;
      }
      .dropdown-button-content{
        .table-action-option-close{
          display: none;
        }
      }
    }
  `}var A=v(68972);(0,s.Immutable)([s.DataSourceTypes.FeatureLayer,s.DataSourceTypes.SceneLayer,s.DataSourceTypes.BuildingComponentSubLayer,s.DataSourceTypes.OrientedImageryLayer,s.DataSourceTypes.ImageryLayer,s.DataSourceTypes.SubtypeSublayer]),(0,s.Immutable)([s.DataSourceTypes.WebMap,s.DataSourceTypes.WebScene,s.DataSourceTypes.MapService,s.DataSourceTypes.FeatureService,s.DataSourceTypes.SceneService,s.DataSourceTypes.GroupLayer,s.DataSourceTypes.BuildingGroupSubLayer,s.DataSourceTypes.BuildingSceneLayer,s.DataSourceTypes.SubtypeGroupLayer]);const M=[s.JSAPILayerTypes.FeatureLayer,s.JSAPILayerTypes.SceneLayer,s.JSAPILayerTypes.BuildingComponentSublayer,s.JSAPILayerTypes.OrientedImageryLayer,s.JSAPILayerTypes.ImageryLayer,s.JSAPILayerTypes.SubtypeSublayer];function N(e){if(!e||!e.type)return!1;const t=e.type,n=t!==s.JSAPILayerTypes.BuildingComponentSublayer||t===s.JSAPILayerTypes.BuildingComponentSublayer&&e.view,l=M.includes(t);return n&&l}const L=e=>s.DataSourceManager.getInstance().getDataSource(e);function F(e,t,n){const l=n||"jimuName",a=e.length>t.length,o=a?t:e;return(a?e:t).filter((e=>!o.some((t=>(null==t?void 0:t[l])===(null==e?void 0:e[l])))))}var P=v(71758),_=function(e,t,n,l){return new(n||(n=Promise))((function(a,o){function i(e){try{r(l.next(e))}catch(e){o(e)}}function s(e){try{r(l.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}r((l=l.apply(e,t||[])).next())}))};const V=s.DataSourceManager.getInstance();function k(e){return s.dataSourceUtils.getTimezoneAPIFromRuntime(e.getTimezone())}const z=(e,t)=>{const n=((null==e?void 0:e.fields)||[]).find((e=>e.name===t));return!n||(null==n?void 0:n.editable)},B=(e,t)=>{let n=[];const l=Object.keys(e||{});return(null==t?void 0:t.length)>=(null==l?void 0:l.length)?n=t.filter((e=>l.includes(e.name||e.alias))).map((t=>{var n;return Object.assign(Object.assign({},t),{format:null===(n=null==e?void 0:e[t.name])||void 0===n?void 0:n.format})})):l.forEach((l=>{const a=e[l],o=t.find((e=>e.name===l));n.push(Object.assign(Object.assign({},a),o))})),n},H=(e,t,i,r)=>{var c,d,u;const v=e.getSchema(),p=null==e?void 0:e.getLayerDefinition(),m=(null==v?void 0:v.fields)?Object.values(null==v?void 0:v.fields):[],g=(null==p?void 0:p.fields)||[];let h=m.map((e=>{const t=g.find((t=>t.name===e.jimuName)),n=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:n,editable:n,visible:!0})}));const f=null===(c=null==e?void 0:e.getPopupInfo())||void 0===c?void 0:c.fieldInfos;if("output"!==e.dataViewId&&f&&(null==f?void 0:f.length)>0){const e=[];f.forEach((t=>{(null==t?void 0:t.visible)&&e.push(t.fieldName)})),h=h.filter((t=>e.includes(t.name)))}(null==h?void 0:h.length)>50&&(h=h.slice(0,50));const b={dataSourceId:e.id,mainDataSourceId:null===(d=e.getMainDataSource())||void 0===d?void 0:d.id,dataViewId:e.dataViewId,rootDataSourceId:null===(u=e.getRootDataSource())||void 0===u?void 0:u.id},y=(0,s.Immutable)(b),S=h.map((e=>e.jimuName)),w=y.set("fields",S);return{id:t?e.id:i?i(e.id):e.id,name:e.getLabel(),useDataSource:w.asMutable({deep:!0}),allFields:m,tableFields:h,enableAttachments:!1,enableEdit:!1,allowCsv:!1,enableSearch:!1,searchFields:[],enableRefresh:!0,enableShowHideColumn:!0,enableSelect:!0,enableDelete:!1,selectMode:l.Single,showCount:!0,headerFontSetting:{backgroundColor:"",fontSize:14,bold:!1,color:""},columnSetting:{responsiveType:o.Fixed,columnWidth:200,wrapText:!1,textAlign:n.Start},layerHonorMode:a.Webmap,parentViewId:r}},G=e=>{const{searchToolTowed:t,curLayerConfig:n,dataSource:l,tableLoaded:a,widgetState:o,toolListNode:i,handleSubmit:r}=e,[c,d]=s.React.useState(),[u,v]=s.React.useState(!1),[p,m]=s.React.useState([]),g=s.React.useRef(null),h=s.React.useRef(),b=s.ReactRedux.useSelector((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode})),y=s.ReactRedux.useSelector((e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.currentPageId})),S=new(0,s.esri.Sanitizer),w=s.React.useCallback((()=>{if((null==c?void 0:c.length)<3)return!1;(function(e,t,n){return _(this,void 0,void 0,(function*(){const l={searchText:e,searchFields:(null==t?void 0:t.searchFields)||[],dataSource:n,exact:null==t?void 0:t.searchExact};return s.dataSourceUtils.querySuggestions(l)}))})(c,n,l).then((e=>{m(e)}))}),[c,n,l]);(0,A.useEffect)((()=>(c?(clearTimeout(h.current),h.current=setTimeout((()=>{w()}),200)):r(""),()=>{clearTimeout(h.current)})),[c,u,r,w]),(0,A.useEffect)((()=>{const e=o===s.WidgetState.Closed,t=b===s.AppMode.Design;(e||t)&&(d(""),v(!1))}),[o,b]),(0,A.useEffect)((()=>{v(!1)}),[y]);return(0,s.jsx)("div",{className:"table-header",ref:g,css:s.css`
  &.table-header{
    height: 40px;
    width: 100%;
    display: flex;
    justify-content: space-between;
  }
`},(0,s.jsx)(E,{searchToolTowed:t,hint:null==n?void 0:n.searchHint,tableLoaded:a,searchText:c,handleSearchChange:e=>{e?(d(e),v((null==e?void 0:e.length)>2)):(d(e),v(!1),m([]))},closeSuggestionAndSearch:()=>{v(!1),r(c)},closeSuggestion:()=>{v(!1)}}),(0,s.jsx)(f.Popper,{css:s.css`
    & {
      max-height: ${s.polished.rem(300)};
      min-width: ${s.polished.rem(200)};
      overflow: auto;
    }
    button {
      display: block;
      width: 100%;
      text-align: left;
      border: none;
      border-radius: 0;
    }
    button:hover {
      border: none;
    }
  `,placement:"bottom-start",reference:g,offsetOptions:[0,-2],open:u,trapFocus:!1,autoFocus:!1,toggle:()=>{v(!u)},hideOptions:!1},p.map(((e,t)=>{const n=S.sanitize(e.suggestionHtml);return(0,s.jsx)(f.Button,{key:t,type:"secondary",size:"sm",onClick:()=>{(e=>{d(e),v(!1),r(e)})(e.suggestion)}},(0,s.jsx)("div",{className:"w-100",dangerouslySetInnerHTML:{__html:n}}))}))),i)},U=e=>s.css`
    &.placeholder-table-con{
      height: ${e?"calc(100% - 40px)":"100%"};
      width: 100%;
      position: relative;
      .jimu-widget-placeholder{
        width: 100%;
      }
      .placeholder-alert-con{
        position: absolute;
        right: 10px;
        bottom: 10px;
      }
    }
  `,W=e=>{const{searchOn:t,notReady:n,dataSourceLabel:l,widgetLabel:a}=e,o=s.hooks.useTranslation(y,f.defaultMessages);return(0,s.jsx)("div",{className:"placeholder-table-con",css:U(t)},(0,s.jsx)(f.WidgetPlaceholder,{icon:v(59374),name:o("noData")}),n&&(0,s.jsx)("div",{className:"placeholder-alert-con"},(0,s.jsx)(f.Alert,{form:"tooltip",size:"small",type:"warning",text:o("outputDataIsNotGenerated",{outputDsLabel:l,sourceWidgetName:a})})))};var $=v(62243);const J=e=>{var t,n,l;return s.css`
  &.table-count{
    height: 16px;
    .total-count-text{
      background: ${s.polished.rgba(null===(n=null===(t=null==e?void 0:e.ref.palette)||void 0===t?void 0:t.neutral)||void 0===n?void 0:n[200],.65)};
      color: ${null===(l=e.ref.palette)||void 0===l?void 0:l.black};
      font-size: 12px;
      line-height: 16px;
      padding: 0 7px;
    }
  }
`},Q=e=>{var t;const{table:n,showCount:l,onSelectedChange:a}=e,[o,i]=s.React.useState((null==n?void 0:n.size)||0),[r,c]=s.React.useState((null===(t=null==n?void 0:n.highlightIds)||void 0===t?void 0:t.length)||0),u=(0,s.useIntl)(),v=s.React.useMemo((()=>u.formatNumber(o,{useGrouping:!0})),[u,o]),p=s.React.useMemo((()=>u.formatNumber(r,{useGrouping:!0})),[u,r]);s.React.useEffect((()=>{const e=$.watch((()=>null==n?void 0:n.size),(e=>{i(e||0)}),{initial:!0,sync:!0}),t=$.watch((()=>{var e;return null===(e=null==n?void 0:n.highlightIds)||void 0===e?void 0:e.length}),(e=>{c(e||0),a(e||0)}),{initial:!0,sync:!0});return()=>{null==e||e.remove(),null==t||t.remove()}}),[a,n]);const m=(0,d.useTheme)(),g=s.hooks.useTranslation(y);return(0,s.jsx)(s.React.Fragment,null,l&&(0,s.jsx)("div",{className:"table-count d-flex align-items-center",css:J(m)},(0,s.jsx)("div",{className:"flex-grow-1 total-count-text text-truncate"},g("tableCount",{total:v,selected:p}))))};var q=v(45508),X=v.n(q),K=function(e,t){var n={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(l=Object.getOwnPropertySymbols(e);a<l.length;a++)t.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(e,l[a])&&(n[l[a]]=e[l[a]])}return n};const Y=e=>{const t=window.SVG,{className:n}=e,l=K(e,["className"]),a=(0,s.classNames)("jimu-icon jimu-icon-component",n);return t?s.React.createElement(t,Object.assign({className:a,src:X()},l)):s.React.createElement("svg",Object.assign({className:a},l))},Z=6e4,ee=(e,t)=>{var n,l,a;return s.css`
  &.refresh-loading-con {
    height: 16px;
    .auto-refresh-loading {
      background: ${s.polished.rgba(null===(l=null===(n=null==e?void 0:e.ref.palette)||void 0===n?void 0:n.neutral)||void 0===l?void 0:l[200],.65)};
      color: ${null===(a=e.ref.palette)||void 0===a?void 0:a.black};
      font-size: ${s.polished.rem(12)};
      line-height: ${s.polished.rem(16)};
      ${!t&&`padding: 0 ${s.polished.rem(7)};`}
      .icon-btn{
        padding: ${s.polished.rem(1)};
      }
    }
  }
`},te=e=>{const{showLoading:t,interval:n,isMobile:l,bottomResponsive:a,refreshTime:o}=e,i=s.hooks.useTranslation(f.defaultMessages),[r,c]=s.React.useState(i("lastUpdateAFewTime")),u=s.React.useRef(0),v=s.React.useCallback((()=>{let e=i("lastUpdateAFewTime");const t=(new Date).getTime()-o;return t>Z&&t<=12e4?e=i("lastUpdateAMinute"):t>12e4&&(e=i("lastUpdateTime",{updateTime:Math.floor(t/Z)})),e}),[o,i]);s.React.useEffect((()=>(n<=0?(c(i("lastUpdateAFewTime")),window.clearInterval(u.current),u.current=null):(c(i("lastUpdateAFewTime")),u.current=window.setInterval((()=>{c(v())}),Z)),()=>{window.clearInterval(u.current),u.current=null})),[n,v,i]);const p=(0,d.useTheme)();return(0,s.jsx)("div",{className:"refresh-loading-con d-flex align-items-center",css:ee(p,l)},t&&(0,s.jsx)("div",{className:"loading-con"}),n>0&&(0,s.jsx)("div",{className:"flex-grow-1 auto-refresh-loading text-truncate",title:a?"":r},a?(0,s.jsx)(f.Tooltip,{title:r,showArrow:!0,placement:"top-end"},(0,s.jsx)(f.Button,{icon:!0,size:"sm",type:"tertiary",className:"d-inline jimu-outline-inside border-0 p-0"},(0,s.jsx)(Y,{size:14}))):r))};var ne,le,ae,oe,ie,se,re,ce,de,ue=v(92799);!function(e){e.Small="SMALL",e.Medium="MEDIUM",e.Large="LARGE"}(ne||(ne={})),function(e){e.String="STRING",e.Number="NUMBER",e.Date="DATE",e.DateOnly="DATE_ONLY",e.TimeOnly="TIME_ONLY"}(le||(le={})),function(e){e.BigInteger="esriFieldTypeBigInteger",e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.DateOnly="esriFieldTypeDateOnly",e.TimeOnly="esriFieldTypeTimeOnly",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(ae||(ae={})),function(e){e.Fetching="FETCHING",e.Success="SUCCESS",e.Error="ERROR"}(oe||(oe={})),function(e){e.Design="DESIGN",e.Run="RUN",e.Express="EXPRESS"}(ie||(ie={})),function(e){e.Opened="OPENED",e.Active="ACTIVE",e.Closed="CLOSED",e.Hidden="HIDDEN"}(se||(se={})),function(e){e.None="NONE",e.Page="PAGE",e.Dialog="DIALOG",e.View="VIEW",e.WebAddress="WEB_ADDRESS",e.Block="BLOCK",e.Screen="SCREEN",e.PageTop="PAGE_TOP",e.PrintPreview="PRINT_PREVIEW",e.CookieBanner="COOKIE_BANNER"}(re||(re={})),function(e){e.CurrentWindow="_self",e.TopWindow="_top",e.NewWindow="_blank"}(ce||(ce={})),function(e){e.Normal="NORMAL",e.Layout="LAYOUT"}(de||(de={}));var ve,pe;!function(e){e.Header="HEADER",e.Footer="FOOTER",e.Body="BODY"}(ve||(ve={})),function(e){e.Http="http:",e.Https="https:"}(pe||(pe={}));var me,ge;!function(e){e.Image="IMAGE",e.Config="CONFIG"}(me||(me={})),function(e){e.EXB_DATA_SOURCE_ID_SET_TO_CREATED_JS_API_LAYER="_exb_data_source_id_set_to_created_js_api_layer",e.EXB_OID="_exb_oid",e.EXB_NOT_EDITABLE="_exb_not_editable",e.EXB_DATA_SOURCE="__exb_data_source",e.EXB_DATA_SET="__exb_data_set",e.EXB_LAYER_VIEW_IGNORE_SPATIAL_FILTER="__exb_layer_view_ignore_spatial_filter",e.EXB_LAYER_FROM_RUNTIME="__exb_layer_from_runtime",e.EXB_DATA_SOURCE_ID="__exb_data_source_id",e.EXB_JIMU_LAYER_VIEW_ID="__exb_jimu_layer_view_id",e.EXB_PREDEFINED_RENDERER="__exb_predefined_renderer"}(ge||(ge={}));const he={};he[ne.Large]=[{width:1024,height:768},{width:1280,height:800},{width:1280,height:1024},{width:1366,height:768},{width:1440,height:900},{width:1536,height:864},{width:1600,height:900},{width:1920,height:1080}],he[ne.Medium]=[{width:601,height:962},{width:600,height:1024},{width:768,height:1024},{width:800,height:1280},{width:834,height:1112}],he[ne.Small]=[{width:360,height:640},{width:360,height:720},{width:360,height:740},{width:375,height:667},{width:414,height:736}];const fe="selection";var be=function(e,t,n,l){return new(n||(n=Promise))((function(a,o){function i(e){try{r(l.next(e))}catch(e){o(e)}}function s(e){try{r(l.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}r((l=l.apply(e,t||[])).next())}))};const ye=e=>{var t,i,r,c,d,u,v,p,m;const{dataInvalid:g,layerConfig:h,activeView:f,enableAttachments:b,enableRelatedRecords:y,tableContainer:S,canEditFeature:w,selectQueryFlag:x,tableShowColumns:j,dataActionRecords:R,selectionViewIds:I,maxCount:O,sourceVersion:T,isMapMode:C,tableSelectAsyncDs:E,isSelfEditing:D,activeTabId:A}=e,[M,N]=s.React.useState(),[V,H]=s.React.useState(!1),[G,U]=s.React.useState(!1),[W,J]=s.React.useState(!1),[Q,q]=s.React.useState(!1),[X,K]=s.React.useState(null),Y=s.React.useRef(null),Z=s.React.useRef(null),ee=s.React.useRef(null),te=s.React.useRef(null),ne=s.React.useRef(null),le=s.React.useRef(null),ae=s.React.useRef(null),oe=s.React.useRef(""),ie=(e=>{const t=(null==e?void 0:e.type)===s.DataSourceTypes.SceneLayer||(null==e?void 0:e.type)===s.DataSourceTypes.BuildingComponentSubLayer;let n;return null==e||e.type,s.DataSourceTypes.OrientedImageryLayer,null==e||e.type,s.DataSourceTypes.ImageryLayer,n=t?e.getAssociatedDataSource():e,n})(L((null===(t=null==h?void 0:h.useDataSource)||void 0===t?void 0:t.dataSourceId)||(null===(i=null==h?void 0:h.dataActionDataSource)||void 0===i?void 0:i.id))),se=null===(r=null==ie?void 0:ie.getInfo())||void 0===r?void 0:r.status,re=s.hooks.usePrevious(se)!==s.DataSourceStatus.Unloaded&&se===s.DataSourceStatus.Unloaded,ce="output"===(null==ie?void 0:ie.dataViewId)&&re,de=s.React.useCallback((()=>{var e,t,n,l,a;(null===(e=ne.current)||void 0===e?void 0:e.remove)&&ne.current.remove(),(null===(t=le.current)||void 0===t?void 0:t.remove)&&le.current.remove(),(null===(n=Z.current)||void 0===n?void 0:n.remove)&&Z.current.remove(),(null===(l=ee.current)||void 0===l?void 0:l.remove)&&ee.current.remove(),(null===(a=te.current)||void 0===a?void 0:a.remove)&&te.current.remove(),Y.current&&!Y.current.destroyed&&(Y.current.destroy(),Y.current=null),S.current&&(S.current.innerHTML="")}),[S]);s.React.useEffect((()=>()=>{de()}),[de]),s.React.useEffect((()=>{oe.current!==(null==ie?void 0:ie.id)&&(N(void 0),Y.current&&de())}),[null==ie?void 0:ie.id,A,de]),s.React.useEffect((()=>{if(!ie)return;function e(){return be(this,void 0,void 0,(function*(){let e;try{if((null==R?void 0:R.length)>0){e=(yield s.dataSourceUtils.createJSAPIFeatureLayerByRecords(ie,R)).layer}else e=yield null==ie?void 0:ie.createJSAPILayerByDataSource()}catch(e){console.log(e)}return e}))}const t=function(){return be(this,void 0,void 0,(function*(){let e=null;try{const t=null==ie?void 0:ie.getCurrentQueryParams();e=yield s.dataSourceUtils.changeJimuArcGISQueryToJSAPIQuery(ie,(0,s.Immutable)(t)).then((e=>e&&e.geometry?e.geometry:null))}catch(e){console.log(e)}return e}))}();Promise.resolve(t).then((t=>{var n;if(K(t),C&&!(null==h?void 0:h.dataActionObject)){const t=null==f?void 0:f.getAllJimuLayerViews(),l=null==t?void 0:t.find((e=>{var t;return e.layerDataSourceId===(null===(t=null==h?void 0:h.useDataSource)||void 0===t?void 0:t.dataSourceId)})),a=null===(n=null==l?void 0:l.layer)||void 0===n?void 0:n.type;if(!l||!a||"feature"!==a&&"subtype-sublayer"!==a){const t=e();Promise.resolve(t).then((e=>{N(e)}))}else{const e=null==l?void 0:l.layer;N(e)}}else{const t=e();Promise.resolve(t).then((e=>{N(e)}))}})),oe.current=null==ie?void 0:ie.id}),[ie,T,f,C,null===(c=null==h?void 0:h.useDataSource)||void 0===c?void 0:c.dataSourceId,null==h?void 0:h.dataActionObject,ce,R,I]),s.React.useEffect((()=>{const e=Y.current;e&&(e.maxSize=O)}),[O]),s.React.useEffect((()=>{!function(){be(this,void 0,void 0,(function*(){var e;const t=yield(n=null==M?void 0:M.url,_(void 0,void 0,void 0,(function*(){if(!n)return!1;const e=s.esri.restRequest.request;try{const t=yield e(`${n}?f=json`);return!Object.keys(t).includes("error")}catch(e){return!1}})));var n;const l=yield(e=>_(void 0,void 0,void 0,(function*(){var t;if(!e)return!1;const n=yield null==e?void 0:e.fetchItemInfo().then((e=>e)).catch((e=>{console.error(e)}));if(!n||!n.url)return!1;const l=null===(t=yield s.ServiceManager.getInstance().fetchArcGISServerInfo(n.url))||void 0===t?void 0:t.owningSystemUrl;if(!l)return!1;const a=s.SessionManager.getInstance().getSessionByUrl(l);if(!a)return!1;const o=yield a.getUser(),i="org_admin"===(null==o?void 0:o.role),r=null==n?void 0:n.isOrgItem,c=((null==o?void 0:o.privileges)||[]).includes("portal:admin:updateItems"),d=i&&r&&c,u=n.owner===(null==o?void 0:o.username),v=yield s.privilegeUtils.isItemInTheUpdatedGroup(n.id,a);return d||u||v})))(ie),o=null==M?void 0:M.userHasFullEditingPrivileges,i=null===(e=null==M?void 0:M.editingEnabled)||void 0===e||e,r=(null==h?void 0:h.layerHonorMode)===a.Webmap,c=t||w,d=(r||(null==h?void 0:h.enableEdit))&&c;let u=!1;u=!!(l||o&&i)||!(o&&!i)&&d,H(u)}))}()}),[M,w,ie,h]);const ve=s.React.useCallback((()=>{const e=Y.current;if(null==e?void 0:e.layer){const t=(ie&&ie.getCurrentQueryParams()).where;e.layer.definitionExpression=t}}),[ie]),pe=s.React.useCallback((()=>{var e,t;const n=Y.current,a=null==h?void 0:h.selectMode;if(!a||!n)return;(null===(e=Z.current)||void 0===e?void 0:e.remove)&&Z.current.remove(),G||(Z.current=n.on("cell-click",(({feature:e,objectId:t})=>{if(!e)return;if(G)return;const o=n.highlightIds;clearTimeout(ae.current),ae.current=setTimeout((()=>{var i;const s=t||e.getObjectId(),r=o.includes(s),c=n.attachmentsViewOptions.objectId,d=n.relatedTable;if(c||d)E([t||e.getObjectId()]);else{a===l.Single&&n.highlightIds.removeAll(),r?n.highlightIds.remove(s):n.highlightIds.add(s);const e=null===(i=n.highlightIds)||void 0===i?void 0:i.toArray();0===(null==e?void 0:e.length)&&(x&&(n.filterBySelectionEnabled=!1),ve()),E(e)}}),200)}))),(null===(t=ee.current)||void 0===t?void 0:t.remove)&&ee.current.remove(),ee.current=n.on("cell-dblclick",(({feature:e,objectId:t})=>{var o;clearTimeout(ae.current);const i=t||e.getObjectId();a===l.Single&&n.highlightIds.removeAll();if(!n.highlightIds.includes(i)){n.highlightIds.add(i);const e=null===(o=n.highlightIds)||void 0===o?void 0:o.toArray();E(e)}}))}),[G,null==h?void 0:h.selectMode,ve,x,E]),me=s.React.useCallback((()=>{var e;const t=Y.current,n=null==h?void 0:h.selectMode;if(!n||!t)return;(null===(e=te.current)||void 0===e?void 0:e.remove)&&te.current.remove(),G||(te.current=t.on("cell-keydown",(({feature:e,native:a,objectId:o})=>{var i;if(!e)return;if(G)return;const s=a.keyCode;if(a.shiftKey&&32===s){const a=t.highlightIds,s=o||e.getObjectId(),r=a.includes(s);if(!t.attachmentsViewOptions.objectId){n===l.Single&&t.highlightIds.removeAll(),r?t.highlightIds.remove(s):t.highlightIds.add(s);const e=null===(i=t.highlightIds)||void 0===i?void 0:i.toArray();0===(null==e?void 0:e.length)&&(x&&(t.filterBySelectionEnabled=!1),ve()),E(e)}else E([o||e.getObjectId()])}})))}),[G,null==h?void 0:h.selectMode,ve,x,E]);s.React.useEffect((()=>{var e,t,n;(null==h?void 0:h.enableSelect)?(pe(),me()):((null===(e=Z.current)||void 0===e?void 0:e.remove)&&Z.current.remove(),(null===(t=ee.current)||void 0===t?void 0:t.remove)&&ee.current.remove(),(null===(n=te.current)||void 0===n?void 0:n.remove)&&te.current.remove())}),[null==h?void 0:h.enableSelect,G,pe,me]);const ge=s.React.useCallback((e=>{var t,l;const i=Y.current;if(!h||!i)return;const r=((e,t,l,i)=>{var s,r,c,d,u,v,p;const m=null==e?void 0:e.getSchema(),g=(null==m?void 0:m.fields)?Object.values(null==m?void 0:m.fields):[],h=null==e?void 0:e.getLayerDefinition(),f=t.columnSetting,b=(null==f?void 0:f.responsiveType)===o.Fit?{autoWidth:!0,textAlign:null!==(s=null==f?void 0:f.textAlign)&&void 0!==s?s:n.Start,textWrap:null!==(r=null==f?void 0:f.wrapText)&&void 0!==r&&r}:{autoWidth:!1,width:(null==f?void 0:f.columnWidth)||200,textWrap:null!==(c=null==f?void 0:f.wrapText)&&void 0!==c&&c,textAlign:null!==(d=null==f?void 0:f.textAlign)&&void 0!==d?d:n.Start},y=F(g,l?l.map((e=>({jimuName:e.value}))):t.tableFields.filter((e=>e.visible))).map((e=>e.jimuName)),S=null==e?void 0:e.getCurrentQueryParams(),w=(null==S?void 0:S.orderByFields)||[],x={};let j;w.forEach(((e,t)=>{var n;const l=e.split(" ");x[l[0]]={direction:null===(n=l[1])||void 0===n?void 0:n.toLowerCase(),initialSortPriority:t}}));const R=(null===(u=null==h?void 0:h.fields)||void 0===u?void 0:u.length)>0?h.fields:g,I=t.layerHonorMode===a.Webmap;if(I){const t=null===(v=null==e?void 0:e.getPopupInfo)||void 0===v?void 0:v.call(e),n=(null==t?void 0:t.fieldInfos)||[],l=Object.keys((null==m?void 0:m.fields)||{}),a=n.filter((e=>l.includes(e.fieldName))),o=B(null==m?void 0:m.fields,R);j=(null===(p=null==t?void 0:t.fieldInfos)||void 0===p?void 0:p.length)>0?new P.default({columnTemplates:a.map((e=>{var t;const n=e.fieldName;return Object.assign(Object.assign(Object.assign(Object.assign({},e),b),{type:"field",editable:null!==(t=e.isEditable)&&void 0!==t&&t}),x[n]?x[n]:{})}))}):new P.default({columnTemplates:o.map((e=>{const t=e.jimuName||e.name;return Object.assign(Object.assign(Object.assign(Object.assign({},e),b),{type:"field",fieldName:t,label:e.alias||e.name,editable:z(h,t),visible:!0}),x[t]?x[t]:{})}))})}else I||(j=new P.default({columnTemplates:t.tableFields.map((e=>{var t;const n=e.jimuName||e.name,l=null===(t=null==m?void 0:m.fields)||void 0===t?void 0:t[n];return Object.assign(Object.assign(Object.assign({format:null==l?void 0:l.format,type:"field"},b),{fieldName:n,label:null==l?void 0:l.alias,editable:z(h,n)&&(null==e?void 0:e.editAuthority),visible:i?e.visible:y.indexOf(n)<0}),x[n]?x[n]:{})}))}));return j})(ie,h,j,e),c=!s.lodash.isDeepEqual(null===(t=i.tableTemplate)||void 0===t?void 0:t.columnTemplates,null==r?void 0:r.columnTemplates);(e||c)&&(i.tableTemplate=r),0===(null===(l=r.columnTemplates)||void 0===l?void 0:l.length)?i.visible=!1:i.visible=!0}),[ie,h]),he=s.React.useCallback((()=>{var e;const t=Y.current;if(!(null==h?void 0:h.columnSetting)||!t)return;const n=h.columnSetting;if((null==n?void 0:n.responsiveType)===o.Fixed){const l=n.columnWidth||200;((null===(e=t.columns)||void 0===e?void 0:e.toArray())||[]).forEach(((e,t)=>{const n=e,a="EsriFeatureTableAttachmentsColumn"===n.fieldName,o=n.fieldName.indexOf("EsriFeatureTableRelationshipColumn")>=0;(a||o)&&setTimeout((()=>{Y.current.columns.toArray()[t].width=l}),200)}))}}),[null==h?void 0:h.columnSetting]);s.React.useEffect((()=>{W&&ge()}),[W,ge]),s.React.useEffect((()=>{W&&!Q&&he()}),[W,Q,he]);const fe=s.hooks.usePrevious(h),ye=s.hooks.usePrevious(y),Se=s.hooks.usePrevious(b),we=s.hooks.usePrevious(M),xe=s.hooks.usePrevious(V),je=s.React.useCallback((e=>{var t,n,l,a;if(!(null===(t=Y.current)||void 0===t?void 0:t.isQueryingOrSyncing))return;D.current=!0;const{updatedFeatures:o,deletedFeatures:i}=e,s=o&&o.length>0,r=i&&i.length>0;if(s){const t=null===(l=null===(n=null==e?void 0:e.edits)||void 0===n?void 0:n.updateFeatures)||void 0===l?void 0:l[0];if(t){const e=ie.buildRecord(t);ie.afterUpdateRecord(e)}}if(r){const t=null===(a=null==e?void 0:e.edits)||void 0===a?void 0:a.deleteFeatures;if((null==t?void 0:t.length)>0){const e=[];t.forEach((t=>{const n=ie.buildRecord(t);e.push(n.getId())})),ie.afterDeleteRecordsByIds(e)}}}),[ie,D]);if(g)Y.current&&de();else if(S.current&&ie&&M){const e=h.id!==(null==fe?void 0:fe.id)&&(null===(d=null==h?void 0:h.useDataSource)||void 0===d?void 0:d.dataSourceId)===(null===(u=null==fe?void 0:fe.useDataSource)||void 0===u?void 0:u.dataSourceId),t=!s.lodash.isDeepEqual(h,fe),n=!s.lodash.isDeepEqual(M,we);if(!Y.current||n||e){de();const e=document.createElement("div");e.className="h-100",S.current.appendChild(e),Y.current=new ue.default(Object.assign(Object.assign(Object.assign({container:e,layer:M},(null==f?void 0:f.view)?{view:f.view}:{}),O?{maxSize:O}:{}),{attachmentsEnabled:b,relatedRecordsEnabled:y,visibleElements:{columnDescriptions:!1,header:!1,menu:!1,menuItems:{clearSelection:!1,refreshData:!1,toggleColumns:!1},selectionColumn:!1},menuConfig:{items:[]},multiSortEnabled:!0,editingEnabled:V,timeZone:k(ie),filterGeometry:X})),(null==h?void 0:h.enableSelect)?(pe(),me()):((null===(v=Z.current)||void 0===v?void 0:v.remove)&&Z.current.remove(),(null===(p=ee.current)||void 0===p?void 0:p.remove)&&ee.current.remove(),(null===(m=te.current)||void 0===m?void 0:m.remove)&&te.current.remove())}const l=Y.current;V!==xe&&(l.editingEnabled=V),Se!==b&&(l.attachmentsEnabled=b,ge(!0)),ye!==y&&(l.relatedRecordsEnabled=y,ge(!0)),h&&h.id===(null==fe?void 0:fe.id)&&t&&ge(!0)}s.React.useEffect((()=>{let e;if(M){if("subtype-sublayer"===M.type){const t=M.parent;t.on&&(e=t.on("edits",je))}else M.on&&(e=M.on("edits",je));return()=>{null==e||e.remove()}}}),[M,je]);const Re=Y.current;return s.React.useEffect((()=>{const e=$.watch((()=>null==Re?void 0:Re.state),(e=>{J("loaded"===e)}),{initial:!0,sync:!0}),t=$.watch((()=>{var e;return null===(e=null==Re?void 0:Re.columns)||void 0===e?void 0:e.toArray().some((e=>e.editInfo))}),(e=>{U(!!e)}),{initial:!0,sync:!0}),n=$.watch((()=>null==Re?void 0:Re.relatedTable),(e=>{e&&(e.visibleElements.selectionColumn=!1)}),{sync:!0}),l=$.watch((()=>null==Re?void 0:Re.isQueryingOrSyncing),(e=>{q(e)}),{initial:!0,sync:!0});return()=>{null==e||e.remove(),null==t||t.remove(),null==n||n.remove(),null==l||l.remove()}}),[Re]),[Y.current,W,oe.current]};var Se=v(65959),we=v.n(Se),xe=function(e,t){var n={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(l=Object.getOwnPropertySymbols(e);a<l.length;a++)t.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(e,l[a])&&(n[l[a]]=e[l[a]])}return n};const je=e=>{const t=window.SVG,{className:n}=e,l=xe(e,["className"]),a=(0,s.classNames)("jimu-icon jimu-icon-component",n);return t?s.React.createElement(t,Object.assign({className:a,src:we()},l)):s.React.createElement("svg",Object.assign({className:a},l))};var Re=v(7835),Ie=v.n(Re),Oe=function(e,t){var n={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(l=Object.getOwnPropertySymbols(e);a<l.length;a++)t.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(e,l[a])&&(n[l[a]]=e[l[a]])}return n};const Te=e=>{const t=window.SVG,{className:n}=e,l=Oe(e,["className"]),a=(0,s.classNames)("jimu-icon jimu-icon-component",n);return t?s.React.createElement(t,Object.assign({className:a,src:Ie()},l)):s.React.createElement("svg",Object.assign({className:a},l))};var Ce=v(27964),Ee=v.n(Ce),De=v(20904),Ae=v.n(De),Me=function(e,t){var n={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(l=Object.getOwnPropertySymbols(e);a<l.length;a++)t.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(e,l[a])&&(n[l[a]]=e[l[a]])}return n};const Ne=e=>{const t=window.SVG,{className:n}=e,l=Me(e,["className"]),a=(0,s.classNames)("jimu-icon jimu-icon-component has-rtl-svg",n);return t?s.React.createElement(t,Object.assign({className:a,src:Ee(),srcRTL:Ae()},l)):s.React.createElement("svg",Object.assign({className:a},l))};var Le=v(4583),Fe=v.n(Le),Pe=function(e,t){var n={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(l=Object.getOwnPropertySymbols(e);a<l.length;a++)t.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(e,l[a])&&(n[l[a]]=e[l[a]])}return n};const _e=e=>{const t=window.SVG,{className:n}=e,l=Pe(e,["className"]),a=(0,s.classNames)("jimu-icon jimu-icon-component",n);return t?s.React.createElement(t,Object.assign({className:a,src:Fe()},l)):s.React.createElement("svg",Object.assign({className:a},l))};var Ve=v(21935),ke=v.n(Ve),ze=function(e,t){var n={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(l=Object.getOwnPropertySymbols(e);a<l.length;a++)t.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(e,l[a])&&(n[l[a]]=e[l[a]])}return n};const Be=e=>{const t=window.SVG,{className:n}=e,l=ze(e,["className"]),a=(0,s.classNames)("jimu-icon jimu-icon-component",n);return t?s.React.createElement(t,Object.assign({className:a,src:ke()},l)):s.React.createElement("svg",Object.assign({className:a},l))};var He=v(9044),Ge=v.n(He),Ue=function(e,t){var n={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(l=Object.getOwnPropertySymbols(e);a<l.length;a++)t.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(e,l[a])&&(n[l[a]]=e[l[a]])}return n};const We=e=>{const t=window.SVG,{className:n}=e,l=Ue(e,["className"]),a=(0,s.classNames)("jimu-icon jimu-icon-component",n);return t?s.React.createElement(t,Object.assign({className:a,src:Ge()},l)):s.React.createElement("svg",Object.assign({className:a},l))};var $e=v(49419),Je=v.n($e),Qe=function(e,t){var n={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(l=Object.getOwnPropertySymbols(e);a<l.length;a++)t.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(e,l[a])&&(n[l[a]]=e[l[a]])}return n};const qe=e=>{const t=window.SVG,{className:n}=e,l=Qe(e,["className"]),a=(0,s.classNames)("jimu-icon jimu-icon-component",n);return t?s.React.createElement(t,Object.assign({className:a,src:Je()},l)):s.React.createElement("svg",Object.assign({className:a},l))};var Xe=v(4651),Ke=v.n(Xe),Ye=function(e,t){var n={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(l=Object.getOwnPropertySymbols(e);a<l.length;a++)t.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(e,l[a])&&(n[l[a]]=e[l[a]])}return n};const Ze=e=>{const t=window.SVG,{className:n}=e,l=Ye(e,["className"]),a=(0,s.classNames)("jimu-icon jimu-icon-component",n);return t?s.React.createElement(t,Object.assign({className:a,src:Ke()},l)):s.React.createElement("svg",Object.assign({className:a},l))},et=(e,t,n)=>s.css`
    &.top-button-list{
      ${!e&&!t&&"\n        position: absolute;\n        right: 16px;\n      "}
      ${n?"display: none":"display: flex"};
      .top-button{
        display: inline-flex;
        button{
          width: 32px;
          height: 32px;
        }
      }
    }
  `,tt=(e,t,n)=>s.css`
    &.dropdown-list-container{
      ${!e&&!t&&"\n        position: absolute;\n        right: 17px;\n      "}
      .dropdown-list{
        ${!n&&"display: none;"}
        width: 32px;
        height: 32px;
      }
      .horizontal-action-dropdown{
        button{
          width: 32px;
          height: 32px;
        }
      }
    }
  `,nt=e=>{const{usedState:n,curLayerConfig:l,dataSource:o,dsSelection:i,isMapMode:r,arrangeType:c,enableMapExtentFilter:d,widgetId:u,enableDataAction:v,onShowSelection:p,resetTable:m,onTableRefresh:g,onDeleteSelection:h,onValueChangeFromRuntime:b,toggleMapFilter:S}=e,{activeTabId:w,selectQueryFlag:x,tableShowColumns:j,mobileFlag:R,emptyTable:I,tableLoaded:O,tableSelected:T,allowDel:C,mapFilterEnabled:E,allLayersConfig:D,columns:M,enableRelatedRecords:N,enableAttachments:L,setTableShowColumns:F}=n,{enableSearch:P=!1,searchFields:_=[],enableSelect:V,enableRefresh:k,enableShowHideColumn:z=!0}=l,[H,G]=s.React.useState(),[U,W]=s.React.useState(),$=s.hooks.useTranslation(y,f.defaultMessages),J=P&&0!==(null==_?void 0:_.length),Q=c===t.Tabs,q=T>0,X=r&&d,K=null==o?void 0:o.getLabel(),Y=$("tableDataActionLabel",{layer:K||""}),Z=(null==o?void 0:o.dataViewId)===fe,ee=s.React.useMemo((()=>{const e=j||U;if(!e)return[];const t=e.filter((e=>{const t="EsriFeatureTableAttachmentsColumn"!==e.value,n=0!==e.value.toString().indexOf("EsriFeatureTableRelationshipColumn");return t&&n}));return null==t?void 0:t.map((e=>{var t;return null===(t=e.value)||void 0===t?void 0:t.toString()}))}),[j,U]),te=null==M?void 0:M.toArray(),ne=s.hooks.useLatest(te);s.React.useEffect((()=>{var e,t,n;if(!(null==l?void 0:l.layerHonorMode)||!O)return;const i=[];null===(e=ne.current)||void 0===e||e.forEach((e=>{var t;const n=e.name||e.fieldName,l=e.effectiveLabel||e.alias||e.fieldName,a="EsriFeatureTableAttachmentsColumn"===n,o=0===(null===(t=null==n?void 0:n.toString())||void 0===t?void 0:t.indexOf("EsriFeatureTableRelationshipColumn"));(a||o)&&i.push({value:n,label:l,hidden:e.hidden,type:a?"attachment":"relationship"})}));const s=[],r=[];if(l.layerHonorMode===a.Webmap){const e=null===(t=null==o?void 0:o.getPopupInfo)||void 0===t?void 0:t.call(o),l=(null==e?void 0:e.fieldInfos)||[],a=null==o?void 0:o.getLayerDefinition(),i=null==o?void 0:o.getSchema(),c=(null==i?void 0:i.fields)?Object.values(null==i?void 0:i.fields):[],d=Object.keys((null==i?void 0:i.fields)||{}),u=l.filter((e=>d.includes(e.fieldName))),v=(null===(n=null==a?void 0:a.fields)||void 0===n?void 0:n.length)>0?a.fields:c,p=B(null==i?void 0:i.fields,v);if((null==l?void 0:l.length)>0)for(const e of u){const t={value:e.fieldName,label:e.label};s.push(t),e.visible&&r.push(t)}else for(const e of p){const t={value:e.name,label:e.alias};s.push(t),r.push(t)}}else for(const e of l.tableFields){const t={value:e.name,label:e.alias};s.push(t),e.visible&&r.push(t)}i.forEach((e=>{("attachment"===e.type&&L||"relationship"===e.type&&N)&&(s.push({value:e.value,label:e.label}),e.hidden||r.push(e))})),G(s),W(r),F(r)}),[O,o,ne,N,L,null==l?void 0:l.layerHonorMode,null==l?void 0:l.tableFields,F]);const le=(0,s.jsx)("div",{className:"d-flex ml-2 dropdown-list-container",css:tt(J,Q,R)},(0,s.jsx)(f.Dropdown,{size:"sm",className:"d-inline-flex dropdown-list"},(0,s.jsx)(f.DropdownButton,{arrow:!1,icon:!0,size:"sm",title:$("options")},(0,s.jsx)(Ze,null)),(0,s.jsx)(f.DropdownMenu,null,!Z&&(0,s.jsx)(f.DropdownItem,{key:"showSelection",onClick:p,disabled:!O||I||!q},x?(0,s.jsx)(Te,{className:"mr-1"}):(0,s.jsx)(Ne,{className:"mr-1",autoFlip:!0}),$(x?"showAll":"showSelection")),V&&(0,s.jsx)(f.DropdownItem,{key:"clearSelection",onClick:m,disabled:!O||I||!q},(0,s.jsx)(_e,{className:"mr-1"}),$("clearSelection")),k&&(0,s.jsx)(f.DropdownItem,{key:"refresh",onClick:g,disabled:!O||I},(0,s.jsx)(Be,{className:"mr-1"}),$("refresh")),C&&(0,s.jsx)(f.DropdownItem,{key:"delete",onClick:h,disabled:!O||I||!q},(0,s.jsx)(We,{className:"mr-1"}),$("deleteRecords")),H&&z&&(0,s.jsx)(f.AdvancedSelect,{size:"sm",title:$("showHideCols"),arrow:!1,isSubMenuItem:!0,staticValues:H,sortList:!1,isMultiple:!0,selectedValues:j||U,isEmptyOptionHidden:!1,disabled:!O||I,onChange:b,customDropdownButtonContent:()=>(0,s.jsx)(A.Fragment,null,(0,s.jsx)(qe,{className:"mr-1"}),$("showHideCols"))}))),o&&R&&(0,s.jsx)(A.Fragment,null,X&&(0,s.jsx)(A.Fragment,null,(0,s.jsx)("span",{className:"tool-dividing-line"}),(0,s.jsx)("div",{className:"mobile-map-button "+(v?"mr-2":"")},(0,s.jsx)(f.Button,{icon:!0,size:"sm",onClick:S,variant:E?"contained":"outlined",color:E?"primary":"default",title:$("enableMapExtentFilter"),"aria-label":$("enableMapExtentFilter"),disabled:!O||I,"aria-pressed":E},(0,s.jsx)(je,null)))),v&&(0,s.jsx)(A.Fragment,null,D.map((e=>e.id===w&&!I?(0,s.jsx)(A.Fragment,{key:e.id},!X&&(0,s.jsx)("span",{className:"tool-dividing-line"}),(0,s.jsx)("div",{className:"horizontal-action-dropdown"},(0,s.jsx)(f.DataActionList,{widgetId:u,listStyle:f.DataActionListStyle.Dropdown,dataSets:[{dataSource:o,type:"selected",records:i,fields:ee,name:Y}]}))):""))))),ae=(0,s.jsx)("div",{className:"top-button-list",css:et(J,Q,R)},!Z&&(0,s.jsx)("div",{className:"top-button ml-2"},(0,s.jsx)(f.Button,{size:"sm",onClick:p,icon:!0,title:$(x?"showAll":"showSelection"),"aria-label":$(x?"showAll":"showSelection"),disabled:!O||I||!q},x?(0,s.jsx)(Te,null):(0,s.jsx)(Ne,{autoFlip:!0}))),V&&(0,s.jsx)("div",{className:"top-button ml-2"},(0,s.jsx)(f.Button,{size:"sm",onClick:m,icon:!0,title:$("clearSelection"),"aria-label":$("clearSelection"),disabled:!O||I||!q},(0,s.jsx)(_e,null))),k&&(0,s.jsx)("div",{className:"top-button ml-2"},(0,s.jsx)(f.Button,{size:"sm",onClick:g,icon:!0,title:$("refresh"),"aria-label":$("refresh"),disabled:!O||I},(0,s.jsx)(Be,null))),C&&(0,s.jsx)("div",{className:"top-button ml-2"},(0,s.jsx)(f.Button,{size:"sm",onClick:h,icon:!0,title:$("deleteRecords"),"aria-label":$("deleteRecords"),disabled:!O||I||!q},(0,s.jsx)(We,null))),H&&z&&(0,s.jsx)("div",{className:"top-button ml-2"},(0,s.jsx)(f.AdvancedSelect,{size:"sm",title:$("showHideCols"),"aria-label":$("showHideCols"),icon:!0,arrow:!1,disabled:!O||I,staticValues:H,sortList:!1,isMultiple:!0,selectedValues:j||U,isEmptyOptionHidden:!1,onChange:b,customDropdownButtonContent:()=>(0,s.jsx)(qe,null)})),X&&(0,s.jsx)(A.Fragment,null,(0,s.jsx)("span",{className:"tool-dividing-line"}),(0,s.jsx)("div",{className:"top-button "+(v?"mr-2":"")},(0,s.jsx)(f.Button,{icon:!0,size:"sm",onClick:S,variant:E?"contained":"outlined",color:E?"primary":"default",title:$("enableMapExtentFilter"),"aria-label":$("enableMapExtentFilter"),disabled:!O||I,"aria-pressed":E},(0,s.jsx)(je,null)))),o&&!R&&v&&(0,s.jsx)(A.Fragment,null,D.map((e=>e.id===w&&!I?(0,s.jsx)(A.Fragment,{key:e.id},!X&&(0,s.jsx)("span",{className:"tool-dividing-line"}),(0,s.jsx)("div",{className:"top-button data-action-btn"},(0,s.jsx)(f.DataActionList,{widgetId:u,listStyle:f.DataActionListStyle.Dropdown,dataSets:[{dataSource:o,type:"selected",records:i,fields:ee,name:Y}]}))):""))));return R?le:ae};var lt=v(62686),at=function(e,t,n,l){return new(n||(n=Promise))((function(a,o){function i(e){try{r(l.next(e))}catch(e){o(e)}}function s(e){try{r(l.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}r((l=l.apply(e,t||[])).next())}))};const ot=e=>{const{widgetId:t,useMapWidgetIds:n,mapViewsConfig:l,mapFilterEnabled:a,onUpdateViewExtent:o,onRestTableGeometry:i,onLayersConfigChange:r,onViewChange:c}=e,[d,u]=s.React.useState(null),v=null==n?void 0:n[0],p=s.React.useCallback((()=>at(void 0,void 0,void 0,(function*(){var e,n;if(d){const a=null===(n=null===(e=null==l?void 0:l[null==d?void 0:d.id])||void 0===e?void 0:e.asMutable)||void 0===n?void 0:n.call(e,{deep:!0}),o=yield((e,t,n)=>_(void 0,void 0,void 0,(function*(){if(!t)return[];const l=[];yield t.whenJimuMapViewLoaded();const a=t.getAllJimuLayerViews(),o=t.getJimuTables(),{layersConfig:i=[],customJimuLayerViewIds:r=[],customizeLayers:c,displayRuntimeLayers:d=!0}=e||{},u={};for(const e of a){const t=e.id;if(!N(e))continue;const{layerDataSourceId:n}=e,a=null==e?void 0:e.fromRuntime,o=e.isLayerVisible();if(d&&a&&o){let t=(null==e?void 0:e.getLayerDataSource())||V.getDataSource(n);if(!t){try{t=yield e.createLayerDataSource()}catch(e){continue}t=yield e.createLayerDataSource()}const l=null==t?void 0:t.getSchema();if(!t||!(null==l?void 0:l.fields))continue;const a=H(t,!0,void 0,e.jimuMapViewId);u[a.id]=a;continue}if(!(c?r.includes(t):o))continue;const s=t.indexOf("-"),v=t.substring(s+1),p=i.find((e=>e.id===v));let m=(null==e?void 0:e.getLayerDataSource())||V.getDataSource(n);if(!m){try{m=yield e.createLayerDataSource()}catch(e){continue}m=yield e.createLayerDataSource()}const g=null==m?void 0:m.getSchema();if(!m||!(null==g?void 0:g.fields))continue;const h=H(m,!0,void 0,e.jimuMapViewId);if(p)if(0!==F(h.allFields,p.allFields).length){const e=Object.assign(Object.assign({},p),{name:h.name,useDataSource:h.useDataSource,allFields:h.allFields,tableFields:h.tableFields});l.push(e)}else l.push(p);else l.push(h)}s.MutableStoreManager.getInstance().updateStateValue(n,"runtimeTableObj",u);for(const e of o){const n=e.table,a=e.jimuTableId,{visible:o}=n,s=t.getDataSourceIdByAPILayer(n);if(!(c?r.includes(a):o))continue;const d=a.indexOf("-"),u=a.substring(d+1),v=i.find((e=>e.id===u)),p=V.getDataSource(s),m=t.getMapDataSource();let g=p;if(!p&&m)try{g=yield m.createDataSourceByLayer(n)}catch(e){continue}if(!g)continue;const h=H(g,!0);if(v)if(0!==F(h.allFields,v.allFields).length){const e=Object.assign(Object.assign({},v),{name:h.name,useDataSource:h.useDataSource,allFields:h.allFields,tableFields:h.tableFields});l.push(e)}else l.push(v);else l.push(h)}if((null==i?void 0:i.length)>0){const e=i.map((e=>e.id));l.sort(((t,n)=>e.indexOf(t.id)-e.indexOf(n.id)))}return l})))(a,d,t);r(o)}else r([])}))),[t,d,l,r]),m=s.React.useCallback((e=>{u(e),c(e)}),[c]),g=s.hooks.useLatest(p),h=s.React.useCallback((e=>{var t;null===(t=g.current)||void 0===t||t.call(g)}),[g]),f=s.React.useCallback((e=>{var t;null===(t=g.current)||void 0===t||t.call(g)}),[g]),b=s.React.useCallback((e=>{var t;e.fromRuntime&&(null===(t=g.current)||void 0===t||t.call(g))}),[g]);s.React.useEffect((()=>{const e=window.setTimeout(p,50);return()=>{window.clearTimeout(e)}}),[p]),s.React.useEffect((()=>{if(!d||!d.view)return;d.addJimuLayerViewsVisibleChangeListener(h),d.addJimuLayerViewCreatedListener(f),d.addJimuLayerViewRemovedListener(b);const e=d;return()=>{e&&(e.removeJimuLayerViewsVisibleChangeListener(h),e.removeJimuLayerViewCreatedListener(f),e.removeJimuLayerViewRemovedListener(b))}}),[d,f,b,h]);const y=s.React.useRef(null),S=s.React.useCallback((e=>{null!==y.current&&window.clearTimeout(y.current),y.current=window.setTimeout((()=>{o(e)}),500)}),[o]),w=s.hooks.usePrevious(a);return s.React.useEffect((()=>{let e;if(d&&d.view&&a){const t=d.view,n=t.extent.clone();S(n),e=$.watch((()=>null==t?void 0:t.extent),(e=>{S(e)}))}return w&&!a&&(S(),i()),()=>{var t;null===(t=null==e?void 0:e.remove)||void 0===t||t.call(e)}}),[S,d,w,a,i]),(0,s.jsx)(lt.JimuMapViewComponent,{useMapWidgetId:v,onActiveViewChange:m})};var it=function(e,t,n,l){return new(n||(n=Promise))((function(a,o){function i(e){try{r(l.next(e))}catch(e){o(e)}}function s(e){try{r(l.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}r((l=l.apply(e,t||[])).next())}))};function st(e){return s.css`
    .esri-button-menu__item .esri-button-menu__item-label{
      padding: 4px 15px !important;
    }
    .table-popup-search{
      .search-icon{
        z-index: 2;
      }
      .popup-search-input{
        border: 1px solid ${e.ref.palette.neutral[500]};
        border-radius: 2px;
        .input-wrapper{
          height: 30px;
          border: none;
        }
      }
    }
    .table-action-option{
      width: 100%;
      display: inline-flex;
      flex-direction: row;
      .table-action-option-tab{
        margin: auto 8px;
      }
      .table-action-option-close{
        flex: 1;
        button{
          :hover {
            color: ${e.ref.palette.white};
          }
          float: right;
        }
      }
    }
    .esri-popover--open{
      z-index: 1005 !important;
      .esri-date-picker__calendar{
        background-color: ${e.ref.palette.white};
      }
    }
  `}var rt=v(41496);const ct={notReady:!1,emptyTable:!1,showLoading:!1,interval:0,needRefresh:!1,selectedRecords:[],refreshTime:(new Date).getTime()},dt=e=>{const{widgetId:t,curLayerConfig:n,isSelfEditing:l,onDataSourceCreated:a,onCreateDataSourceFailed:o,onUpdateLayerInfo:r,onTimeExtentChange:c,onGdbVersionChange:d,onBelongToSourceVersionChange:u,onNeedRefresh:v,onWidgetQueryChange:p}=e,[m,g]=s.React.useState(ct);s.React.useEffect((()=>{r(m)}),[m,r]);const h=s.React.useCallback(((e,t)=>{if(!n)return;const a=window.jimuConfig.isInBuilder,o=Object.assign({},m),i=ut(n);if(!e||!i)return o.notReady=!1,o.emptyTable=!0,void g(o);const r=i.getLastDataLoadTime(),c=i.getLastAutoRefreshCheckTime(),d=c>r?c:r;o.refreshTime=d;const u=null==t?void 0:t.sourceVersion,p=null==e?void 0:e.sourceVersion,h=p!==u,f=h&&!l.current;l.current&&(l.current=!1),f&&v();const b=(null==i?void 0:i.getSourceRecords())||[],y=b.map((e=>e.getId())).join(",");if(h&&a)return o.notReady=!1,o.emptyTable=!1,o.selectedRecords=null==i?void 0:i.getSelectedRecords(),o.selectionViewIds=y,o.sourceVersion=p,void g(o);const S=(null==i?void 0:i.dataViewId)===fe;if(S&&0!==(null==b?void 0:b.length))return o.notReady=!1,o.emptyTable=!1,o.selectedRecords=null==i?void 0:i.getSelectedRecords(),o.selectionViewIds=y,void g(o);const w=S&&0===(null==b?void 0:b.length);if(!n.dataActionObject&&(e.status===s.DataSourceStatus.NotReady||w))return o.notReady=!0,o.emptyTable=!0,o.selectionViewIds=y,void g(o);o.notReady=!1,o.emptyTable=!1,o.selectionViewIds=y;const x=null==i?void 0:i.getMaxRecordCount();o.maxCount=x,o.showLoading=function(e,t){let n=!1;(window.jimuConfig.isInBuilder||e&&t===s.DataSourceStatus.Loading)&&(n=!0);return n}(i,e.status);const j=i.getAutoRefreshInterval()||0;o.interval=j;const R=null==t?void 0:t.selectedIds,I=null==e?void 0:e.selectedIds;s.lodash.isDeepEqual(R,I)||(o.selectedRecords=i.getSelectedRecords()),g(o)}),[n,l,m,v]),f=s.React.useCallback(((e,t,n=!1)=>{const{widgetQueries:l,gdbVersion:a,sourceVersion:o}=t,{widgetQueries:i,gdbVersion:s,needRefresh:r,sourceVersion:c}=e;if(a&&s&&s!==a)return void d(s);r&&v();if(n&&o!==c)return void u();i&&i!==l&&p()}),[u,d,v,p]),b=s.React.useCallback(((e,t)=>{var l;if((null==n?void 0:n.dataActionObject)&&(null==n?void 0:n.dataActionType)===i.View||!t||!n)return;const a=ut(n);if(!a)return;const o=a.getCurrentQueryParams(),s=null==o?void 0:o.time;c(s);const r=a.id,d=null==e?void 0:e[r],u=null==t?void 0:t[r],v=null===(l=null==a?void 0:a.belongToDataSource)||void 0===l?void 0:l.id,p=null==e?void 0:e[v],m=null==t?void 0:t[v];(d||p)&&(p?f(p,m,!0):f(d,u))}),[f,n,c]),y=null==n?void 0:n.useDataSource,S=vt(n);return(0,s.jsx)(s.DataSourceComponent,{widgetId:t,useDataSource:(0,s.Immutable)(y),dataSource:S,onDataSourceCreated:a,onCreateDataSourceFailed:o,onDataSourceInfoChange:h,onQueryRequired:b})};function ut(e){var t;const n=null===(t=null==e?void 0:e.useDataSource)||void 0===t?void 0:t.dataSourceId;let l=L(n);return l||(l=vt(e)),l}function vt(e){let t=null;return(null==e?void 0:e.dataActionObject)&&(t=e.dataActionDataSource),t}var pt=v(31526),mt=v(13440),gt=v.n(mt),ht=function(e,t,n,l){return new(n||(n=Promise))((function(a,o){function i(e){try{r(l.next(e))}catch(e){o(e)}}function s(e){try{r(l.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}r((l=l.apply(e,t||[])).next())}))};const{BREAK_POINTS:ft}=s.CONSTANTS,bt={where:"1=1",sqlExpression:null},yt=n=>{var l,o,r,c,u;const{id:v,config:p,useMapWidgetIds:m,layoutId:g,layoutItemId:h,stateProps:S,mutableStateProps:w,state:x}=n,{tableMode:j,arrangeType:R,layersConfig:I,mapViewsConfig:O,enableMapExtentFilter:T,defaultExtentFilterEnabled:C,enableRelatedRecords:E,enableAttachments:A}=p,M=(0,d.useTheme)(),N=j===e.Map,[L,P]=s.React.useState(!1),[_,V]=s.React.useState([]),[k,z]=s.React.useState([]),[B,H]=s.React.useState(),[U,J]=s.React.useState(!1),[q,X]=s.React.useState(!1),[K,Y]=s.React.useState(!1),[Z,ee]=s.React.useState(!1),[ne,le]=s.React.useState(600),[ae,oe]=s.React.useState(),[ie,se]=s.React.useState(0),[re,ce]=s.React.useState(!1),[de,ue]=s.React.useState(!1),[ve,pe]=s.React.useState(!1),[me,ge]=s.React.useState(!1),[he,fe]=s.React.useState(0),[be,Se]=s.React.useState([]),[we,xe]=s.React.useState(""),[je,Re]=s.React.useState(),[Ie,Oe]=s.React.useState(),[Te,Ce]=s.React.useState(0),[Ee,De]=s.React.useState(null),Ae=s.React.useRef(null),Me=s.React.useRef({}),Ne=s.React.useRef(!1),Le=s.React.useRef(!1),Fe=s.React.useRef(),Pe=s.React.useRef(null),_e=s.React.useRef(null),Ve=s.React.useRef(!1),ke=s.hooks.useTranslation(y),ze=s.ReactRedux.useSelector((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode})),Be=s.ReactRedux.useSelector((e=>{var t;const n=e.appConfig,l=null===(t=null==n?void 0:n.widgets)||void 0===t?void 0:t[v],a=null==l?void 0:l.enableDataAction;return void 0===a||a})),He=s.ReactRedux.useSelector((e=>{var t,n,l,a,o;const i=e.appConfig,s=null===(t=null==i?void 0:i.layouts)||void 0===t?void 0:t[g],r=null===(l=null===(n=null==s?void 0:s.content)||void 0===n?void 0:n[h])||void 0===l?void 0:l.setting;return(null===(a=null==r?void 0:r.autoProps)||void 0===a?void 0:a.height)===rt.LayoutItemSizeModes.Auto||!0===(null===(o=null==r?void 0:r.autoProps)||void 0===o?void 0:o.height)})),Ge=s.ReactRedux.useSelector((e=>{var t,n,l,a,o;const i=e.appConfig,s=null===(t=null==i?void 0:i.layouts)||void 0===t?void 0:t[g],r=null===(l=null===(n=null==s?void 0:s.content)||void 0===n?void 0:n[h])||void 0===l?void 0:l.setting;return(null===(a=null==r?void 0:r.autoProps)||void 0===a?void 0:a.width)===rt.LayoutItemSizeModes.Auto||!0===(null===(o=null==r?void 0:r.autoProps)||void 0===o?void 0:o.width)})),Ue=(0,s.classNames)("jimu-widget","widget-table","table-widget-"+v),We=R===t.Tabs,$e=k.find((e=>e.id===B)),Je=L&&(null==$e?void 0:$e.enableDelete),Qe=null===(l=(0,s.getAppStore)().getState())||void 0===l?void 0:l.appConfig,qe=null==$e?void 0:$e.useDataSource,Xe=s.appConfigUtils.getWidgetIdByOutputDataSource(qe),Ke=null===(r=null===(o=null==Qe?void 0:Qe.widgets)||void 0===o?void 0:o[Xe])||void 0===r?void 0:r.label,Ye=(null==$e?void 0:$e.enableSearch)&&0!==(null===(c=null==$e?void 0:$e.searchFields)||void 0===c?void 0:c.length),Ze=s.DataSourceManager.getInstance(),et=s.ReactRedux.useSelector((e=>{var t;return qe?Ze.getDataSource(null===(t=null==$e?void 0:$e.useDataSource)||void 0===t?void 0:t.dataSourceId):null==$e?void 0:$e.dataActionDataSource})),tt=(null==w?void 0:w.viewInTableObj)&&Object.keys(w.viewInTableObj).join("|"),lt=(null==w?void 0:w.runtimeTableObj)&&Object.keys(w.runtimeTableObj).join("|"),at=s.React.useCallback((e=>{if(!et)return;const t=e=>{s.MessageManager.getInstance().publishMessage(new s.DataRecordsSelectionChangeMessage(v,e,[et.id])),e.length>0?et.selectRecordsByIds(e.map((e=>e.getId())),e):et.clearSelection()};(null==e?void 0:e.length)>0?et.query({objectIds:e,returnGeometry:!0,outFields:["*"],notAddFieldsToClient:!0},{scope:s.QueryScope.InAllData}).then((e=>{const n=null==e?void 0:e.records;n&&t(n)})):t([])}),[et,v]),ct={dataInvalid:de,layerConfig:$e,activeView:Ee,enableRelatedRecords:E,enableAttachments:A,tableContainer:Ae,canEditFeature:L,selectQueryFlag:U,tableShowColumns:ae,dataActionRecords:null===(u=Me.current)||void 0===u?void 0:u[null==$e?void 0:$e.id],selectionViewIds:we,maxCount:je,sourceVersion:Ie,isMapMode:N,tableSelectAsyncDs:at,isSelfEditing:Ve,activeTabId:B},[ut,vt,mt]=ye(ct),yt={id:v,enableDataAction:Be,isHeightAuto:He,isWidthAuto:Ge,headerFontSetting:null==$e?void 0:$e.headerFontSetting,emptyTable:de,isHorizontalTab:We,widgetWidth:ne},St={activeTabId:B,selectQueryFlag:U,tableShowColumns:ae,mobileFlag:q,emptyTable:de,tableLoaded:vt,tableSelected:ie,allowDel:Je,mapFilterEnabled:re,allLayersConfig:k,columns:null==ut?void 0:ut.columns,enableRelatedRecords:E,enableAttachments:A,setTableShowColumns:oe},wt=s.hooks.usePrevious(Ye),xt=s.hooks.usePrevious(tt),jt=s.React.useCallback((()=>{const e=null==w?void 0:w.viewInTableObj,t=[];if(!tt)return t;const n=tt.split("|");return null==n||n.forEach((n=>{const l=e[n];l&&(Me.current[n]=l.records,t.push(Object.assign({},l.daLayerItem)))})),t}),[null==w?void 0:w.viewInTableObj,tt]),Rt=s.React.useCallback((()=>{const e=null==w?void 0:w.runtimeTableObj,t=[];if(!lt)return t;const n=lt.split("|");return null==n||n.forEach((n=>{const l=e[n];l&&t.push(Object.assign({},l))})),t}),[null==w?void 0:w.runtimeTableObj,lt]),It=s.React.useCallback((e=>{V(e)}),[]),Ot=s.React.useCallback((e=>{De(e)}),[]),Tt=s.React.useCallback((e=>{if(!$e||!et)return;const t=((e,t,n)=>{let l="1=1",a=null;if(!n)return null;if(!n.query)return null;if(t&&e.enableSearch&&e.searchFields){const o=s.dataSourceUtils.getSQL(t,e.searchFields,n,null==e?void 0:e.searchExact);l=o.sql,a=o}return{where:l,sqlExpression:a}})($e,e,et);et.updateQueryParams(t,v)}),[$e,et,v]),Ct=s.React.useCallback((e=>{H(e),J(!1),oe(void 0),(0,s.getAppStore)().dispatch(s.appActions.widgetStatePropChange(v,"activeTabId",e))}),[v]),Et=s.React.useCallback((()=>{if(null==ut?void 0:ut.layer){const e=(et&&et.getCurrentQueryParams()).where;ut.layer.definitionExpression=e}}),[et,ut]),Dt=s.React.useCallback((()=>{var e,t;if(!et)return;let n=et.getSelectedRecordIds();const l=(null===(e=null==et?void 0:et.belongToDataSource)||void 0===e?void 0:e.getSelectedRecordIds())||[];et.isDataView&&n.length!==l.length&&(n=l||n),(null===(t=ut.highlightIds)||void 0===t?void 0:t.removeAll)&&ut.highlightIds.removeAll();const a=n.map((e=>parseInt(e)));ut.highlightIds.addMany(a)}),[et,ut]),At=s.React.useCallback(((e,t,n)=>ht(void 0,void 0,void 0,(function*(){var l;const a=null==e?void 0:e.spatialReference,o=null==e?void 0:e.type,{isWGS84:i,isWebMercator:r}=a;let c;i||r?(_e.current||(_e.current=yield(0,s.loadArcGISJSAPIModule)("esri/geometry/operators/geodesicBufferOperator")),_e.current.isLoaded()||(yield _e.current.load()),c=_e.current):(Pe.current||(Pe.current=yield(0,s.loadArcGISJSAPIModule)("esri/geometry/operators/bufferOperator")),c=Pe.current);const d=null===(l=null==ut?void 0:ut.filterGeometry)||void 0===l?void 0:l.toJSON();if("polygon"!==o&&t&&t<=0){const e=new pt.default({rings:[]});s.lodash.isDeepEqual(d,null==e?void 0:e.toJSON())||(ut.filterGeometry=e)}else if(t&&n){const l=c.execute(e,t,{unit:n});s.lodash.isDeepEqual(d,null==l?void 0:l.toJSON())||(ut.filterGeometry=l)}else ut.filterGeometry=e}))),[ut]),Mt=s.React.useCallback((e=>{if(!(null==ut?void 0:ut.layer)||!et)return;if(mt!==et.id)return;Ne.current=!1;const t=null==et?void 0:et.getCurrentQueryParams(),n=ut.layer.definitionExpression;if(!(""===n&&"1=1"===(null==t?void 0:t.where))&&n!==(null==t?void 0:t.where))if(vt)if(ut.isQueryingOrSyncing){let e=$.watch((()=>ut.isQueryingOrSyncing),(()=>{if(!ut.isQueryingOrSyncing){e&&(e.remove(),e=null);const n=null==et?void 0:et.getCurrentQueryParams();ut.layer&&(null==t?void 0:t.where)===(null==n?void 0:n.where)&&ut.layer.definitionExpression!==(null==t?void 0:t.where)&&(ut.layer.definitionExpression=null==t?void 0:t.where)}}))}else ut.layer.definitionExpression=null==t?void 0:t.where;else Ne.current=!0;setTimeout((()=>{Dt()}),300),e||s.dataSourceUtils.changeJimuArcGISQueryToJSAPIQuery(et,(0,s.Immutable)(t)).then((e=>ht(void 0,void 0,void 0,(function*(){if(!e)return Promise.resolve();const{geometry:t,distance:n,units:l}=e;if(!t)return ut.filterGeometry=null,Promise.resolve();if(vt)if(ut.isQueryingOrSyncing){let e=$.watch((()=>ut.isQueryingOrSyncing),(()=>{ut.isQueryingOrSyncing||(e&&(e.remove(),e=null),At(t,n,l))}))}else At(t,n,l);else Ne.current=!0;return Promise.resolve()})))).then((()=>{Le.current=!0}))}),[mt,et,ut,vt,Dt,At]);s.React.useEffect((()=>{const e=jt(),t=Rt(),n=_.concat(e).concat(t);z(n)}),[_,jt,Rt]),s.React.useEffect((()=>{const e=tt?tt.split("|"):[],t=xt?xt.split("|"):[],n=e.length,l=t.length;if(n>l){const n=((e,t)=>{const n=e.length>t.length,l=n?t:e;return(n?e:t).filter((e=>!l.some((t=>t===e))))})(e,t);H(n[0])}var a,o;n>0&&n===l&&(o=t,(a=e).length!==o.length||!a.every(((e,t)=>e===o[t])))&&H(e[n-1])}),[xt,tt]),s.React.useEffect((()=>()=>{const e=s.MutableStoreManager.getInstance();e.updateStateValue(v,"viewInTableObj",{}),e.updateStateValue(v,"runtimeTableObj",{})}),[v]),s.React.useEffect((()=>{it(void 0,void 0,void 0,(function*(){var e;const t=yield s.privilegeUtils.checkExbAccess(s.privilegeUtils.CheckTarget.Experience);return null===(e=null==t?void 0:t.capabilities)||void 0===e?void 0:e.canEditFeature})).then((e=>{P(e)}))}),[]),s.React.useEffect((()=>{var e;const t=x===s.WidgetState.Active;if(ut&&et&&t&&Le.current&&(Le.current=!1,Dt()),ut&&et&&!t){const t=((null==$e?void 0:$e.dataActionType)===i.View?et.getSelectedRecords():be)||[];(null===(e=ut.highlightIds)||void 0===e?void 0:e.removeAll)&&ut.highlightIds.removeAll();const n=t.map((e=>parseInt(e.getId())));ut.highlightIds.addMany(n)}}),[x,ut,et,null==$e?void 0:$e.dataActionType,be,Dt]),s.React.useEffect((()=>{var e;const t=x===s.WidgetState.Active;if(ut&&et&&t){const t=et.getSelectedRecords()||[];(null===(e=ut.highlightIds)||void 0===e?void 0:e.removeAll)&&ut.highlightIds.removeAll();const n=t.map((e=>parseInt(e.getId())));ut.highlightIds.addMany(n)}}),[x,ut,et]),s.React.useEffect((()=>{ut&&et&&U&&0===(null==be?void 0:be.length)&&(ut.filterBySelectionEnabled=!1,Et(),J(!U))}),[ut,et,U,be,Et]),s.React.useEffect((()=>{N||V(null==I?void 0:I.asMutable({deep:!0}))}),[N,I]),s.React.useEffect((()=>{(!B||k.findIndex((e=>e.id===B))<0)&&k.length>0&&H(k[0].id)}),[k,B]),s.React.useEffect((()=>{ce(T&&C)}),[T,C]),s.React.useEffect((()=>{const e=(null==S?void 0:S.settingChangeTab)||!1,t=null==S?void 0:S.activeTabId;e&&t&&B!==t&&((0,s.getAppStore)().dispatch(s.appActions.widgetStatePropChange(v,"settingChangeTab",!1)),Ct(t))}),[S,B,ze,v,Ct]),s.React.useEffect((()=>{wt&&!Ye&&et&&et.updateQueryParams(bt,v)}),[et,v,wt,Ye]),s.React.useEffect((()=>{vt&&Ne.current&&setTimeout((()=>{Mt()}),300)}),[vt,et,Mt]);const Nt=s.React.useCallback((e=>{var t,n;if(!Ze.getDataSource(null==et?void 0:et.id))return;const l=null===(n=null===(t=et.getInfo())||void 0===t?void 0:t.widgetQueries)||void 0===n?void 0:n[v];let a;e?a=Object.assign(Object.assign({},l),{geometry:e.toJSON()}):(a=Object.assign({},l),delete a.geometry),et.updateQueryParams(a,v)}),[Ze,et,v]),Lt=s.React.useCallback((()=>{ut&&(ut.filterGeometry=null)}),[ut]),Ft=s.lodash.debounce((({width:e,height:t})=>{(e=>{const{enableMapExtentFilter:t}=p,n=t?360:320;e<ft[0]?X(!0):X(!1),Y(e<n),ee(e<430),le(e)})(e)}),200),Pt=()=>{ut&&ut.refresh()},_t=0===k.length,Vt=$e&&(0,s.jsx)(nt,{usedState:St,curLayerConfig:$e,dataSource:et,dsSelection:be,isMapMode:N,arrangeType:R,enableMapExtentFilter:T,widgetId:v,enableDataAction:Be,getInitFields:()=>{var e;const t=[],n=k.find((e=>e.id===B));if(!n)return t;const{tableFields:l,allFields:o,layerHonorMode:i}=n;if(i===a.Webmap&&et){const n=null===(e=null==et?void 0:et.getPopupInfo)||void 0===e?void 0:e.call(et);if(n){const e=n.fieldInfos||[];for(const n of e)t.push({value:n.fieldName,label:n.label})}else for(const e of o)t.push({value:e.name,label:e.alias})}else for(const e of l)e.visible&&t.push({value:e.name,label:e.alias});return t},onShowSelection:()=>{U?(ut.filterBySelectionEnabled=!1,Et()):ut.filterBySelectionEnabled=!0,J(!U)},resetTable:()=>{U&&(Et(),J(!1)),s.MessageManager.getInstance().publishMessage(new s.DataRecordsSelectionChangeMessage(v,[],[et.id])),setTimeout((()=>{const e=et.getCurrentQueryParams();et.clearSelection();const t=Object.assign(Object.assign({},e),bt);et.updateQueryParams(t,v),ut&&(ut.highlightIds.removeAll(),U&&(ut.filterBySelectionEnabled=!1))}),500)},onTableRefresh:Pt,onDeleteSelection:()=>{ut&&ut.deleteSelection(!0)},onValueChangeFromRuntime:e=>{var t;e||(e=[]);const{columnsVisibleFields:n}=((e,t)=>{const n=[],l=[];return null==e||e.forEach((e=>{const a=e.name||e.fieldName,o=e.effectiveLabel||e.alias||e.fieldName;n.push({value:a,label:o});const i=null==t?void 0:t.find((e=>e.jimuName===a||e.name===a));(i?i.visible:!e.hidden)&&l.push({value:a,label:o})})),{columnsAllFields:n,columnsVisibleFields:l}})(null===(t=null==ut?void 0:ut.columns)||void 0===t?void 0:t.toArray());F(ae||n,e,"value").forEach((e=>{ut.toggleColumnVisibility(e.value)})),oe(e)},toggleMapFilter:()=>{ce(!re)}});return(0,s.jsx)(s.React.Fragment,null,_t&&(0,s.jsx)(f.WidgetPlaceholder,{icon:gt(),name:ke("_widgetLabel"),"data-testid":"tablePlaceholder"}),(0,s.jsx)("div",{className:Ue,css:D(M,q,Ye,yt),ref:Fe},(0,s.jsx)("div",{className:_t?"hide-table":"surface-1 border-0 h-100"},(0,s.jsx)("div",{className:"table-indent"},k&&B&&(0,s.jsx)(b,{allLayersConfig:k,isHorizontalTab:We,activeTabId:B,searchOn:Ye,toolListNode:Vt,onTabClick:Ct,onCloseTab:(e,t)=>{t&&t.stopPropagation(),oe(void 0);const n=null==w?void 0:w.viewInTableObj;delete n[e],delete Me.current[e],s.MutableStoreManager.getInstance().updateStateValue(v,"viewInTableObj",n),e===B&&H(k[0].id)}}),(0,s.jsx)("div",{className:We?"horizontal-render-con":"dropdown-render-con"},$e&&Ye&&(0,s.jsx)(G,{searchToolTowed:K,curLayerConfig:$e,dataSource:et,tableLoaded:vt,widgetState:x,toolListNode:Vt,handleSubmit:Tt}),de&&(0,s.jsx)(W,{searchOn:Ye,notReady:ve,dataSourceLabel:null==et?void 0:et.getLabel(),widgetLabel:Ke}),(0,s.jsx)("div",{className:"table-con",ref:Ae}),(0,s.jsx)("div",{className:"table-bottom-info"},(0,s.jsx)(Q,{table:ut,showCount:null==$e?void 0:$e.showCount,onSelectedChange:e=>{se(e)}}),(void 0===(null==$e?void 0:$e.updateText)||$e.updateText)&&(me||he>0)&&(0,s.jsx)(te,{showLoading:me,interval:he,isMobile:q,bottomResponsive:Z,refreshTime:Te})),N&&(0,s.jsx)(ot,{widgetId:v,useMapWidgetIds:m,mapViewsConfig:O,mapFilterEnabled:re,onUpdateViewExtent:Nt,onRestTableGeometry:Lt,onLayersConfigChange:It,onViewChange:Ot}),(0,s.jsx)(dt,{widgetId:v,curLayerConfig:$e,isSelfEditing:Ve,onUpdateLayerInfo:e=>{if(!e||!B||!$e)return;const{notReady:t,emptyTable:n,showLoading:l,interval:a,selectedRecords:o,selectionViewIds:i,maxCount:s,sourceVersion:r,refreshTime:c}=e;pe(t),ue(n),ge(l),fe(a),Se(o),xe(i),Re(s),Oe(r),Ce(c)},onTimeExtentChange:e=>{var t,n;const l=null==ut?void 0:ut.layer;if(e){const a=s.dataSourceUtils.changeJimuTimeToJSAPITimeExtent(e),o=null==l?void 0:l.timeExtent;!((null==e?void 0:e[0])===(null===(t=null==o?void 0:o.start)||void 0===t?void 0:t.getTime())&&(null==e?void 0:e[1])===(null===(n=null==o?void 0:o.end)||void 0===n?void 0:n.getTime()))&&l&&(l.timeExtent=a)}else l&&(l.timeExtent=null)},onGdbVersionChange:e=>{ut.layer.gdbVersion=e,Pt()},onBelongToSourceVersionChange:()=>{Mt(),Pt()},onNeedRefresh:()=>{Pt()},onWidgetQueryChange:()=>{(null==ut?void 0:ut.layer)?Mt():Ne.current=!0}}),(0,s.jsx)(d.Global,{styles:st(M)})))),(0,s.jsx)(s.ReactResizeDetector,{targetRef:Fe,handleWidth:!0,handleHeight:!0,onResize:Ft})))};yt.versionManager=c;const St=yt;function wt(e){v.p=e}})(),p})())}}}));