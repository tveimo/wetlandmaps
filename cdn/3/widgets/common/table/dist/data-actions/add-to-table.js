System.register(["jimu-core"],(function(e,t){var a={};return{setters:[function(e){a.AbstractDataAction=e.AbstractDataAction,a.DataLevel=e.DataLevel,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.MutableStoreManager=e.MutableStoreManager,a.appActions=e.appActions,a.getAppStore=e.getAppStore,a.utils=e.utils}],execute:function(){e((()=>{var e={79244:e=>{"use strict";e.exports=a}},t={};function o(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var r={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(r),o.d(r,{default:()=>p});var e,t,a,n,i,s,d,u=o(79244);!function(e){e.Layer="LAYER",e.Map="MAP"}(e||(e={})),function(e){e.Dropdown="DROPDOWN",e.Tabs="TABS"}(t||(t={})),function(e){e.Start="start",e.Center="center",e.End="end"}(a||(a={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE"}(n||(n={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(i||(i={})),function(e){e.Fit="FIT",e.Fixed="FIXED"}(s||(s={})),function(e){e.View="VIEW",e.Add="ADD"}(d||(d={}));const c=[u.DataSourceTypes.FeatureLayer,u.DataSourceTypes.SceneLayer,u.DataSourceTypes.BuildingComponentSubLayer,u.DataSourceTypes.OrientedImageryLayer,u.DataSourceTypes.ImageryLayer],l=[u.DataSourceTypes.SubtypeGroupLayer,u.DataSourceTypes.ImageryTileLayer,u.DataSourceTypes.ElevationLayer];class p extends u.AbstractDataAction{constructor(){super(...arguments),this.deepClone=e=>{const t=Array.isArray(e)?[]:{};for(const a in e){const o=("object"==typeof e[a]||"function"==typeof e[a])&&null!==e[a];t[a]=o?this.deepClone(e[a]):e[a]}return t}}isSupported(e,t){if(e.length>1)return Promise.resolve(!1);let a=!0;const o=e[0],{dataSource:r}=o;if(!Object.keys(r.getSchema()||{}).length)return Promise.resolve(!1);const n=c.includes(r.type),i=r.isDataSourceSet(),s=t!==u.DataLevel.DataSource,d=!r.isInAppConfig()&&!n,p=l.includes(r.type);return(i||s||d||p)&&(a=!1),Promise.resolve(a&&r.getStatus()!==u.DataSourceStatus.NotReady)}onExecute(e,t,a){var o,r,s,c,l,p,S,b;const g=(0,u.getAppStore)().getState().appConfig,v=null===(o=null==g?void 0:g.widgets)||void 0===o?void 0:o[a],y=null===(c=null===(s=null===(r=null==v?void 0:v.dataActions)||void 0===r?void 0:r.addToTable)||void 0===s?void 0:s.config)||void 0===c?void 0:c.isAddInSameSheet,D=t===u.DataLevel.DataSource,A=e[0],{dataSource:f}=A,m=f&&f.getSchema(),I=!f.isInAppConfig(),T=["CreationDate","Creator","EditDate","Editor","GlobalID"],L=Object.values(null==m?void 0:m.fields),M=L.filter((e=>!T.includes(e.jimuName))).map((e=>Object.assign(Object.assign({},e),{visible:!0}))),h=`DaTable-${u.utils.getUUID()}`,O=(D?"":A.name)||f.getLabel()||(null===(l=f.getDataSourceJson())||void 0===l?void 0:l.sourceLabel),j={dataSourceId:f.id,mainDataSourceId:null===(p=f.getMainDataSource())||void 0===p?void 0:p.id,dataViewId:f.dataViewId,rootDataSourceId:null===(S=f.getRootDataSource())||void 0===S?void 0:S.id},w=Object.assign(Object.assign({id:h,name:O,allFields:L,tableFields:M,enableAttachments:!1,enableEdit:!1,allowCsv:!1,showCount:!0,enableSearch:!1,searchFields:[],enableRefresh:!1,enableShowHideColumn:!0,enableSelect:!0,enableDelete:!1,selectMode:n.Multiple,layerHonorMode:i.Webmap,dataActionObject:!0,dataActionType:d.Add},I?{dataActionDataSource:f}:{useDataSource:j}),{dataActionWidgetId:a}),C=(null===(b=u.MutableStoreManager.getInstance().getStateValue([this.widgetId]))||void 0===b?void 0:b.viewInTableObj)||{},P=C;if(y)for(const e in C){const t=C[e].daLayerItem;t.dataActionWidgetId===a&&t.dataActionType===d.Add&&delete C[e]}return P[h]={daLayerItem:w},u.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"viewInTableObj",P),(0,u.getAppStore)().dispatch(u.appActions.widgetStatePropChange(this.widgetId,"dataActionActiveObj",{activeTabId:h,dataActionTable:!0})),Promise.resolve(!0)}}})(),r})())}}}));