System.register(["jimu-core","jimu-layouts/layout-runtime","jimu-ui","jimu-arcgis","jimu-theme"],(function(e,t){var o={},n={},l={},r={},i={};return{setters:[function(e){o.AppMode=e.AppMode,o.BaseVersionManager=e.BaseVersionManager,o.ClauseLogic=e.ClauseLogic,o.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,o.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,o.DataSourceComponent=e.DataSourceComponent,o.DataSourceFilterChangeMessage=e.DataSourceFilterChangeMessage,o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.Immutable=e.Immutable,o.JSAPILayerTypes=e.JSAPILayerTypes,o.JimuFieldType=e.JimuFieldType,o.MessageManager=e.MessageManager,o.React=e.React,o.ReactRedux=e.ReactRedux,o.RecordSetChangeType=e.RecordSetChangeType,o.UrlManager=e.UrlManager,o.UtilityManager=e.UtilityManager,o.WidgetState=e.WidgetState,o.classNames=e.classNames,o.css=e.css,o.dataSourceUtils=e.dataSourceUtils,o.defaultMessages=e.defaultMessages,o.esri=e.esri,o.focusElementInKeyboardMode=e.focusElementInKeyboardMode,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.i18n=e.i18n,o.jsx=e.jsx,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.lodash=e.lodash,o.moduleLoader=e.moduleLoader,o.polished=e.polished,o.urlUtils=e.urlUtils,o.utils=e.utils},function(e){n.PageVisibilityContext=e.PageVisibilityContext,n.ViewVisibilityContext=e.ViewVisibilityContext},function(e){l.Alert=e.Alert,l.Button=e.Button,l.Checkbox=e.Checkbox,l.Dropdown=e.Dropdown,l.DropdownButton=e.DropdownButton,l.DropdownItem=e.DropdownItem,l.DropdownMenu=e.DropdownMenu,l.Icon=e.Icon,l.Link=e.Link,l.Loading=e.Loading,l.LoadingType=e.LoadingType,l.Popper=e.Popper,l.TextInput=e.TextInput,l.defaultMessages=e.defaultMessages},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent,r.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.useTheme=e.useTheme}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=i},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=l},21210:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13 6.133c0 .598-.28 1.46-.825 2.51-.53 1.02-1.247 2.102-1.981 3.102A46 46 0 0 1 8 14.492a48 48 0 0 1-2.194-2.747c-.734-1-1.451-2.081-1.98-3.102C3.28 7.593 3 6.731 3 6.133 3 3.277 5.26 1 8 1s5 2.277 5 5.133m1 0c0 2.685-3.768 7.311-5.332 9.115C8.258 15.722 8 16 8 16s-.258-.279-.668-.751C5.768 13.444 2 8.817 2 6.133 2 2.746 4.686 0 8 0s6 2.746 6 6.133M10 5.5a2 2 0 1 1-4 0 2 2 0 0 1 4 0m1 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},41496:e=>{"use strict";e.exports=n},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=r},79244:e=>{"use strict";e.exports=o},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'}},t={};function s(o){var n=t[o];if(void 0!==n)return n.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,s),l.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var a={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(a),s.d(a,{__set_webpack_public_path__:()=>Ft,default:()=>Ot});var e=s(79244),t=s(41496);const o=[0,3],n={wkid:4326};var l,r,i,u,c,d;!function(e){e.GeocodeService="GeocodeService",e.FeatureService="FeatureService"}(l||(l={})),function(e){e.ResultPanel="Result_Panel",e.OtherWidgets="Other_Widgets"}(r||(r={})),function(e){e.Style1="Style1",e.Style2="Style2",e.Style3="Style3"}(i||(i={})),function(e){e.Classic="Classic",e.Compact="Compact"}(u||(u={})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(c||(c={})),function(e){e.CustomSearchSources="CustomSearchSources",e.MapCentric="MapCentric"}(d||(d={}));var v=s(14321);const g={_widgetLabel:"Search",showResult:"Show search results for {searchText}",hideResult:"Hide search results for {searchText}",allSearchSources:"All search sources",noResult:'No results found for "{searchText}"',couldNotRetrieve:"Could not retrieve current location.",showMoreResult:"Show more results",clearAllHistories:"Clear all histories",clearHistory:"Clear history",clearThisHistories:"Remove this history",clearRecentSearches:"Recent searches",searchIn:"Search in {value}",searchResults:"Search result"};var m=s(30655),p=s.n(m),h=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const f=t=>{const o=window.SVG,{className:n}=t,l=h(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:p()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var y=s(94064),S=s.n(y),b=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const I=t=>{const o=window.SVG,{className:n}=t,l=b(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:S()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var w=s(62686);const x="address";var j=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const C=e=>j(void 0,void 0,void 0,(function*(){const t=R(e),o={shouldConvertSR:!1,searchText:e};if(!t)return Promise.resolve(o);const n=yield M(e),l=yield function(e){return j(this,void 0,void 0,(function*(){return(0,w.loadArcGISJSAPIModules)(["esri/geometry/coordinateFormatter","esri/geometry/SpatialReference"]).then((t=>{const[o,n]=t;if(o.load(),o.isSupported()){if(o.isLoaded()){const t=o.fromUtm(e,new n({wkid:4326}),"latitude-band-indicators");return t&&(null==t?void 0:t.x)&&(null==t?void 0:t.y)?Promise.resolve(!0):Promise.resolve(!1)}return Promise.resolve(!1)}return Promise.resolve(!0)}))}))}(e);return n?function(e){return j(this,void 0,void 0,(function*(){let t=e;return(0,w.loadArcGISJSAPIModules)(["esri/geometry/SpatialReference","esri/rest/support/ProjectParameters","esri/geometry/support/webMercatorUtils","esri/rest/geometryService"]).then((o=>{const[n,l,r,i]=o,s=new n({wkid:4326});if(s&&e){if(s.equals(e.spatialReference))return Promise.resolve(t);if(s.isWebMercator&&e.spatialReference.equals(s))return t=r.geographicToWebMercator(e),t.isSinglePoint=e.isSinglePoint,Promise.resolve(t);if(s.equals(s)&&e.spatialReference.isWebMercator)return t=r.webMercatorToGeographic(e),t.isSinglePoint=e.isSinglePoint,Promise.resolve(t);{const o=P();if(o){const n=new l;return n.geometries=[e],n.outSpatialReference=s,n.f="json",i.project(o,n).then((o=>(t=o&&o.length>0&&o[0],t?(t.isSinglePoint=e.isSinglePoint,Promise.resolve(t)):Promise.resolve(t))),(e=>Promise.reject(new Error(e))))}return Promise.resolve(t)}}return Promise.resolve(null)}))}))}(n).then((t=>{const o=L(t);return Promise.resolve({shouldConvertSR:!!o,searchText:o||e,locationPoint:t})}),(e=>Promise.resolve(o))):l?function(e){return j(this,void 0,void 0,(function*(){const t=P();return(0,w.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/request"]).then((o=>{const[n,l,r]=o;let i=null;const s={query:{sr:4326,conversionType:"UTM",conversionMode:"utmDefault",strings:[e],f:"json"},responseType:"json"};if(!t)return Promise.resolve(i);r(`${t}/fromGeoCoordinateString`,s).then((e=>{const t=Number(e[0][0]),o=Number(e[0][1]);return isNaN(t)||isNaN(o)||(i=new n(t,o,new l({wkid:4326}))),Promise.resolve(i)}))}))}))}(e).then((t=>{const o=L(t);return Promise.resolve({shouldConvertSR:!!o,searchText:o||e,locationPoint:t})})):Promise.resolve(o)}));function R(e){return e&&D(e)}const M=t=>j(void 0,void 0,void 0,(function*(){return(0,w.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((o=>{const[n,l]=o;return e.moduleLoader.loadModule("jimu-core/wkid").then((e=>{const{isValidWkid:o}=e;let r=null;if(!t)return r;const i=t.split(":"),s=i[0],a=Number(i[1]);if(a&&o(a)&&s){const e=s.split(","),t=Number(e[0]),o=Number(e[1]);isNaN(t)||isNaN(o)||(r=new n(t,o,new l({wkid:a})))}return Promise.resolve(r)}))}))}));function L(e){let t=null;return!e||isNaN(e.x)||isNaN(e.y)||(t="Y:"+e.y+",X:"+e.x),t}function P(){var t,o;const n=(0,e.getAppStore)().getState();return(null===(o=((null===(t=null==n?void 0:n.portalSelf)||void 0===t?void 0:t.helperServices)||{}).geometry)||void 0===o?void 0:o.url)||null}const D=e=>null==e?void 0:e.includes(",");var T=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const N={alias:"ADDRESS",type:"string",name:x},k=(Object.assign(Object.assign({},N),{jimuName:x}),(e,t,o,n)=>ue(null==t?void 0:t.outputDataSourceId)&&(null==t?void 0:t.isSupportSuggest)?E(t,e,o,n):Promise.resolve({})),E=(e,t,o,n)=>{var l;const r={geocodeURL:null==e?void 0:e.geocodeURL,address:t,maxSuggestion:null==e?void 0:e.maxSuggestions,utilityId:null===(l=null==e?void 0:e.useUtility)||void 0===l?void 0:l.utilityId,countryCode:null==e?void 0:e.countryCode,extent:o,enableLocalSearch:null==e?void 0:e.enableLocalSearch,minScale:null==e?void 0:e.minScale,jimuMapView:n};return U(r).then((o=>{if(!Array.isArray(o))return Promise.resolve({suggestionItem:[],layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon,err:o});let n=[];o.forEach(((o,l)=>{const r=o.text;if(r&&!function(e,t){return e.filter((e=>t===(null==e?void 0:e.suggestion))).length>0}(n,r)){const l={suggestionHtml:se(r,t),suggestion:r,configId:null==e?void 0:e.configId,magicKey:null==o?void 0:o.magicKey};n.push(l)}})),n=oe(n,"suggestion");const l={suggestionItem:n.splice(0,e.maxSuggestions),layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon};return Promise.resolve(l)})).catch((e=>Promise.reject(new Error(e))))},O=t=>{const{address:o,maxResultNumber:n,geocodeItem:l,searchResultView:r,extent:i,jimuMapView:s,id:a}=t;if(!ue(null==l?void 0:l.outputDataSourceId))return;return ae(te(l.outputDataSourceId),e.DataSourceStatus.NotReady),F({address:o,maxResultNumber:n,searchResultView:r,geocodeItem:l,extent:i,jimuMapView:s,id:a})},F=t=>{const{address:o,maxResultNumber:n,geocodeItem:l,extent:r,jimuMapView:i,id:s}=t,{outputDataSourceId:a,singleLineFieldName:u,defaultAddressFieldName:c,enableLocalSearch:d}=l,v=te(a),g={geocodeItem:l,address:o,maxResultNumber:n,singleLineFieldName:u,addressFields:(null==l?void 0:l.addressFields)||[],countryCode:null==l?void 0:l.countryCode,extent:r,enableLocalSearch:d,jimuMapView:i};return A(g).then((t=>T(void 0,void 0,void 0,(function*(){if(!Array.isArray(t))return Promise.resolve(!1);const n=null==t?void 0:t.filter((e=>null==e?void 0:e.address)),{extent:r,graphics:i}=function(e,t){let o;const n=(null==e?void 0:e.map(((e,n)=>{var l,r;const i=e.attributes;i.address=e.address,t&&(i[t]=e.address),i.objectid=n;const s=o?null==o?void 0:o.clone():o;o=s?null==s?void 0:s.union(null===(l=e.extent)||void 0===l?void 0:l.clone()):null===(r=e.extent)||void 0===r?void 0:r.clone();return{attributes:i,geometry:e.location}})))||[];return{graphics:n,extent:o}}(n,c),u=v,d=(null==l?void 0:l.label)||u.getLabel(),g=function(e,t){var o;if(!e||0===(null==e?void 0:e.length))return;const n={content:[{type:"fields",fieldInfos:e.map((e=>({fieldName:e.name,isEditable:!1,label:e.name,visible:!0})))},{type:"attachments",displayType:"auto"}],title:`${t}: {${null===(o=e[0])||void 0===o?void 0:o.name}}`};return n}(null==l?void 0:l.displayFields,d),m={id:`${a}_layer`,geometryType:"point",fullExtent:r};g&&(m.popupTemplate=g),yield u.setSourceFeatures(i,m);const p=o?e.DataSourceStatus.Unloaded:e.DataSourceStatus.NotReady;ae(v,p);const h={where:"2=2",sqlExpression:null,pageSize:null==n?void 0:n.length,outFields:["*"],page:1,returnGeometry:!0};return u.load(h,{widgetId:s}).then((t=>{const o=u.getRecords();return o.forEach(((e,t)=>{o[t].__extent=n[t].extent})),Promise.resolve(e.DataSourceStatus.Unloaded)}))})))).catch((e=>Promise.reject(new Error(e))))};const A=t=>T(void 0,void 0,void 0,(function*(){const{geocodeItem:o,address:l,maxResultNumber:r,singleLineFieldName:i,addressFields:s,countryCode:a,extent:u,jimuMapView:c}=t,{geocodeURL:d,magicKey:v,useUtility:g,enableLocalSearch:m,minScale:p}=o,h=(null==o?void 0:o.spatialReference)||n,f=R(l);let y;return f&&(y=yield C(l)),(0,w.loadArcGISJSAPIModules)(["esri/rest/locator","esri/geometry/SpatialReference"]).then((t=>{var o;const[n,S]=t,b=new S(h),I=i||"SingleLine";let w=(0,e.Immutable)({maxSuggestions:r});(null===(o=null==s?void 0:s.map((e=>null==e?void 0:e.jimuName)))||void 0===o?void 0:o.join(","))&&(w=w.set("outFields","*"));const x=f&&y.searchText?y.searchText:l;w=w.setIn([I],x),v&&(w=w.set("magicKey",v));const j={address:null==w?void 0:w.asMutable({deep:!0}),outSpatialReference:b};if(f&&y.locationPoint)j.location=y.locationPoint;else if(m){const e=$(m,p,c);e&&(j.location=e)}return a&&(j.countryCode=a),u&&(j.searchExtent=u.toJSON()),n.addressToLocations(d,j,{query:{}}).then((e=>(e=(e=e.sort(((e,t)=>t.score-e.score))).filter((e=>!!(null==e?void 0:e.location))),V(null==g?void 0:g.utilityId),e)),(e=>{console.error(e.message);const t=G(null==g?void 0:g.utilityId,e);return J(null==g?void 0:g.utilityId,e),t?e:[]}))}))})),U=e=>{const{geocodeURL:t,address:o,maxSuggestion:n,utilityId:l,countryCode:r,extent:i,enableLocalSearch:s,jimuMapView:a,minScale:u}=e;return(0,w.loadArcGISJSAPIModules)(["esri/rest/locator"]).then((e=>{const[c]=e,d={text:o,maxSuggestions:n};r&&(d.countryCode=r),i&&(d.searchExtent=i.toJSON());const v=$(s,u,a);return v&&(d.location=v),c.suggestLocations(t,d).then((e=>(V(l),e||[])),(e=>{console.error(e.message);const t=G(l,e);return J(l,e),t?e:[]}))}))};function $(e,t,o){var n,l;if(!e||!o||!t)return;let r;const i=null===(n=o.view)||void 0===n?void 0:n.scale,s=null===(l=o.view)||void 0===l?void 0:l.center;return i<t&&s&&(r=s),r}function V(t){t&&e.UtilityManager.getInstance().reportUtilityState(t,!0)}function J(t,o){if(!t)return;const n=G(t,o),l=e.UtilityManager.getInstance().utilityHasSignInError(t);n?e.UtilityManager.getInstance().reportUtilityState(t,!1,l):e.UtilityManager.getInstance().reportUtilityState(t,!1)}function G(t,o){var n,l,r,i;const s=e.UtilityManager.getInstance().utilityHasSignInError(t);let a=404===(null===(n=null==o?void 0:o.details)||void 0===n?void 0:n.httpStatus);return 400===(null===(l=null==o?void 0:o.details)||void 0===l?void 0:l.httpStatus)&&(null===(i=null===(r=null==o?void 0:o.details)||void 0===r?void 0:r.message)||void 0===i?void 0:i.includes("Item does not exist"))&&(a=!0),s||a}const B=(e,t,o,n=!1)=>{const l=null==e?void 0:e.outputDataSourceId,r=te(null==e?void 0:e.outputDataSourceId),i=null==r?void 0:r.getRecordsByPage(1,t);return Promise.resolve({records:i,configId:e.configId,dsId:l,isGeocodeRecords:!0,displayFields:null==e?void 0:e.displayFields})},_=(e,...t)=>T(void 0,[e,...t],void 0,(function*(e,t=n){const o=e&&e.coords;return o?(0,w.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{const[n,l]=e,r=new l(t);return new n({longitude:o.longitude,latitude:o.latitude,z:o.altitude||null,spatialReference:r})})):Promise.resolve(null)}));var K=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};function W(t,o,n,l,r){return K(this,void 0,void 0,(function*(){var i,s;if(!ue(null===(i=null==n?void 0:n.useDataSource)||void 0===i?void 0:i.dataSourceId))return Promise.resolve({});const a=(null==n?void 0:n.searchFields)||[],u=null===(s=null==l?void 0:l.filter((e=>(null==e?void 0:e.configId)===n.configId)))||void 0===s?void 0:s[0];return function(t,o,n,l,r,i){return K(this,void 0,void 0,(function*(){var s;const{label:a,icon:u,configId:c}=n,d=null===(s=null==o?void 0:o.useDataSource)||void 0===s?void 0:s.dataSourceId,v=te(d),g={searchText:t,searchFields:l.map((e=>e.name)),dataSource:v,maxSuggestions:r,extent:i};return e.dataSourceUtils.querySuggestions(g).then((e=>{const t={suggestionItem:null==e?void 0:e.map((e=>Object.assign(Object.assign({},e),{configId:c,isFromSuggestion:!0}))),layer:a,icon:u};return Promise.resolve(t)})).catch((e=>Promise.resolve({suggestionItem:[],layer:null,icon:null})))}))}(t,n,u,a,null==o?void 0:o.maxSuggestions,r)}))}function z(t,o,n,l){const r=o.map((e=>e.jimuName));return e.dataSourceUtils.getSQL(t,r,n,l)}function q(e,t,o){const n=(null==e?void 0:e.map((e=>e.jimuName)))||[],l=(null==t?void 0:t.map((e=>e.jimuName)))||[],r=te(o),i=(null==r?void 0:r.getAllUsedFields())||[];return"*"===i?"*":Array.from(new Set(n.concat(l).concat(i)))}const H=(t,o,n)=>{var l;const r=null===(l=null==t?void 0:t.useDataSource)||void 0===l?void 0:l.dataSourceId,i=ce(t.configId,n);if(!ue(r,i))return Promise.resolve({});const s=te(r,i),a=e.DataSourceManager.getInstance().getLocalDataSourceId(r,i),u=(null==s?void 0:s.getRecordsByPage)&&(null==s?void 0:s.getRecordsByPage(1,o));return Promise.resolve({records:u,configId:t.configId,dsId:r,localDsId:a,isGeocodeRecords:!1})};var Q=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const X=(e,t,o)=>{var n;let l;return e===d.MapCentric&&t&&o&&(l=null===(n=o.view)||void 0===n?void 0:n.extent),l};function Y(t){var o,n;const{serviceList:r,searchText:i,id:s}=t,a={};for(const e in r){const t=r[e],{searchServiceType:i,useDataSource:s}=t;if(i===l.FeatureService&&(null==s?void 0:s.dataSourceId)){const e=null==s?void 0:s.dataSourceId;let l=(null===(o=null==a?void 0:a[e])||void 0===o?void 0:o.sqlExpression)||null,r=(null===(n=a[e])||void 0===n?void 0:n.outFields)||[];const i=q(t.searchFields,t.displayFields,e)||[];a[e]?((null==t?void 0:t.SQL)&&l.push(null==t?void 0:t.SQL),r=Array.from(new Set(r.concat(i)))):(l=(null==t?void 0:t.SQL)?[null==t?void 0:t.SQL]:null,r=i,a[e]={}),a[e].sqlExpression=l,a[e].outFields=r}}!function(t,o,n){var l,r;for(const i in null==t?void 0:t.asMutable({deep:!0})){const s=null===(l=null==t?void 0:t[i])||void 0===l?void 0:l.sqlExpression,a=null===(r=null==t?void 0:t[i])||void 0===r?void 0:r.outFields,u=te(i);let c,d;n?s?(d=e.dataSourceUtils.getMergedSQLExpressions(null==s?void 0:s.asMutable({deep:!0}),u,e.ClauseLogic.Or),c=d.sql):(c="1=0",d=null):(c="1=1",d=null);const v=(0,e.Immutable)({outFields:a,where:c,sqlExpression:d,returnGeometry:!0});u&&u.updateQueryParams(v,o)}}((0,e.Immutable)(a),s,i)}const Z=(e,t,o,n)=>{var l;const r=null===(l=null==e?void 0:e.useDataSource)||void 0===l?void 0:l.dataSourceId,i=ce(o,t),s=te(r),a=te(r,i);a&&(null==a?void 0:a.updateQueryParams)&&(a&&a.updateQueryParams({},i),n&&s&&s.updateQueryParams({},t))},ee=(e,t,o,n=!1)=>{const r=[];for(const i in e){const s=e[i];let a;a=s.searchServiceType===l.FeatureService?H(s,t,o):B(s,t,0,n),r.push(a)}return Promise.all(r)},te=(t,o)=>{if(!t)return null;if(o){const n=e.DataSourceManager.getInstance(),l=n.getLocalDataSourceId(t,o);return n.getDataSource(l)}return e.DataSourceManager.getInstance().getDataSource(t)},oe=(e,t)=>{const o=e[0]?[e[0]]:[];for(let n=1;n<e.length;n++){const l=e[n];let r=!1;for(let e=0;e<o.length;e++)if(l[t]===o[e][t]){r=!0;break}r||o.push(l)}return o},ne=t=>{const o=e.urlUtils.getAppIdPageIdFromUrl().appId,n=le(o,t);let l=e.utils.readLocalStorage(n);l&&(l=unescape(l));return l?null==l?void 0:l.split("/@/"):[]},le=(e,t)=>`exb-${e}-${t}_recent_searches`,re=(e,t)=>{var o;return null===(o=null==e?void 0:e.filter((e=>e.configId===t)))||void 0===o?void 0:o[0]},ie=e=>{let t=0;for(const o in e)t++;return t};function se(t,o){if(!o)return t;const n=e.dataSourceUtils.getRegOfSearchText(o);return t.match(n)?t.replace(n,"<strong >$1</strong>"):t}function ae(e,t){null==e||e.setStatus(t),null==e||e.setCountStatus(t)}function ue(e,t){return!!e&&!!te(e,t)}const ce=(e,t)=>`${t}_${e}_useDataSource`,de=(t,o)=>{var n;let r=!0;for(const i in t){const s=t[i];let a;if(s.searchServiceType===l.FeatureService){const e=null===(n=null==s?void 0:s.useDataSource)||void 0===n?void 0:n.dataSourceId,t=ce(s.configId,o);a=te(e,t)}else{const e=null==s?void 0:s.outputDataSourceId;a=te(e)}const u=null==a?void 0:a.getStatus();u!==e.DataSourceStatus.Loading&&u!==e.DataSourceStatus.Unloaded||(r=!1)}return r},ve=t=>{var o,n;if(!t)return;const l=(0,e.getAppStore)().getState();return JSON.parse((null===(n=null===(o=null==l?void 0:l.urlHashObject)||void 0===o?void 0:o[t])||void 0===n?void 0:n.search_status)||"{}")},ge=(t,o)=>{if(!t)return;const n=o?JSON.stringify(o):null;e.UrlManager.getInstance().setWidgetUrlParams(t,{search_status:n})};function me(t,o){return Q(this,void 0,void 0,(function*(){const o=yield e.moduleLoader.loadModule("jimu-ui/advanced/setting-components"),{getOutputDsJson:n}=o;return function(t){return Q(this,void 0,void 0,(function*(){if(!t||0===t.length)return Promise.resolve([]);const o=t.map((t=>({id:t.dataSourceJson.id,dataSourceJson:(0,e.Immutable)(t.dataSourceJson)})));return yield Promise.allSettled(o.filter((e=>e.layer)).map((e=>Q(this,void 0,void 0,(function*(){var t;const o=null===(t=e.layer.sourceJSON)||void 0===t?void 0:t.capabilities;o&&(yield e.layer.load(),e.layer.sourceJSON.capabilities=o)}))))),Promise.allSettled(o.map((t=>e.DataSourceManager.getInstance().createDataSource(t).then((e=>e.isDataSourceSet()&&!e.areChildDataSourcesCreated()?e.childDataSourcesReady().then((()=>e)):e))))).then((e=>e.filter((e=>"fulfilled"===e.status)).map((e=>e.value)))).then((e=>e.length<t.length?Promise.reject(new Error("Failed to create some data source.")):e))}))}(null==(t=null==t?void 0:t.filter((e=>{const t=null==e?void 0:e.outputDataSourceId;return!te(t)})))?void 0:t.map(((e,t)=>({dataSourceJson:n(e,!0),order:t}))))}))}const{useRef:pe,useState:he,useEffect:fe}=e.React,ye=e.css`
& {
  box-sizing: border-box;
  width: ${e.polished.rem(32)};
}
.setting-dropdown-button {
  height: ${e.polished.rem(32)};
  border-radius: 0;
  .dropdown-button-content {
    text-align: center;
  }
  svg {
    margin: 0 !important;
  }
}
&.ds-setting-Style1 {
  .setting-dropdown-button {
    border-radius: ${e.polished.rem(4)} 0 0 ${e.polished.rem(4)};
  }
}
&.ds-setting-Style2 {
  & {
    margin-right: ${e.polished.rem(4)};
  }
  .setting-dropdown-button {
    border-radius: 50%;
  }
}
&.ds-setting-Style3 {
  .setting-dropdown-button {
    background: none;
    border: none;
  }
}
`,Se=t=>{const o=e.hooks.useTranslation(g,v.defaultMessages),[n,r]=he(!0),[i,s]=he(!1),[a,u]=e.React.useState(!1),{className:c,datasourceConfig:m,dsStatus:p,config:h,id:y,useDataSources:S,synchronizeSettings:b,showLoading:w,onDatasourceConfigChange:x}=t,j=pe(null),C=pe(null),R=pe(null),M=t=>{const o=[];null==t||t.forEach((e=>{e.enable&&o.push(e.configId)})),((t,o,n)=>{if(!o||!t)return;const l=ve(t)||{};l[o]=n,e.UrlManager.getInstance().setWidgetUrlParams(t,{search_status:JSON.stringify(l)})})(y,"serviceEnabledList",o)};fe((()=>{const e=null==m?void 0:m.filter((e=>!(null==e?void 0:e.enable))),t=0===(null==e?void 0:e.length),o=(null==e?void 0:e.length)>0&&(null==e?void 0:e.length)<(null==m?void 0:m.length);s(o),r(t)}),[m]);return(0,e.jsx)("div",{className:`${c||""} ds-setting-${h.arrangementStyle}`,onKeyDown:t=>{"Escape"===t.key&&(u(!1),(0,e.focusElementInKeyboardMode)(C.current))},css:ye,role:"group","aria-label":o("searchIn",{value:""})},w&&(0,e.jsx)(v.Button,{icon:!0,className:"setting-dropdown-button"},(0,e.jsx)(v.Loading,{width:14,height:14,type:v.LoadingType.Donut})),!w&&(0,e.jsx)(v.Dropdown,{className:"w-100 h-100",menuItemCheckMode:"multiCheck",toggle:t=>{a||setTimeout((()=>{(0,e.focusElementInKeyboardMode)(R.current,!0)}),200),u(!a)},isOpen:a},(0,e.jsx)(v.DropdownButton,{ref:C,className:"setting-dropdown-button",arrow:!1,icon:!0,title:o("searchIn",{value:""})},!a&&(0,e.jsx)(f,{size:16,className:"mr-1 d-inline-block",autoFlip:!0}),a&&(0,e.jsx)(I,{size:16,className:"mr-1 d-inline-block",autoFlip:!0})),(0,e.jsx)(v.DropdownMenu,{trapFocus:!1,autoFocus:!1,style:{maxHeight:"auto"}},(0,e.jsx)("div",{ref:j},(0,e.jsx)(v.DropdownItem,{toggle:!1,onClick:()=>{const e=!n,t=null==m?void 0:m.map((t=>{var o;return null===(o=t.setIn(["enable"],e))||void 0===o?void 0:o.asMutable({deep:!0})}));M(t),x(t)},title:o("all"),ref:R},(0,e.jsx)(v.Checkbox,{checked:n&&!i,indeterminate:i,className:"mr-2"}),o("all")),(0,e.jsx)(v.DropdownItem,{divider:!0}),null==m?void 0:m.map(((t,n)=>{var r;const i=p[t.configId]===e.DataSourceStatus.LoadError||p[t.configId]===e.DataSourceStatus.CreateError,s=t.searchServiceType===l.GeocodeService,a=((t,o=!1)=>{var n;let l;if(!1!==b&&(null==h?void 0:h.sourceType)===d.MapCentric)return!0;if(o){const o=(0,e.getAppStore)().getState().appConfig,r=null===(n=null==o?void 0:o.widgets)||void 0===n?void 0:n[y],i=(null==r?void 0:r.outputDataSources)||[];l=(null==i?void 0:i.filter((e=>t===e)).length)>0}else l=(null==S?void 0:S.filter((e=>t===e.dataSourceId)).length)>0;return l&&t})(s?t.outputDataSourceId:t.useDataSource.dataSourceId,s),u=1===(null===(r=null==m?void 0:m.filter((e=>null==e?void 0:e.enable)))||void 0===r?void 0:r.length)&&(null==t?void 0:t.enable)&&i;return(0,e.jsx)(v.DropdownItem,{toggle:!1,key:`${null==t?void 0:t.label}${n}`,title:null==t?void 0:t.label,disabled:u,onClick:()=>{((e,t)=>{const o=null==m?void 0:m.setIn([t,"enable"],e);M(o),x(o)})(!(null==t?void 0:t.enable),n)}},(0,e.jsx)("div",{className:"d-flex w-100 h-100 align-items-center"},(0,e.jsx)("div",{className:"flex-grow-1 d-flex align-items-center"},(0,e.jsx)(v.Checkbox,{checked:null==t?void 0:t.enable,disabled:u,className:"mr-2"}),(0,e.jsx)("div",{className:"flex-grow-1"},null==t?void 0:t.label)),(i||!a)&&(0,e.jsx)(v.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:o("dataSourceCreateError")})))}))))))};var be=s(1888);const Ie=(t,o)=>{var n,l,r,i,s,a,u,c,d,v,g,m,p,h;return e.css`
    & {
      padding-top: 0;
      padding-bottom: 0;
      box-sizing: border-box;
      /* visibility: unset !important; */
    }
    &.hide-popper {
      border: none;
      outline: none;
      box-shadow: none;
      width: 0;
    }
    button {
      width: 100%;
      border: none;
      text-align: left;
      min-height: ${e.polished.rem(32)};
      border-radius: 0;
    }
    .result-list-content {
      position: relative;
      overflow: auto;
    }
    &.suggestion-list-con, .result-list-content {
      max-height: ${e.polished.rem(300)};
    }
    &.suggestion-list-con {
      overflow: auto;
    }
    &.result-list-con button {
      text-overflow: ellipsis;
      white-space: pre-wrap;
      &:focus-visible {
        background: var(--ref-palette-neutral-200);
      }
    }
    &.result-list-con :disabled, &.result-list-con button:disabled:hover {
      color: ${null===(l=null===(n=null==t?void 0:t.sys.color)||void 0===n?void 0:n.secondary)||void 0===l?void 0:l.dark};
      background-color: ${null===(i=null===(r=null==t?void 0:t.ref.palette)||void 0===r?void 0:r.neutral)||void 0===i?void 0:i[300]};
    }
    &.result-list-con button:hover {
      color: ${null===(s=null==t?void 0:t.ref.palette)||void 0===s?void 0:s.black};
      background-color: ${null===(u=null===(a=null==t?void 0:t.ref.palette)||void 0===a?void 0:a.neutral)||void 0===u?void 0:u[200]};
    }
    &.result-list-con button:focus-visible {
      color: ${null===(c=null==t?void 0:t.ref.palette)||void 0===c?void 0:c.black};
      background-color: ${null===(v=null===(d=null==t?void 0:t.ref.palette)||void 0===d?void 0:d.neutral)||void 0===v?void 0:v[200]};
    }
    &.result-list-con .jimu-dropdown-item-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con button.active {
      background: ${null===(g=null==t?void 0:t.sys.color)||void 0===g?void 0:g.primary.main};
      color: ${null===(m=null==t?void 0:t.ref.palette)||void 0===m?void 0:m.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:hover {
      background-color: ${null===(p=null==t?void 0:t.ref.palette)||void 0===p?void 0:p.white};
    }
    &.result-list-con .show-result-button:focus-visible {
      background-color: ${null===(h=null==t?void 0:t.ref.palette)||void 0===h?void 0:h.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
    .jimu-dropdown-item {
      min-height: ${e.polished.rem(32)};
    }
    .clear-recent-search-con {
      color: var(--sys-color-primary-main) !important;
      height: ${e.polished.rem(40)};
      margin-top: ${e.polished.rem(-4)};
    }
    .jimu-dropdown-item-divider {
      min-height: 0;
    }
    .item-p-l {
      padding-left: ${e.polished.rem(42)} !important;
    }
    .source-label-con {
      color: var(--ref-palette-black) !important;
      font-weight: bold !important;
    }
    .show-result-button-style2 {
      & {
        padding: 0;
        height: ${e.polished.rem(11)};
        min-height: ${e.polished.rem(11)};
        justify-content: center;
        align-items: center;
      }
      svg {
        margin-right: 0;
      }
    }
    &.result-list-con-compact-close {
      & {
        width: ${e.polished.rem(32)};
        border-top: 0;
        justify-content: center;
      }
      .show-result-button {
        & {
          border-radius: 0 0 0.25rem 0.25rem;
          padding: 0;
          height: ${e.polished.rem(8)};
          min-height: ${e.polished.rem(8)};
          justify-content: center;
          align-items: center;
        }
        svg {
          margin-right: 0;
          height: ${e.polished.rem(8)};
        }
      }
    }
    &.result-list-con-compact-open {
      .show-result-button-style2-con {
        position: -webkit-sticky;
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--ref-palette-white);
      }
    }
  `},{useEffect:we,useRef:xe}=e.React,je={apply({elements:e,rects:t}){const o=t.reference.width;o&&(e.floating.style.width=`${o}px`)}},Ce={apply({elements:e,rects:t}){"33px"!==e.floating.style.width&&(e.floating.style.width="33px")}},Re=t=>{const n=xe(null),l=xe(null),{children:r,isOpen:i,reference:s,searchInputRef:a,autoFocus:u,className:c,differentWithReferenceWidth:d,isFocusWithSearchInput:g,id:m,offset:p,containerEventPreventDefault:h,toggle:f}=t,y=(0,be.useTheme)(),S=e.ReactRedux.useSelector((e=>{var t;const o=null==e?void 0:e.widgetsRuntimeInfo;return null===(t=null==o?void 0:o[m])||void 0===t?void 0:t.state}));we((()=>{var e;return(null==a?void 0:a.current)&&g&&(null===(e=a.current)||void 0===e||e.addEventListener("keydown",b,!0)),()=>{var e;g&&(null===(e=a.current)||void 0===e||e.removeEventListener("keydown",b,!0))}}),[]);const b=e.hooks.useEventCallback((t=>{if(!i)return!1;const o=x()||[],n=(null==o?void 0:o.length)-1;"ArrowUp"===t.key?l.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(o[n])})):"ArrowDown"===t.key&&(l.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(o[0])})))})),I=e.hooks.useEventCallback((t=>{if(!i)return;const o="button"===t.target.getAttribute("role")||"option"===t.target.getAttribute("role");if(["Tab","ArrowUp","ArrowDown","Escape"].includes(t.key)&&((t.which>=48&&t.which<=90||"Tab"===t.key)&&t.preventDefault(),i&&o))if(clearTimeout(l.current),"Escape"===t.key)w(t);else if(["ArrowUp","ArrowDown","Tab"].includes(t.key)||["n","p"].includes(t.key)&&t.ctrlKey){const o=x();let r=o.indexOf(t.target),i=!1;"ArrowUp"===t.key||"p"===t.key&&t.ctrlKey||"Tab"===t.key&&(t.shiftKey||1===o.length)?(r=0!==r?r-1:o.length-1,i=!0):("ArrowDown"===t.key||"Tab"===t.key||"n"===t.key&&t.ctrlKey)&&(i=!1,r=r===o.length-1?0:r+1);const s=0===r&&!i,u=r===o.length-1&&i;g&&(s||u)?l.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(a.current,!0)})):((0,e.focusElementInKeyboardMode)(Array.prototype.slice.call(n.current.querySelectorAll(".popper-box"))[0],!0),l.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(o[r],!0)}))),["ArrowUp","ArrowDown"].includes(t.key)&&t.preventDefault()}else if("End"===t.key){const t=x();l.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(t[t.length-1],!0)}))}else if("Home"===t.key){const t=x();l.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(t[0],!0)}))}else if(t.which>=48&&t.which<=90){const o=x(),n=String.fromCharCode(t.which).toLowerCase();for(let t=0;t<o.length;t+=1){if((o[t].textContent&&o[t].textContent[0].toLowerCase())===n){l.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(o[t],!0)}));break}}}})),w=t=>{t.preventDefault(),j(t),e.lodash.defer((()=>{(0,e.focusElementInKeyboardMode)(null==a?void 0:a.current,!0)}))},x=()=>n?Array.prototype.slice.call(n.current.querySelectorAll('[role="button"], [role="option"]')).filter((e=>!e.disabled)):[],j=t=>{f(t),"Escape"===(null==t?void 0:t.key)&&e.lodash.defer((()=>{(0,e.focusElementInKeyboardMode)(null==a?void 0:a.current)}))};return(0,e.jsx)("div",null,(0,e.jsx)(v.Popper,{autoFocus:u,placement:"bottom-start",open:i,toggle:j,reference:s,autoUpdate:!0,offsetOptions:p||o,ref:n,sizeOptions:d?Ce:je,forceLatestFocusElements:!0},(0,e.jsx)("div",{onMouseDown:e=>{h&&e.preventDefault()},css:Ie(y),className:(0,e.classNames)("result-list-popper",c,{"hide-popper":S===e.WidgetState.Closed})},(0,e.jsx)("div",{style:{userSelect:"none"},onKeyDown:I},r))))},{useState:Me,useRef:Le,useEffect:Pe}=e.React,De=e.css`
  & .utility-err-remind-con {
    bottom: 0;
  }
`,Te=t=>{const o=e.hooks.useTranslation(v.defaultMessages,e.defaultMessages),n=Le(null),{serviceList:r,open:i,toggleUtilityErrorRemind:s}=t,[a,u]=Me(null),c=e.ReactRedux.useSelector((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.utilityStates}));Pe((()=>{i&&(clearTimeout(n.current),n.current=setTimeout((()=>{s(!1)}),5e3))}),[i]),Pe((()=>{d(c)}),[c]);const d=e=>{var t;if(!r)return;let o=null,n=[],i=[];if(null===(t=Object.keys(r))||void 0===t||t.forEach((t=>{var o;const s=r[t];if(s.searchServiceType===l.GeocodeService){const t=null===(o=null==s?void 0:s.useUtility)||void 0===o?void 0:o.utilityId;if(t){const o=null==e?void 0:e[t];(null==o?void 0:o.isSignInError)?i.push(t):!1===(null==o?void 0:o.success)&&n.push(t)}}})),n=g(n),i=g(i),0===(null==n?void 0:n.length)&&(null==i?void 0:i.length)>0)o=m(i);else if(0===(null==i?void 0:i.length)&&(null==n?void 0:n.length)>0)o=p(n);else if((null==i?void 0:i.length)>0&&(null==n?void 0:n.length)>0){o=`${m(i)} ${p(n)}`}u(o)},g=(t=[])=>(t=Array.from(new Set(t))).map((t=>{const o=e.UtilityManager.getInstance().getUtilityJson(t);return null==o?void 0:o.label})),m=e=>{let t=null;return 1===ie(r)?(null==e?void 0:e.length)>0&&(t=o("signInErrorDefault")):(null==e?void 0:e.length)>0&&(t=o("signInErrorsDefault",{names:e.join(", ")})),t},p=e=>{let t=null;return 1===ie(r)?1===(null==e?void 0:e.length)&&(t=o("utilityInaccessible")):(null==e?void 0:e.length)>0&&(t=o("utilityNotAvailableWidthName",{name:e.join(", ")})),t};return(0,e.jsx)("div",{className:"position-relative w-100",css:De},(0,e.jsx)("div",{className:"w-100 utility-err-remind-con"},(0,e.jsx)(v.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,closable:!0,onClose:()=>{s(!1)},text:a,title:a})))},{useRef:Ne}=e.React,ke=new(0,e.esri.Sanitizer),Ee=t=>{const{className:o,reference:n,searchSuggestion:l,isOpen:r,canUseOutputDsLength:i,id:s,searchInputRef:a,openUtilityErrRemindInSuggestion:u,serviceList:c,searchText:d,toggleSuggestionUtilityError:g,toggle:m,onRecordItemClick:p,setSuggestionFirstItem:h}=t,f=(0,be.useTheme)(),y=Ne(!1),S=()=>{if((null==l?void 0:l.length)<2)return!1;let e=0,t=0;return null==l||l.forEach((o=>{var n;const l=null==o?void 0:o.icon;l&&(e+=1),(null===(n=o.suggestionItem)||void 0===n?void 0:n.length)>0&&l&&(t+=1)})),t>0&&e>0},b=(t,o=!1)=>{const n=null==t?void 0:t.suggestionItem,l=null==t?void 0:t.icon;return null==n?void 0:n.map(((n,r)=>{var s;const a=ke.sanitize(n.suggestionHtml),u={configId:null==n?void 0:n.configId,isFromSuggestion:null==n?void 0:n.isFromSuggestion,magicKey:null==n?void 0:n.magicKey};return(0,e.jsx)(v.Button,{className:(0,e.classNames)("d-flex align-items-center py-2 jimu-outline-inside",{"item-p-l":o}),key:`${null==t?void 0:t.layer}${r}`,title:n.suggestion,"aria-label":n.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:o,isFromSuggestion:n,magicKey:l}=t||{};o&&(n||l)?p(e,t):p(e)})(n.suggestion,u)},ref:e=>{I(r,e)}},l&&1===i&&(0,e.jsx)(v.Icon,{className:"mr-2",color:null===(s=null==f?void 0:f.sys.color)||void 0===s?void 0:s.primary.main,size:16,icon:null==l?void 0:l.svg}),(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:a}}))}))},I=(e,t)=>{0===e&&!y.current&&t&&(h(t),y.current=!0)};return(0,e.jsx)("div",null,(0,e.jsx)(Re,{isOpen:r&&!(()=>{let e=[];return l.forEach((t=>{const o=(null==t?void 0:t.suggestionItem)||[];e=e.concat(o)})),d&&0===e.length})()||u,autoFocus:!1,reference:n,searchInputRef:a,isFocusWithSearchInput:!0,toggle:m,id:s,containerEventPreventDefault:!0,className:(0,e.classNames)("result-list-con suggestion-list-con",o)},!u&&(y.current=null,null==l?void 0:l.map(((t,o)=>{var n,r,i;const s=(null==l?void 0:l.length)>1&&(null===(n=null==t?void 0:t.suggestionItem)||void 0===n?void 0:n.length)>0;return(0,e.jsx)("div",{key:`${null==t?void 0:t.layer}-${o}`,role:"listbox","aria-label":null==t?void 0:t.layer},s&&(0,e.jsx)(v.Button,{"aria-label":null==t?void 0:t.layer,role:"button",className:"source-label-con jimu-outline-inside",disabled:!0,title:null==t?void 0:t.layer},(null==t?void 0:t.icon)&&(0,e.jsx)(v.Icon,{className:"mr-2",color:null===(r=null==f?void 0:f.sys.color)||void 0===r?void 0:r.primary.main,size:16,icon:null===(i=null==t?void 0:t.icon)||void 0===i?void 0:i.svg}),(0,e.jsx)("div",{className:"flex-grow-1"},null==t?void 0:t.layer)),b(t,S()))}))),u&&(0,e.jsx)(Te,{open:u,serviceList:c,toggleUtilityErrorRemind:g})))};var Oe=s(9044),Fe=s.n(Oe),Ae=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const Ue=t=>{const o=window.SVG,{className:n}=t,l=Ae(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:Fe()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var $e=s(21210),Ve=s.n($e),Je=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const Ge=t=>{const o=window.SVG,{className:n}=t,l=Je(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:Ve()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var Be=s(28996),_e=s.n(Be),Ke=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const We=t=>{const o=window.SVG,{className:n}=t,l=Ke(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:_e()},l)):e.React.createElement("svg",Object.assign({className:r},l))},ze=t=>{const o=e.hooks.useTranslation(g,v.defaultMessages),{serviceList:r,locationLoading:i,isGetLocationError:s,onLocationChange:a,handleLocationLoadingChange:u}=t,[c,d]=e.React.useState(null);e.React.useEffect((()=>{m()}),[r]);const m=()=>{var e;for(const t in r){const o=null===(e=r[t])||void 0===e?void 0:e.asMutable({deep:!0});if(o.searchServiceType===l.GeocodeService){d(o);break}}},p=e=>{u(!1);const t=`${e.coords.longitude},${e.coords.latitude}`;if(c){((e,t,o=n)=>t?(0,w.loadArcGISJSAPIModules)(["esri/rest/locator","esri/geometry/SpatialReference"]).then((n=>{const[l,r]=n;return _(t,o).then((t=>{const n=new r(o);return l.locationToAddress(e,{location:t,outSpatialReference:n},{query:{}}).then((e=>Promise.resolve(e.address)),(e=>(console.error(e.message),Promise.reject(new Error(e.message)))))}))})):Promise.resolve(null))(null==c?void 0:c.geocodeURL,e,null==c?void 0:c.spatialReference).then((e=>{a(e)}),(e=>{a(t)}))}else a(t)},h=e=>{u(!1),a(null,null,!0)};return(0,e.jsx)("div",null,!s&&(0,e.jsx)(v.Button,{className:"text-left d-block",role:"button",onClick:()=>{if(i)return!1;u(!0),((e,t)=>{if(navigator.geolocation){const o={enableHighAccuracy:!0,timeout:3e3,maximumAge:1e4};navigator.geolocation.getCurrentPosition(e,t,o)}else t&&t()})(p,h)},"aria-label":o("useCurrentLocation"),title:o("useCurrentLocation")},(0,e.jsx)(Ge,{className:"mr-2"}),o("useCurrentLocation")),s&&(0,e.jsx)(v.Button,{className:"text-left d-block",role:"button","aria-label":o("couldNotRetrieve"),title:o("couldNotRetrieve")},(0,e.jsx)(We,{className:"mr-2"}),o("couldNotRetrieve")))},{useRef:qe}=e.React,He=new(0,e.esri.Sanitizer),Qe=t=>{var o,n,l,r;const i=e.hooks.useTranslation(g,v.defaultMessages),{className:s,reference:a,recentSearchesData:u,isOpen:c,isGetLocationError:d,serviceList:m,config:p,id:h,searchInputRef:f,locationLoading:y,toggle:S,onRecordItemClick:b,clearSearches:I,setSuggestionFirstItem:w,handleLocationLoadingChange:x}=t,j=qe(!1),C=t=>{const o=null==t?void 0:t.suggestionItem;return null==o?void 0:o.map(((o,n)=>{const l=He.sanitize(o.suggestionHtml),r={configId:null==o?void 0:o.configId,isFromSuggestion:null==o?void 0:o.isFromSuggestion,magicKey:null==o?void 0:o.magicKey};return(0,e.jsx)(v.Button,{className:(0,e.classNames)("d-flex align-items-center py-2 jimu-outline-inside"),key:`${null==t?void 0:t.layer}${n}`,title:o.suggestion,"aria-label":o.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:o,isFromSuggestion:n,magicKey:l}=t||{};o&&(n||l)?b(e,t):b(e)})(o.suggestion,r)},ref:e=>{R(n,e)}},(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:l}}))}))},R=(e,t)=>{0!==e||j.current||(w(t),j.current=!0)};return(0,e.jsx)("div",null,(0,e.jsx)(Re,{isOpen:c,autoFocus:!1,reference:a,searchInputRef:f,isFocusWithSearchInput:!0,toggle:S,id:h,className:(0,e.classNames)("result-list-con suggestion-list-con",s)},p.isUseCurrentLoation&&(0,e.jsx)(ze,{serviceList:m,isShowCurrentLocation:!0,onLocationChange:b,locationLoading:y,isGetLocationError:d,handleLocationLoadingChange:x}),(j.current=null,null==u?void 0:u.map(((t,o)=>(0,e.jsx)("div",{key:`${null==t?void 0:t.layer}-${o}`,role:"group","aria-label":null==t?void 0:t.layer},C(t))))),p.isShowRecentSearches&&(null===(n=null===(o=u[0])||void 0===o?void 0:o.suggestionItem)||void 0===n?void 0:n.length)>0&&(0,e.jsx)(v.DropdownItem,{divider:!0}),p.isShowRecentSearches&&(null===(r=null===(l=u[0])||void 0===l?void 0:l.suggestionItem)||void 0===r?void 0:r.length)>0&&(0,e.jsx)(v.Button,{role:"button",className:"clear-recent-search-con jimu-outline-inside text-left d-block","aria-label":i("clearRecentSearches"),title:i("clearRecentSearches"),onClick:I},(0,e.jsx)(Ue,{className:"mr-2"}),i("clearRecentSearches"))))},{useEffect:Xe,useRef:Ye}=e.React,Ze=t=>{const n=e.hooks.useTranslation(g),{reference:l,searchText:i,id:s,config:a,serviceList:c,isOpenResultListDefault:d,searchInputRef:m,searchResult:p,selectionList:h,openUtilityErrRemindInResult:y,isOpenResultPopper:S,isToOtherWidget:b,datasourceConfig:w,toggleResultUtilityError:x,setResultFirstItem:j,handleDsIdOfSelectedResultItemChange:C}=t,{resultMaxNumber:R}=a,M=Ye([]),L=Ye(!1),P=Ye(null),D=Ye(null),T=Ye(!1),N=Ye((0,e.Immutable)({})),k=Ye({}),E=Ye(null),O=Ye(!1),F=Ye(!1),A=Ye(null),U=e.ReactRedux.useSelector((e=>e.appContext.isRTL));let $={};const V=(0,be.useTheme)(),[J,G]=e.React.useState((0,e.Immutable)({})),[B,_]=e.React.useState(d),[K,W]=e.React.useState(u.Classic),[z,q]=e.React.useState(!1),[H,Q]=e.React.useState(o);Xe((()=>{M.current=[],A.current=i}),[i]),Xe((()=>{L.current=!1;de(null==c?void 0:c.asMutable({deep:!0}),s)&&(b||S)&&X()}),[p,b,S]),Xe((()=>{(S||b)&&(_(!0),F.current=!0,O.current=!1,G((0,e.Immutable)({})),k.current={})}),[S,b]),Xe((()=>{(null==a?void 0:a.searchResultStyle)&&(null==a?void 0:a.searchResultStyle)!==K&&W(null==a?void 0:a.searchResultStyle)}),[a]),Xe((()=>{ye(K,B,z)}),[K,B,z]);const X=()=>{const t=ee(null==c?void 0:c.asMutable({deep:!0}),R,s);Promise.all([t]).then((t=>{L.current=!0;let o=(0,e.Immutable)({}),n=[];null==t||t.forEach((e=>{n=n.concat(e)}));const l={};n.forEach((e=>{const{records:t,configId:n,dsId:r,isGeocodeRecords:i,localDsId:s}=e;l[n]=t;let a=ce(t,n,r,i,s);a=Y(a),ve(a),o=o.setIn([n],a)})),N.current=o,(null==a?void 0:a.searchResultView)!==r.OtherWidgets&&G(o),k.current=l,me()}))},Y=e=>e.sort(((e,t)=>{var o,n,l,r,i,s;const a=null===(n=null===(o=null==e?void 0:e.value)||void 0===o?void 0:o.join(","))||void 0===n?void 0:n.toLocaleLowerCase(),u=null===(r=null===(l=null==t?void 0:t.value)||void 0===l?void 0:l.join(","))||void 0===r?void 0:r.toLocaleLowerCase();return(a.startsWith(null===(i=A.current)||void 0===i?void 0:i.toLocaleLowerCase())?0:1)-(u.startsWith(null===(s=A.current)||void 0===s?void 0:s.toLocaleLowerCase())?0:1)})),Z=()=>{var e;if(ie(c)<2)return!1;let t=0,o=0;for(const n in J){const l=re(w,n),r=null==l?void 0:l.icon;r&&(t+=1),(null===(e=J[n])||void 0===e?void 0:e.length)>0&&r&&(o+=1)}return o>0&&t>0},oe=e.hooks.useEventCallback(((t,o,n=!1)=>null==t?void 0:t.map(((t,l)=>{var r,i,s,a;const{configId:u,value:d,recordId:g,outputDsId:m}=t,p=ge(u,g),h=null===(i=null===(r=null==o?void 0:o.asMutable({deep:!0}))||void 0===r?void 0:r[u])||void 0===i?void 0:i.includes(g),f=re(w,u),y=null==f?void 0:f.icon,S=h?null===(s=null==V?void 0:V.ref.palette)||void 0===s?void 0:s.white:null===(a=null==V?void 0:V.sys.color)||void 0===a?void 0:a.primary.main,b=ie(c);return(0,e.jsx)(v.Button,{className:(0,e.classNames)("d-flex align-items-center jimu-outline-inside",{"item-p-l":n}),key:p,role:"option","aria-selected":h,active:h,title:d.join(", "),"aria-label":d.join(", "),ref:e=>{ne(l,e)},onClick:()=>{le({isActive:h,key:p,recordId:g,dsId:m,configId:u})}},y&&1===b&&(0,e.jsx)(v.Icon,{className:"mr-2",color:S,size:16,icon:null==y?void 0:y.svg}),(0,e.jsx)("div",{className:"flex-grow-1"},d.join(", ")))})))),ne=(e,t)=>{0===e&&!T.current&&F.current&&t&&(j(t),T.current=!0)},le=e.hooks.useEventCallback((e=>{var t,o,n,l,r,i;const{isActive:s,recordId:a,dsId:u,configId:c}=e,d=null===(n=null===(o=null===(t=N.current)||void 0===t?void 0:t[c])||void 0===o?void 0:o[0])||void 0===n?void 0:n.localDsId,v=null===(i=null===(r=null===(l=N.current)||void 0===l?void 0:l[c])||void 0===r?void 0:r[0])||void 0===i?void 0:i.isGeocodeRecords,g=te(v?u:d),m=s?[]:ue(c,a);se(u,d,m),C(a?u:null),a&&(!s&&ae(c),clearTimeout(E.current),E.current=setTimeout((()=>{s?null==g||g.selectRecordsByIds([]):null==g||g.selectRecordsByIds([a])}),100))})),se=(t,o,n)=>{var l;if(o){const e=te(t);n=n.map((t=>e.buildRecord(t.feature)))}const r=new e.DataRecordsSelectionChangeMessage(s,n,[t]),i=null===(l=n[0])||void 0===l?void 0:l.__extent;i&&(r.extent=i),e.MessageManager.getInstance().publishMessage(r)},ae=e=>{var t,o,n,l,r,i;const s=N.current;for(const a in s)if(e!==a){const e=null===(o=null===(t=s[a])||void 0===t?void 0:t[0])||void 0===o?void 0:o.outputDsId,u=null===(l=null===(n=null==s?void 0:s[a])||void 0===n?void 0:n[0])||void 0===l?void 0:l.localDsId,c=null===(i=null===(r=null==s?void 0:s[a])||void 0===r?void 0:r[0])||void 0===i?void 0:i.isGeocodeRecords,d=te(c?e:u);d&&d.selectRecordsByIds([])}},ue=(e,t)=>{var o;const n=(null===(o=k.current)||void 0===o?void 0:o[e])||[];return(null==n?void 0:n.filter((e=>(null==e?void 0:e.getId())===t)))||[]},ce=(t,o,n,l,r)=>{var i;const s=(null===(i=null==c?void 0:c[o])||void 0===i?void 0:i.displayFields)||[],a=[],u=e.i18n.getIntl();return null==t||t.forEach((e=>{const t=[];s.forEach((o=>{const n=e.getFormattedFieldValue(o.jimuName,u);(n||0===n)&&t.push(n)}));const i={value:t,configId:o,outputDsId:n,recordId:null==e?void 0:e.getId(),isGeocodeRecords:l,localDsId:r};a.push(i)})),a},ve=e=>{e.forEach((e=>{!(null==$?void 0:$.recordId)&&e.recordId&&($=e)}))},ge=(e,t)=>`${e}_${t}`,me=()=>{const e=de(null==c?void 0:c.asMutable({deep:!0}),s);if(!(null==a?void 0:a.isAutoSelectFirstResult)||!(null==$?void 0:$.recordId)||O.current||!e)return;const{configId:t,recordId:o,outputDsId:n}=$,l=ge(t,o);le({isActive:!1,key:l,recordId:o,dsId:n,configId:t}),O.current=!0},pe=()=>{ye(K,!B,z),B&&j(D.current),_(!B),F.current=!B},he=e.React.useCallback((e=>{var t;let o=0;for(const n in e){o+=(null===(t=null==e?void 0:e[n])||void 0===t?void 0:t.length)||0}const n=ie(c);q(0===n||0===o&&L.current)}),[c]),fe=e.hooks.useEventCallback((e=>{B&&(_(!1),F.current=!1,j(D.current))})),ye=(e,t,n)=>{var r;let i=o;if(e===u.Compact)if(t||n)i=o;else{const e=(null===(r=null==l?void 0:l.current)||void 0===r?void 0:r.clientWidth)/2-15||0;i=U?[-e,0]:[e,0]}else i=o;Q(i)};return Xe((()=>{he(J)}),[J,he]),(0,e.jsx)("div",{role:"group","aria-label":n("searchResults")},(0,e.jsx)(Re,{isOpen:S,isFocusWithSearchInput:!0,autoFocus:!1,reference:l,searchInputRef:m,toggle:fe,id:s,offset:H,differentWithReferenceWidth:((e,t,o)=>t===u.Compact&&!e&&!!o)(B,K,i),className:(0,e.classNames)("result-list-con",K!==u.Compact||z?"":B?"result-list-con-compact-open":"result-list-con-compact-close")},(0,e.jsx)("div",{className:"result-list-content",role:"listbox"},!y&&(0,e.jsx)("div",{ref:P},z&&(0,e.jsx)(v.Button,{role:"button",className:"text-center",disabled:!0,"aria-label":n("noResult",{searchText:i}),title:n("noResult",{searchText:i})},(0,e.jsx)("span",{role:"warning"},n("noResult",{searchText:i}))),!z&&(0,e.jsx)("div",null,K===u.Classic&&(0,e.jsx)("div",null,(0,e.jsx)(v.Button,{role:"button",ref:D,className:"d-flex align-items-center show-result-button jimu-outline-inside",onClick:pe,"aria-label":n("searchResults"),title:n("searchResults")},(0,e.jsx)("div",{className:"flex-grow-1 font-weight-bold"},n("searchResults")),!B&&i?(0,e.jsx)(f,null):(0,e.jsx)(I,null)),B&&(0,e.jsx)(v.DropdownItem,{divider:!0})),B&&(0,e.jsx)("div",null,(()=>{var t,o;const n=[];T.current=null;for(const l in J){const r=null===(t=null==J?void 0:J.asMutable({deep:!0}))||void 0===t?void 0:t[l],i=re(w,l),s=null==i?void 0:i.label,a=null==i?void 0:i.icon,u=ie(c),d=(0,e.jsx)("div",{key:`${l}_${s}_con`,role:"group",title:"label","aria-label":s},r.length>0&&(0,e.jsx)("div",null,u>1&&(0,e.jsx)(v.Button,{role:"button","aria-label":s,className:"source-label-con jimu-outline-inside",disabled:!0,key:`${l}_${s}`,title:s},a&&(0,e.jsx)(v.Icon,{className:"mr-2",color:null===(o=null==V?void 0:V.sys.color)||void 0===o?void 0:o.primary.main,size:16,icon:null==a?void 0:a.svg}),(0,e.jsx)("div",{className:"flex-grow-1"},s)),oe(r,h,Z())));n.push(d)}return n})()),K===u.Compact&&(0,e.jsx)("div",{className:"show-result-button-style2-con"},B&&(0,e.jsx)(v.DropdownItem,{divider:!0}),(0,e.jsx)(v.Button,{role:"button",className:"d-flex align-items-center show-result-button show-result-button-style2 jimu-outline-inside",onClick:pe,title:n("searchResults"),"aria-label":n("searchResults")},!B&&i?(0,e.jsx)(f,{size:10}):(0,e.jsx)(I,{size:10}))))),y&&(0,e.jsx)(Te,{open:y,serviceList:c,toggleUtilityErrorRemind:x}))))};var et=s(50170),tt=s.n(et),ot=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o};const nt=t=>{const o=window.SVG,{className:n}=t,l=ot(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:tt()},l)):e.React.createElement("svg",Object.assign({className:r},l))},{useSelector:lt}=e.ReactRedux,{useState:rt,useEffect:it,useRef:st,useMemo:at}=e.React,ut=t=>{const o=(0,be.useTheme)(),n=e.hooks.useTranslation(g,v.defaultMessages),s=lt((e=>null==e?void 0:e.queryObject)),a=lt((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode})),u=st((e=>{})),c=st(null),m=st(null),p=st([]),h=st(null),f=st(null),y=st(null),S=st(!1),b=st(!1),I=st(!1),w=st(null),x=st(null),j=st(null),C=st(!1),R=st(!1),M=st(null),L=st(null),P=st(null),D=st(!1),T=st(null),N=st(!1),E=st(null),F=st(null),A=st(!1),U=st(!1),$=st(!1),{config:V,className:J,reference:G,id:B,isShowSearchInput:_,isInCurrentView:K,isWidgetInCurrentPage:q,serviceList:H,searchResult:Q,selectionList:oe,datasourceConfig:re,loadingServiceList:se,showSearchSetting:me,jimuMapView:pe,handleServiceListChange:he,clearSearchResult:fe}=t,{isShowRecentSearches:ye,recentSearchesMaxNumber:Se,linkParam:Ie,searchResultView:we,resultMaxNumber:xe}=V,[je,Ce]=rt(null),[Re,Me]=rt(!1),[Le,Pe]=rt(!1),[De,Te]=rt(!1),[Ne,ke]=rt([]),[Oe,Fe]=rt({}),[Ae,Ue]=rt(!1),[$e,Ve]=rt(!1),[Je,Ge]=rt(!1),[Be,_e]=rt(null),[Ke,We]=rt(!1),[ze,qe]=rt(!1),[He,Xe]=rt([]),[Ye,et]=rt(!1),[tt,ot]=rt(null),[ut,ct]=rt(!1),[dt,vt]=rt(!1),gt=e.css`
    .input-wrapper {
      height: 100% !important;
    }
    input::-webkit-contacts-auto-fill-button{
      opacity: 0 !important;
      visibility: hidden;
    }
    .loading-con {
      left: 0;
      top: 0;
      right: 0;
      height: 2px;
    }
    .hide-loading {
      opacity: 0;
      visibility: hidden;
    }
    .search-button {
      width: ${e.polished.rem(32)};
      border-radius: 0;
    }
    .search-input-con input{
      width: 100%;
    }
    .search-link-con {
      width: 0;
      height: 0;
      overflow: hidden;
    }
    &.arrangement-Style1 {
      .search-button {
        border-radius: 0 ${e.polished.rem(4)} ${e.polished.rem(4)} 0;
      }
      .input-wrapper {
        border-radius: ${e.polished.rem(4)} 0 0 ${e.polished.rem(4)};
      }
      .no-border-left .input-wrapper{
        border-radius: 0;
        border-left: none;
      }
    }
    &.arrangement-Style2 {
      & {
        padding-right: 1px;
      }
      .input-prefix-icon {
        color: var(--ref-palette-neutral-600);
      }
      .input-wrapper {
        border-radius: ${e.polished.rem(32)} !important;
      }
    }
    &.arrangement-Style3 {
      .input-wrapper {
        background: none;
        border: none;
      }
      .search-button {
        background: none;
      }
    }
    //https://devtopia.esri.com/Beijing-R-D-Center/ExperienceBuilder-Web-Extensions/issues/26291#issuecomment-5527033
    //Because after the theme is updated, the color of the input placeholder is set, which causes a regression issue.
    //In order to deal with this regression issue, special processing is required under the dark theme.
    .in-dark-theme input::placeholder {
      color: #868686 !important;
    }
  `;it((()=>{N.current&&K&&q?(Ge(!1),e.lodash.defer((()=>{Pt(!0)}))):Ge(!0),K&&q||Dt()}),[K,q]),it((()=>{!Ke&&D.current&&pt(!0,!1),D.current=Ke}),[Ae,Ke]),it((()=>{Ae&&a===e.AppMode.Design&&Dt()}),[a]),it((()=>{u.current=e.lodash.debounce(It,400),Xt(H,null==V?void 0:V.hint)}),[V]),it((()=>{S.current&&(ft(H),ht(H,b.current),Ct(H));const e=Mt(H);p.current=e,b.current=null==V?void 0:V.enableFiltering,I.current=!0}),[H,V.enableFiltering]),it((()=>{y.current=H,H&&(S.current=!0);const e=(null==V?void 0:V.sourceType)!==d.MapCentric||!se;Xt(H,null==V?void 0:V.hint),wt(H),!R.current&&H&&e&&(mt(H),R.current=!0)}),[H,se]);const mt=e.hooks.useEventCallback((e=>{var t;const o=ve(B),{searchText:n,status:r}=o;r&&(r.isFromSuggestion=!0),n&&(e&&0!==(null===(t=Object.keys(e))||void 0===t?void 0:t.length)||(zt(n,r),Ot(n)),clearTimeout(T.current),T.current=setTimeout((()=>{((e,t)=>{var o;let n=!0;for(const r in e){const i=e[r];let s;if(i.searchServiceType===l.FeatureService)ue(null===(o=null==i?void 0:i.useDataSource)||void 0===o?void 0:o.dataSourceId,ce(i.configId,t))||(n=!1);else{const e=null==i?void 0:i.outputDataSourceId;s=te(e),s||(n=!1)}}return n})(null==e?void 0:e.asMutable({deep:!0}),B)&&Yt()>0?(zt(n,r),Ot(n)):mt(e)}),300))})),pt=(e=!1,t=!0)=>{t&&et(!1),e||(U.current=!1),qe(e)},ht=(e,t)=>{if(!I.current)return!1;t!==(null==V?void 0:V.enableFiltering)&&(clearTimeout(m.current),m.current=setTimeout((()=>{var o;xt(!1),fe();for(const n in e){(null===(o=e[n])||void 0===o?void 0:o.searchServiceType)===l.FeatureService&&Z(e[n],B,n,t)}})))},ft=e=>{if(!I.current||!M.current)return!1;const t=y.current||{},o=yt(e),n=yt(y.current),r=(null==n?void 0:n.filter((e=>!(null==o?void 0:o.includes(e)))))||[];Object.keys(e||{}).length!==Object.keys(t||{}).length&&(clearTimeout(m.current),m.current=setTimeout((()=>{xt(!1),fe(),null==r||r.forEach((e=>{var o,n;(null===(o=t[e])||void 0===o?void 0:o.searchServiceType)===l.FeatureService?Z(t[e],B,e,null==V?void 0:V.enableFiltering):Lt(null===(n=t[e])||void 0===n?void 0:n.outputDataSourceId)}))})))},yt=e=>e?Object.keys(e).map((e=>e)):[],St=(e=!1)=>{ct(e)},bt=(e=!1)=>{vt(e)},It=e.hooks.useEventCallback((e=>{var t;if(0===(null==V?void 0:V.maxSuggestions))return void Me(!1);!Re&&Me(!0);const o=(e=>{const{searchText:t,serviceList:o,config:n,datasourceConfig:r,jimuMapView:i}=e,s=[];for(const e in o){const a=o[e];let u;a.maxSuggestions=n.maxSuggestions;const c=X(n.sourceType,null==a?void 0:a.searchInCurrentMapExtent,i);u=a.searchServiceType===l.FeatureService?W(t,n,a,r,c):k(t,a,c,i),s.push(u)}return Promise.all(s)})({searchText:e,serviceList:null===(t=null==w?void 0:w.current)||void 0===t?void 0:t.asMutable({deep:!0}),config:V,datasourceConfig:re,jimuMapView:pe});Promise.all([o]).then((e=>{var t;const o=null==e?void 0:e[0];(null===(t=null==o?void 0:o.filter((e=>null==e?void 0:e.err)))||void 0===t?void 0:t.length)>0&&St(!0),Me(!1),o&&ke(o),C.current||M.current&&Pe(!0),C.current=!1})).catch((e=>{Me(!1)}))})),wt=e.hooks.useEventCallback((e=>{if(!I.current)return!1;let t=!1;for(const o in e){const n=e[o];((null==n?void 0:n.searchServiceType)===l.FeatureService||(null==n?void 0:n.isSupportSuggest))&&(t=!0)}Te(t)})),xt=(t=!0)=>{zt(""),Me(!1),Pt(!1),Ot("",!0),clearTimeout(P.current),t&&(0,e.focusElementInKeyboardMode)(L.current)},jt=e.hooks.useEventCallback((()=>{var e,t;for(const o in H)if((null===(e=H[o])||void 0===e?void 0:e.searchServiceType)===l.GeocodeService){const e=null===(t=H[o])||void 0===t?void 0:t.outputDataSourceId;Lt(e)}})),Ct=t=>{var o;let n=!1;const l=Mt(t);if(((null==l?void 0:l.length)!==p.current.length||(null===(o=null==l?void 0:l.filter((e=>!p.current.includes(e))))||void 0===o?void 0:o.length)>0)&&(n=!0),n){const t=new e.DataRecordSetChangeMessage(B,e.RecordSetChangeType.Remove,p.current);e.MessageManager.getInstance().publishMessage(t)}},Rt=e.hooks.useEventCallback((()=>{const t=Mt(H),o=new e.DataRecordSetChangeMessage(B,e.RecordSetChangeType.Remove,t);e.MessageManager.getInstance().publishMessage(o)})),Mt=e=>{var t,o;const n=[];for(const r in e)if((null===(t=e[r])||void 0===t?void 0:t.searchServiceType)===l.GeocodeService){const t=null===(o=e[r])||void 0===o?void 0:o.outputDataSourceId;n.push(t)}return n},Lt=t=>{const o=te(t);null==o||o.selectRecordsByIds([]),ae(o,e.DataSourceStatus.NotReady)},Pt=e=>{N.current=e,e||Ge(!0),Ue(e),Ve(e)},Dt=()=>{Ue(!1)},Tt=()=>{let e=!0;if(!f.current)return e;const t=f.current;for(const o in t){const n=t[o];if(e=!((null==n?void 0:n.magicKey)||(null==n?void 0:n.isFromSuggestion)),!e)break}return e},Nt=(t,o,n)=>{if(n)return Et(),!1;kt(t,o),zt(t,o),Ot(t),(0,e.focusElementInKeyboardMode)(L.current)},kt=(e,t)=>{const o=ve(B)||{};if(e){if(o.searchText=e,t){const e={configId:null==t?void 0:t.configId};(null==t?void 0:t.magicKey)&&(e.magicKey=null==t?void 0:t.magicKey),o.status=e}ge(B,o)}else if(null==o?void 0:o.serviceEnabledList){const e={serviceEnabledList:null==o?void 0:o.serviceEnabledList};ge(B,e)}else ge(B,null)},Et=()=>{(0,e.focusElementInKeyboardMode)(L.current),et(!0),pt(!0,!1)},Ot=e.hooks.useEventCallback(((e,t=!1)=>{if(Ae&&!t)return;e=null==e?void 0:e.trim(),Bt(e),Pe(!1),pt(!1),Ft(),he(w.current),C.current=!0;const o={serviceList:f.current,searchText:e,searchResultView:we,id:B,sourceType:null==V?void 0:V.sourceType,jimuMapView:pe};kt(e),Me(!0),(e=>{const{serviceList:t,searchText:o,searchResultView:n,sourceType:i,jimuMapView:s,id:a}=e,u=[];for(const e in t){const c=t[e],{searchServiceType:d,resultMaxNumber:v}=c;if(d===l.GeocodeService){const e=n===r.ResultPanel?v:null,t=X(i,null==c?void 0:c.searchInCurrentMapExtent,s),l=O({address:o,maxResultNumber:e,geocodeItem:c,searchResultView:n,extent:t,jimuMapView:s,id:a});u.push(l)}}return Promise.all(u)})(o).then((t=>{var n;Me(!1),(null===(n=null==t?void 0:t.filter((e=>"boolean"==typeof e)))||void 0===n?void 0:n.length)>0&&bt(!0),C.current=!1,(null==V?void 0:V.enableFiltering)&&(Y(o),Ut()),e&&$t(e)}),(e=>{Me(!1)}))})),Ft=()=>{var t;const o=[];for(const e in w.current){const n=w.current[e],r=n.searchServiceType===l.FeatureService?null===(t=null==n?void 0:n.useDataSource)||void 0===t?void 0:t.dataSourceId:null==n?void 0:n.outputDataSourceId;o.push(r)}if(e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage(B,[],o)),tt){const e=te(tt);null==e||e.selectRecordsByIds([]),At(null)}Rt(),jt()},At=e=>{ot(e)},Ut=e.hooks.useEventCallback((()=>{var t;const o=[];for(const e in Oe){const n=Oe[e];let r;(null==n?void 0:n.searchServiceType)===l.FeatureService?(r=null===(t=null==n?void 0:n.useDataSource)||void 0===t?void 0:t.dataSourceId,o.push(r)):(null==n?void 0:n.outputDataSourceId)&&o.push(null==n?void 0:n.outputDataSourceId)}e.MessageManager.getInstance().publishMessage(new e.DataSourceFilterChangeMessage(B,o))})),$t=e=>{we===r.OtherWidgets?e&&(Gt()?_t():Vt()):Jt()},Vt=()=>{if(!de(f.current,B))return clearTimeout(x.current),x.current=setTimeout((()=>{Vt()}),200),!1;const e=ee(f.current,xe,B);Promise.all([e]).then((e=>{let t=[],o=[];null==e||e.forEach((e=>{t=t.concat(e)})),t.forEach((e=>{const t=(null==e?void 0:e.records)||[];o=o.concat(t)})),(null==o?void 0:o.length)>0?_t():Jt()}))},Jt=()=>{Kt(),Pt(!0)},Gt=()=>{let e=[];return Ne.forEach((t=>{e=e.concat(null==t?void 0:t.suggestionItem)})),e.length>0},Bt=t=>{(t=>{const{searchText:o,id:n,recentSearchesMaxNumber:l,isShowRecentSearches:r}=t,i=e.urlUtils.getAppIdPageIdFromUrl().appId,s=le(i,n);if(!r||!o)return!1;let a=ne(n);a.includes(o)||(a.unshift(o),a=a.splice(0,l||10),e.utils.setLocalStorage(s,escape(a.join("/@/"))))})({searchText:t,id:B,recentSearchesMaxNumber:Se,isShowRecentSearches:ye})},_t=()=>{var e;if(!(null==c?void 0:c.current))return!1;Kt(),Ve(!0),null===(e=null==c?void 0:c.current)||void 0===e||e.click()},Kt=()=>{if(!de(f.current,B))return clearTimeout(j.current),j.current=setTimeout((()=>{Kt()}),200),!1;const t=we===r.ResultPanel?xe:100,o=ee(f.current,t,B,!0);Promise.all([o]).then((t=>{var o;let n=[];null==t||t.forEach((e=>{n=n.concat(e)}));let l,r=[];null==n||n.forEach((e=>{const t=(null==e?void 0:e.records)||[];r=r.concat(t)})),1===(null==r?void 0:r.length)&&(l=null===(o=r[0])||void 0===o?void 0:o.__extent),((t,o,n=e.RecordSetChangeType.CreateUpdate,l)=>{const r=[];null==o||o.forEach((e=>{var t;if(null==e?void 0:e.isGeocodeRecords){const o=te(e.dsId),n=null===(t=null==e?void 0:e.displayFields)||void 0===t?void 0:t.map((e=>e.jimuName)),l=null==o?void 0:o.getDataSourceJson(),i={records:e.records,fields:n,dataSource:o,name:o.id,label:null==l?void 0:l.label};r.push(i)}}));const i=new e.DataRecordSetChangeMessage(t,n,r);l&&(i.extent=l),e.MessageManager.getInstance().publishMessage(i)})(B,n,e.RecordSetChangeType.CreateUpdate,l)}))},Wt=at((()=>(e=>{let t,o;return(null==e?void 0:e.linkType)&&(t=null==e?void 0:e.openType,o={linkType:null==e?void 0:e.linkType},o.value=null==e?void 0:e.value),{linkTo:o,target:t}})(Ie)),[Ie]),zt=(e,t)=>{ke([]),Ce(e),M.current=e,qt(e,t)},qt=e.hooks.useEventCallback(((t,o)=>{var n,r,i,s;const a=y.current;let u=y.current;t=null==t?void 0:t.trim();const c=V.sourceType===d.MapCentric?null===(n=null==pe?void 0:pe.view)||void 0===n?void 0:n.extent:null;for(const e in a){const o=null===(i=null===(r=a[e])||void 0===r?void 0:r.useDataSource)||void 0===i?void 0:i.dataSourceId;if(a[e].searchServiceType===l.GeocodeService||!ue(o))continue;const n=te(o),d=(null===(s=a[e].searchFields)||void 0===s?void 0:s.asMutable({deep:!0}))||[],v=z(t,d,n,a[e].searchExact||!1),g=z(t,d,n,!1);if(u=u.setIn([e,"SQL"],v).setIn([e,"SuggestionSQL"],g).setIn([e,"searchText"],t),c){const t=(null==c?void 0:c.toJSON)?null==c?void 0:c.toJSON():{};u=u.setIn([e,"searchExtent"],t)}}w.current=u,((t,o)=>{const{configId:n,magicKey:l,isFromSuggestion:r}=o||{};let i=(0,e.Immutable)(t);const s={};for(const e in i)e===n&&(l||r)&&(l&&(i=i.setIn([n,"magicKey"],l||null)),r&&(i=i.setIn([n,"isFromSuggestion"],r||null)),s[n]=i[n]);(l||r)&&Object.keys(t).includes(n)&&(i=(0,e.Immutable)(s));f.current=null==i?void 0:i.asMutable({deep:!0}),Fe(null==i?void 0:i.asMutable({deep:!0}))})(null==u?void 0:u.asMutable({deep:!0}),o)})),Ht=e=>{if(!e&&ye){const e=ne(B).map((e=>({suggestionHtml:e,suggestion:e,isRecentSearch:!0})));Xe([{suggestionItem:e,layer:null,icon:null}]),pt(!0)}},Qt=e=>{!e&&(null==V?void 0:V.isUseCurrentLoation)&&(pt(!0),(null==V?void 0:V.isShowRecentSearches)||Xe([{suggestionItem:[],layer:null,icon:null}]))},Xt=e.hooks.useEventCallback(((e,t)=>{var o,l;if(!e)return;let r;const i=Yt(e);for(const t in e)r=(null===(o=null==e?void 0:e[t])||void 0===o?void 0:o.hint)&&(null===(l=null==e?void 0:e[t])||void 0===l?void 0:l.hint);const s=t||(null==V?void 0:V.hint)||n("findAddressOrPlace");r=r||n("findAddressOrPlace");_e(1!==i?s:r)})),Yt=e.hooks.useEventCallback((e=>ie(e=e||H))),Zt=t=>{40===t.keyCode&&E&&(Le?(0,e.focusElementInKeyboardMode)(null==E?void 0:E.current,!0):Ae?(0,e.focusElementInKeyboardMode)(null==h?void 0:h.current,!0):ze&&((0,e.focusElementInKeyboardMode)(null==F?void 0:F.current,!0),U.current=!0))},eo=()=>{if(Ke)return!0;if(Re||Ae)return!1;let e=!1;return(null==V?void 0:V.maxSuggestions)>0&&(e=Le&&De),e||(A.current=!1),e},to=()=>{Pe(!1)},oo=e.React.useCallback((()=>{var e,t;return!je&&(!!((null==V?void 0:V.isShowRecentSearches)&&He&&(null===(t=null===(e=He[0])||void 0===e?void 0:e.suggestionItem)||void 0===t?void 0:t.length)>0)||!!(null==V?void 0:V.isUseCurrentLoation)&&!Ke)}),[V,Ke,He,je]);return(0,e.jsx)("div",{className:`h-100 align-items-center position-relative d-flex flex-grow-1 ${J||""} arrangement-${V.arrangementStyle}`,css:gt},(0,e.jsx)("div",{className:"h-100 flex-grow-1 search-input-con"},(0,e.jsx)("div",{className:"h-100 w-100",onKeyDown:e=>{if("ArrowUp"===e.key||"ArrowDown"===e.key){const e=eo();A.current=e,U.current=ze}Zt(e)}},_&&(0,e.jsx)(v.TextInput,{value:je||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,n=(null==o?void 0:o.length)>2;if(zt(o),Ae&&Ot("",!0),Pt(!1),!n||!De)return Pe(!1),0===(null==o?void 0:o.length)&&Ot("",!0),!1;u.current(o)},onFocus:e=>{if(A.current||U.current)return U.current=!1,A.current=!1,!1;Ht(M.current),Qt(M.current)},onPressEnter:e=>{var t;if(!e||!e.target)return;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;13===e.keyCode&&Tt()&&(zt(o),Ot(o)),Zt(e)},onBlur:e=>{P.current=setTimeout((()=>{A.current||Pe(!1),$.current||U.current||pt(!1)}),200)},className:(0,e.classNames)("h-100 w-100",{"no-border-left":me,"in-dark-theme":"themes/dark/"===(null==o?void 0:o.uri)}),allowClear:!0,prefix:V.arrangementStyle===i.Style2?(0,e.jsx)(nt,{className:"input-prefix-icon"}):null,placeholder:Be,title:je||Be,ref:L,"aria-label":je||Be,autoComplete:"off"})),je&&(0,e.jsx)(Ee,{canUseOutputDsLength:Yt(),isOpen:eo(),reference:G,searchText:je,searchSuggestion:Ne,toggle:to,onRecordItemClick:Nt,setSuggestionFirstItem:e=>{E.current=e},id:B,config:V,toggleSuggestionUtilityError:St,openUtilityErrRemindInSuggestion:ut,searchInputRef:L,serviceList:H}),oo()&&(0,e.jsx)(Qe,{serviceList:ie(Oe)>0?(0,e.Immutable)(Oe):H,isOpen:ze||Ke,reference:G,isGetLocationError:Ye,recentSearchesData:He,toggle:to,onRecordItemClick:Nt,clearSearches:()=>{(t=>{const o=e.urlUtils.getAppIdPageIdFromUrl().appId,n=le(o,t);e.utils.setLocalStorage(n,"")})(B),Xe([]),qe(!1)},setSuggestionFirstItem:e=>{F.current=e},id:B,config:V,searchInputRef:L,locationLoading:Ke,handleLocationLoadingChange:e=>{e?(We(e),$.current=e):setTimeout((()=>{We(e),$.current=e}),300)}}),(0,e.jsx)(Ze,{isOpenResultPopper:Ae,isToOtherWidget:$e,serviceList:(0,e.Immutable)(Oe),config:V,reference:G,searchText:je,id:B,setResultFirstItem:e=>{h.current=e},isOpenResultListDefault:Je,searchInputRef:L,searchResult:Q,selectionList:oe,openUtilityErrRemindInResult:dt,handleDsIdOfSelectedResultItemChange:At,toggleResultUtilityError:bt,datasourceConfig:re})),((t,o)=>{const n=t||o;return n?(0,e.jsx)("div",{className:(0,e.classNames)("position-absolute loading-con",{"hide-loading":!n})},(0,e.jsx)(v.Loading,{className:"w-100",type:v.LoadingType.Bar})):null})(Re,Ke),V.arrangementStyle!==i.Style2&&(0,e.jsx)(v.Button,{className:"search-button h-100",type:V.arrangementStyle===i.Style3?"tertiary":"primary",icon:!0,"aria-label":n("SearchLabel"),onClick:()=>{(e=>{Tt()&&Ot(e)})(je)},title:n("SearchLabel")},(0,e.jsx)(nt,null)),we===r.OtherWidgets&&(0,e.jsx)("div",{className:"search-link-con"},(0,e.jsx)(v.Link,{ref:c,to:null==Wt?void 0:Wt.linkTo,target:null==Wt?void 0:Wt.target,queryObject:s})))},{useEffect:ct,useState:dt}=e.React,vt=t=>{const{config:o,id:n,serviceList:r,dsStatus:i,synchronizeSettings:s,jimuMapView:a,handleSearchResultChange:u,handleSelectionListChange:c,handleDsStatusChange:v}=t,[g,m]=dt(!1);ct((()=>{Object.keys(r||{}).forEach((e=>{var t;(null===(t=r[e])||void 0===t?void 0:t.searchText)&&m(!0)}))}),[r]);const p=(t,r,u)=>{if(t.searchServiceType===l.GeocodeService){const l=null==t?void 0:t.outputDataSourceId,i={dataSourceId:l,mainDataSourceId:l},a={where:"2=2",sqlExpression:null,pageSize:o.resultMaxNumber,outFields:["*"],page:1,returnGeometry:!0};if(!1!==s&&(null==o?void 0:o.sourceType)===d.MapCentric){const o=te(l);return(0,e.jsx)("div",{key:`${r}_con`},l&&(0,e.jsx)(e.DataSourceComponent,{dataSource:o,query:a,key:`${r}_outputDataSource`,onDataSourceInfoChange:e=>{f(t,r)},onDataSourceStatusChange:e=>{f(t,r,e)},onSelectionChange:e=>{h(e,r)},widgetId:n}))}return(0,e.jsx)("div",{key:`${r}_con`},l&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:(0,e.Immutable)(i),query:a,key:`${r}_outputDataSource`,onDataSourceInfoChange:e=>{f(t,r)},onDataSourceStatusChange:e=>{f(t,r,e)},onSelectionChange:e=>{h(e,r)},widgetId:n}))}if(t.searchServiceType===l.FeatureService){const l=null==t?void 0:t.useDataSource,s=function(t,o,n,l){const{searchText:r,useDataSource:i}=t,s=null==t?void 0:t.SQL,a=r?(null==s?void 0:s.sql)||"1=0":"1=1",u=r&&(null==s?void 0:s.sql)?s:null,c=q(t.searchFields,t.displayFields,null==i?void 0:i.dataSourceId);let v=(0,e.Immutable)({outFields:c,where:a,sqlExpression:u,returnGeometry:!0});if(n===d.MapCentric&&l){const e=null==o?void 0:o.view.extent,t=e?e.toJSON():{};v=v.set("geometry",t)}return v}(null==t?void 0:t.asMutable({deep:!0}),a,o.sourceType,t.searchInCurrentMapExtent),c=ce(r,n);return(0,e.jsx)("div",{key:`${r}_con`},l&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:(0,e.Immutable)(l),query:u?s:null,key:`${r}_useDataSource`,onDataSourceInfoChange:e=>{f(t,r)},onSelectionChange:e=>{h(e,r)},onDataSourceCreated:e=>{e.setListenSelection(!0)},onDataSourceStatusChange:t=>{v((0,e.Immutable)(i.set(r,t)))},onCreateDataSourceFailed:t=>{v((0,e.Immutable)(i.set(r,e.DataSourceStatus.CreateError)))},localId:c}))}},h=(e,t)=>{c(e,t)},f=(t,r,s)=>{const{searchServiceType:a}=t;switch(a){case l.GeocodeService:B(null==t?void 0:t.asMutable({deep:!0}),o.resultMaxNumber).then((e=>{const{records:t}=e,o=null==t?void 0:t.map((e=>e.getId()));u(r,o)}));break;case l.FeatureService:H(null==t?void 0:t.asMutable({deep:!0}),o.resultMaxNumber,n).then((e=>{const{records:t}=e,o=null==t?void 0:t.map((e=>e.getId()));u(r,o)}))}s&&v((0,e.Immutable)(i.set(r,s)))};return(0,e.jsx)("div",null,((e,t)=>{const o=[];for(const n in e)o.push(p(e[n],n,t));return o})(r,g))};var gt=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const mt=(e,t=0)=>{let o="Default Address";return null==e||e.forEach((n=>{o=t?`${o}${t}`:o,n.jimuName===o&&(o=mt(e,t+=1))})),o};function pt(t){return gt(this,void 0,void 0,(function*(){yield function(t){return gt(this,void 0,void 0,(function*(){if(!t)return;const o=[];return Object.keys(t).forEach((n=>{const l=t[n],r=ht(l),i=(null==r?void 0:r.layers)||[],s=(null==r?void 0:r.tables)||[],a=[],u=[];if(s.forEach((e=>{a.includes(null==e?void 0:e.id)||a.push(null==e?void 0:e.id)})),i.forEach((e=>{u.includes(null==e?void 0:e.id)||u.push(null==e?void 0:e.id)})),null==r?void 0:r.enabled){const l=t[n],r=l.jimuLayerViews,i=l.jimuTables,s=e.DataSourceManager.getInstance();Object.keys(i).forEach((e=>{const t=i[e],n=l.getDataSourceIdByAPILayer(t),r=s.getDataSource(n),u=l.getMapDataSource();if(!r&&u&&a.includes(null==t?void 0:t.id)){const e=function(e,t){return gt(this,void 0,void 0,(function*(){return yield e.createDataSourceByLayer(t).then((e=>Promise.resolve(e)),(e=>Promise.resolve(null)))}))}(u,t);o.push(e)}})),Object.keys(r).forEach((e=>{var t;const n=r[e];if(!n.getLayerDataSource()&&u.includes(null===(t=n.layer)||void 0===t?void 0:t.id)){const e=function(e){return gt(this,void 0,void 0,(function*(){return yield e.createLayerDataSource().then((e=>Promise.resolve(e)),(e=>Promise.resolve(null)))}))}(n);o.push(e)}}))}})),Promise.all(o)}))}(t);const o={},n=yield e.moduleLoader.loadModule("jimu-ui/advanced/setting-components"),{getNewDataSourceConfig:l,getDsJsonOfOriginDs:r}=n,i=Object.keys(t||{}).map((n=>gt(this,void 0,void 0,(function*(){var i,s,a,u,c,d,v,g;const m=t[n],p=St(m),h=It(m),f=null===(i=h[0])||void 0===i?void 0:i.jimuLayerViewsOrTable,y=null===(s=h[1])||void 0===s?void 0:s.jimuLayerViewsOrTable,S=0===(null===(a=Object.keys(f))||void 0===a?void 0:a.length)&&0===(null===(u=Object.keys(y))||void 0===u?void 0:u.length);let b=null===(c=null==o?void 0:o[n])||void 0===c?void 0:c.dataSourceConfig;if(S||0===(null==p?void 0:p.length))o[n]={dataSourceConfig:(null===(d=null==o?void 0:o[n])||void 0===d?void 0:d.dataSourceConfig)||[]};else{const t=e.DataSourceManager.getInstance();for(let i=0;i<h.length;i++){const{jimuLayerViewsOrTable:s,isTable:a}=h[i];for(const i in s||{}){const u=s[i],c=a?m.getDataSourceIdByAPILayer(u):null,d=a?null==u?void 0:u.id:null===(v=null==u?void 0:u.layer)||void 0===v?void 0:v.id,h=a?t.getDataSource(c):null==u?void 0:u.getLayerDataSource();if(!xt(n,null==h?void 0:h.id,o)&&p.includes(d)){const t={dataSourceId:h.id,mainDataSourceId:h.id,dataViewId:h.dataViewId,rootDataSourceId:null===(g=h.getRootDataSource())||void 0===g?void 0:g.id,viewId:n},i=yield r(t);wt(m,u,a).forEach((r=>{var s;const a=null==r?void 0:r.field,u=(null===(s=null==r?void 0:r.field)||void 0===s?void 0:s.exactMatch)||!1;let c;if(null==a?void 0:a.name){c=`${null==i?void 0:i.getLabel()}: ${a.name}`}const d={datasourceConfig:(0,e.Immutable)(b),dsJsonOriginDs:i,useDataSource:t,viewId:n,fieldsInMapSearchProperties:a?[a]:null,exactMatch:u,label:c},v=l(d);o[n]||(o[n]={}),o[n].dataSourceConfig=v.datasourceConfig,b=v.datasourceConfig}))}}}}return Promise.resolve(o)}))));return yield Promise.all(i),Promise.resolve(o)}))}const ht=e=>{var t,o,n,l;if(!e)return null;const r=(null===(o=null===(t=e.view)||void 0===t?void 0:t.map)||void 0===o?void 0:o.applicationProperties)||null;return r?null===(l=null===(n=r.toJSON())||void 0===n?void 0:n.viewing)||void 0===l?void 0:l.search:null},ft=[e.JSAPILayerTypes.FeatureLayer,e.JSAPILayerTypes.SceneLayer,e.JSAPILayerTypes.BuildingComponentSublayer,e.JSAPILayerTypes.ImageryTileLayer,e.JSAPILayerTypes.OrientedImageryLayer,e.JSAPILayerTypes.ImageryLayer,e.JSAPILayerTypes.SubtypeGroupLayer,e.JSAPILayerTypes.SubtypeSublayer];function yt(t){if(!t||!t.type)return!1;const o=t.type,n=o!==e.JSAPILayerTypes.BuildingComponentSublayer||o===e.JSAPILayerTypes.BuildingComponentSublayer&&t.view;return!!(ft.includes(o)&&n)}const St=t=>{const o=ht(t);if(!(null==o?void 0:o.enabled))return[];const n=[],l=e.DataSourceManager.getInstance();return It(t).forEach((e=>{var r,i;const{jimuLayerViewsOrTable:s,isTable:a}=e;for(const e in s||{}){const u=s[e];if(!yt(u))continue;const c=a?t.getDataSourceIdByAPILayer(u):null,d=a?null==u?void 0:u.id:null===(r=null==u?void 0:u.layer)||void 0===r?void 0:r.id,v=a?l.getDataSource(c):null==u?void 0:u.getLayerDataSource();(null===(i=null==v?void 0:v.getDataSourceJson())||void 0===i?void 0:i.url)&&bt(u,o,a)&&n.push(d)}})),n};function bt(e,t,o){var n,l,r,i;const s=(null==t?void 0:t.layers)||[],a=(null==t?void 0:t.tables)||[],u=s.concat(a),c=o?null==e?void 0:e.id:null===(n=null==e?void 0:e.layer)||void 0===n?void 0:n.id;if("sublayer"===(null===(l=null==e?void 0:e.layer)||void 0===l?void 0:l.type)&&(null===(i=null===(r=null==e?void 0:e.layer)||void 0===r?void 0:r.parent)||void 0===i?void 0:i.id)){const t=e.layer.parent.id;let o=!1;return u.forEach((e=>{e.id===t&&(null==e?void 0:e.subLayer)===c&&(o=!0)})),o}{const e=(null==t?void 0:t.layers)||[],o=(null==t?void 0:t.tables)||[];return e.concat(o).map((e=>null==e?void 0:e.id)).includes(c)}}const It=e=>[{jimuLayerViewsOrTable:null==e?void 0:e.jimuLayerViews,isTable:!1},{jimuLayerViewsOrTable:null==e?void 0:e.jimuTables,isTable:!0}],wt=(e,t,o)=>{var n,l,r,i;const s=o?null==t?void 0:t.id:null===(n=null==t?void 0:t.layer)||void 0===n?void 0:n.id,a=ht(e),u=(null==a?void 0:a.layers)||[],c=(null==a?void 0:a.tables)||[],d=u.concat(c);let v;return v="sublayer"===(null===(l=null==t?void 0:t.layer)||void 0===l?void 0:l.type)&&(null===(i=null===(r=null==t?void 0:t.layer)||void 0===r?void 0:r.parent)||void 0===i?void 0:i.id)?d.filter((e=>(null==e?void 0:e.id)===t.layer.parent.id&&(null==e?void 0:e.subLayer)===s))||[]:d.filter((e=>(null==e?void 0:e.id)===s))||[],v};function xt(e,t,o){var n;const l=null==o?void 0:o[e];if(!l)return!1;const r=null===(n=null==l?void 0:l.dataSourceConfig)||void 0===n?void 0:n.filter((e=>{var o;return t===(null===(o=null==e?void 0:e.useDataSource)||void 0===o?void 0:o.dataSourceId)}));return(null==r?void 0:r.length)>0}var jt=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const Ct={jimuName:x,alias:"ADDRESS",type:e.JimuFieldType.String,name:x},Rt=t=>jt(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))}));class Mt extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.9.0",description:"For geocode service, use array of Schema to set displayFields",upgrader:e=>{var t,o;const n=null===(o=null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.datasourceConfig)||void 0===o?void 0:o.map((e=>((null==e?void 0:e.searchServiceType)===l.FeatureService||(null==e?void 0:e.displayFields)||(e.displayFields=[Ct],e.addressFields=[Ct],e.defaultAddressFieldName=Ct.jimuName),e)));return e.setIn(["datasourceConfig"],n)}},{version:"1.10.0",description:"For locator service, need to save support for suggest in config",upgrader:t=>jt(this,void 0,void 0,(function*(){var o,n;const r=null===(n=null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===n?void 0:n.map((t=>(null==t?void 0:t.searchServiceType)===l.FeatureService?Promise.resolve(t):Rt(null==t?void 0:t.useUtility).then((o=>jt(this,void 0,void 0,(function*(){return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[n]=e;return n(o,{query:{f:"json"},responseType:"json"}).then((e=>{var o;const n=(null==e?void 0:e.data)||{};if(null==n?void 0:n.capabilities){const e=(null===(o=null==n?void 0:n.capabilities)||void 0===o?void 0:o.split(","))||[],l=null==e?void 0:e.includes("Suggest");return t.isSupportSuggest=l,Promise.resolve(t)}return Promise.resolve(t)}),(e=>Promise.resolve(t)))}),(e=>Promise.resolve(t)))})))))),i=r?yield Promise.all(r):[];return t.setIn(["datasourceConfig"],i)}))},{version:"1.12.0",description:'For old search widgets, "enableFiltering" needs to be "true" by default, and the default value of "searchResultStyle" should be "Classic"',upgrader:t=>jt(this,void 0,void 0,(function*(){const o=yield(()=>jt(this,void 0,void 0,(function*(){var o,n;const r=null===(n=null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===n?void 0:n.map((t=>jt(this,void 0,void 0,(function*(){return(null==t?void 0:t.searchServiceType)===l.FeatureService?Promise.resolve(t):Rt(null==t?void 0:t.useUtility).then((o=>(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((n=>{const[l]=n;return l(o,{query:{f:"json"},responseType:"json"}).then((o=>{const n=(null==o?void 0:o.data)||{};if(null==n?void 0:n.capabilities){const o=(null==n?void 0:n.candidateFields)||[],{addressFieldsSchema:l}=((t=[])=>{const o=null==t?void 0:t.map((t=>({jimuName:null==t?void 0:t.alias,alias:null==t?void 0:t.alias,type:e.JimuFieldType.String,name:null==t?void 0:t.alias}))),n=mt(o,0),l={jimuName:n,alias:n,type:e.JimuFieldType.String,name:n};return o.unshift(l),{addressFieldsSchema:o,defaultAddressFieldName:n}})(o),r=((null==t?void 0:t.addressFields)||[]).concat(l);return t.addressFields=r,Promise.resolve(t)}return Promise.resolve(t)}),(e=>Promise.resolve(t)))}))))}))));return r?yield Promise.all(r):[]})))();return t.setIn(["enableFiltering"],!0).setIn(["datasourceConfig"],o).setIn(["searchResultStyle"],u.Classic)}))},{version:"1.15.0",description:"Add spatialReference for locator service",upgrader:t=>jt(this,void 0,void 0,(function*(){let o=!1;const n=yield(()=>jt(this,void 0,void 0,(function*(){var n,r;const i=null===(r=null===(n=null==t?void 0:t.asMutable({deep:!0}))||void 0===n?void 0:n.datasourceConfig)||void 0===r?void 0:r.map((t=>jt(this,void 0,void 0,(function*(){return(null==t?void 0:t.searchServiceType)===l.FeatureService?Promise.resolve(t):Rt(null==t?void 0:t.useUtility).then((n=>(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[l]=e;return l(n,{query:{f:"json"},responseType:"json"}).then((e=>{const n=(null==e?void 0:e.data)||{};return(null==n?void 0:n.spatialReference)?(o=!0,t.spatialReference=n.spatialReference,Promise.resolve(t)):Promise.resolve(t)}),(e=>Promise.resolve(t)))}))))}))));return i?yield Promise.all(i):[]})))(),r=t.setIn(["datasourceConfig"],n);return o?r:t}))},{version:"1.16.0",description:"Update isAutoSelectFirstResult with searchResultView",upgrader:e=>{let t=e;return(null==e?void 0:e.searchResultView)===r.OtherWidgets&&(null==e?void 0:e.isAutoSelectFirstResult)&&(t=t.set("isAutoSelectFirstResult",!1)),t}}]}}const Lt=new Mt;var Pt=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const{useEffect:Dt,useState:Tt,useRef:Nt}=e.React,kt=e.css`
  & {
    height: ${e.polished.rem(32)};
    margin-top: 0;
    margin-left: 0;
  }
  &.search-con-in-controller {
    width: 300px !important;
  }
  &.search-con-Style3 {
    border-bottom: 1px solid var(--ref-palette-neutral-500);
  }
`,Et=o=>{const n=Nt(null),r=Nt(null),s=Nt(null),{config:a,id:u,useDataSources:c,useMapWidgetIds:v}=o,{resultMaxNumber:g}=a,m=Nt(null),p=Nt((0,e.Immutable)({})),h=e.hooks.useTranslation(e.defaultMessages),[f,y]=Tt((0,e.Immutable)([])),[S,b]=Tt(!1),[I,x]=Tt(null),[j,C]=Tt((0,e.Immutable)({})),[R,M]=Tt((0,e.Immutable)({})),[L,P]=Tt((0,e.Immutable)({})),[D,T]=Tt(null),[N,k]=Tt(null),[E,O]=Tt(!1);Dt((()=>{const t=v&&(null==v?void 0:v.length)>0;(null==a?void 0:a.sourceType)===d.MapCentric&&t&&O(!0),(null==a?void 0:a.sourceType)===d.MapCentric&&D?t?F(a,D):(y((0,e.Immutable)([])),x(null),O(!1)):(!t&&O(!1),U(null==a?void 0:a.datasourceConfig)),n.current=a,r.current=D}),[a,D,v]);const F=(t,o)=>Pt(void 0,void 0,void 0,(function*(){var l,i,a,c;O(!0);const v=null==o?void 0:o.id,g=(null===(l=r.current)||void 0===l?void 0:l.id)!==v,m=(null==t?void 0:t.dataSourceConfigWithMapCentric)!==(null===(i=n.current)||void 0===i?void 0:i.dataSourceConfigWithMapCentric)||(null==t?void 0:t.allowSearchSourceSelection)!==(null===(a=n.current)||void 0===a?void 0:a.allowSearchSourceSelection);let p=[];const f=null===(c=null==t?void 0:t.dataSourceConfigWithMapCentric)||void 0===c?void 0:c[v];!1!==(null==f?void 0:f.synchronizeSettings)&&(p=yield Pt(void 0,void 0,void 0,(function*(){const t=yield e.moduleLoader.loadModule("jimu-ui/advanced/setting-components"),{getDefaultGeocodeConfig:o}=t;return s.current?Promise.resolve(N):o({nls:h,id:u,createOutputDs:!0,viewId:"default_geocode_custom",isSingle:!1,notAddNewUtility:!0}).then((e=>(k(e),s.current=e,Promise.resolve(e))),(e=>Promise.resolve([])))})),yield me(p)),function(t,o,n){return gt(this,void 0,void 0,(function*(){const l=null==t?void 0:t.id;if((null==o?void 0:o.sourceType)===d.MapCentric){const r=(null==o?void 0:o.dataSourceConfigWithMapCentric)||{},i=Object.keys(r)||[];let s;if(i.includes(l)?s=null==r?void 0:r[l]:(null==i?void 0:i.length)>0&&(s=null==r?void 0:r[i[0]]),!1===(null==s?void 0:s.synchronizeSettings))return Promise.resolve((0,e.Immutable)(null==s?void 0:s.dataSourceConfig));{const o={};return o[t.id]=t,pt(o).then((t=>{var o;let r=(null===(o=null==t?void 0:t[l])||void 0===o?void 0:o.dataSourceConfig)||[];const i=n||[];return r=r.concat(i),Promise.resolve((0,e.Immutable)(r))}),(t=>Promise.resolve((0,e.Immutable)(n))))}}return Promise.resolve(null==o?void 0:o.datasourceConfig)}))}(o,t,p).then((e=>Pt(void 0,void 0,void 0,(function*(){(g||m)&&(yield U(e)),O(!1)}))),(e=>{O(!1)}))})),A=e=>{e&&y(e),K(e)},U=t=>Pt(void 0,void 0,void 0,(function*(){const o=(t||(0,e.Immutable)([])).map((e=>Pt(void 0,void 0,void 0,(function*(){const t=!1===(null==a?void 0:a.allowSearchSourceSelection)||V(e);let o=null==e?void 0:e.setIn(["enable"],t);return(null==e?void 0:e.useUtility)&&(yield $(e).then((e=>{o=o.setIn(["geocodeURL"],e)}))),Promise.resolve(null==o?void 0:o.asMutable({deep:!0}))}))));yield Promise.all(o).then((t=>{y((0,e.Immutable)(t)),K((0,e.Immutable)(t))}))})),$=e=>Pt(void 0,void 0,void 0,(function*(){var t;return(null===(t=null==e?void 0:e.useUtility)||void 0===t?void 0:t.utilityId)?J(null==e?void 0:e.useUtility):(null==e?void 0:e.geocodeURL)?Promise.resolve(null==e?void 0:e.geocodeURL):void 0})),V=e=>{if(f&&0!==(null==f?void 0:f.length)){let t=!0;return null==f||f.forEach((o=>{(null==e?void 0:e.configId)===(null==o?void 0:o.configId)&&(t=!!(null==o?void 0:o.enable))})),t}{const t=ve(u),o=null==t?void 0:t.serviceEnabledList;return!o||o.includes(null==e?void 0:e.configId)}},J=t=>Pt(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))})),G=e=>{x(e)},B=()=>(null==a?void 0:a.arrangementStyle)===i.Style1||(null==a?void 0:a.arrangementStyle)===i.Style2||(null==a?void 0:a.arrangementStyle)===i.Style3||S,_=e=>{b(e)},K=t=>{var o;let n=(0,e.Immutable)({});null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o||o.forEach((e=>{if(!(null==e?void 0:e.enable))return!1;const{configId:t}=e;let o;o=(null==e?void 0:e.searchServiceType)===l.GeocodeService?z(e):W(e),n=n.setIn([t],o)})),x(n)},W=e.hooks.useEventCallback((e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===l.GeocodeService)return!1;const{configId:o,useDataSource:n,displayFields:r,searchFields:i,searchExact:s,hint:a,searchServiceType:u,searchInCurrentMapExtent:c}=e,d=(null===(t=null==I?void 0:I[o])||void 0===t?void 0:t.asMutable({deep:!0}))||{},v={useDataSource:n,displayFields:r,searchFields:i,searchExact:s,resultMaxNumber:g,hint:a,searchServiceType:u,configId:o,searchInCurrentMapExtent:c};return Object.assign(d,v)})),z=e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===l.FeatureService)return!1;const{countryCode:o,configId:n,hint:r,geocodeURL:i,outputDataSourceId:s,label:a,searchInCurrentMapExtent:u,enableLocalSearch:c,minScale:d,searchServiceType:v,spatialReference:m,singleLineFieldName:p,displayFields:h,defaultAddressFieldName:f,addressFields:y,isSupportSuggest:S,useUtility:b}=e,w=(null===(t=null==I?void 0:I[n])||void 0===t?void 0:t.asMutable({deep:!0}))||{},x={hint:r,geocodeURL:i,outputDataSourceId:s,icon:null==e?void 0:e.icon,resultMaxNumber:g,label:a,searchServiceType:v,configId:n,singleLineFieldName:p||"",displayFields:h,defaultAddressFieldName:f,addressFields:y||[],isSupportSuggest:S,useUtility:b,spatialReference:m,countryCode:o,searchInCurrentMapExtent:u,enableLocalSearch:c,minScale:d};return Object.assign(w,x)},q=(t,o)=>{const n=j.set(t,o);C((0,e.Immutable)(n))},H=()=>{C((0,e.Immutable)({}))},Q=e.hooks.useEventCallback(((e,t)=>{const o=p.current.setIn([t],e);M(o),p.current=o})),X=e=>{P(e)},Y=e=>{T(e)},Z=e.hooks.useEventCallback(((e,t,o)=>!1!==o&&(e||(null==t?void 0:t.length)>1&&B())));return(0,e.jsx)(t.ViewVisibilityContext.Consumer,null,(({isInView:o,isInCurrentView:n})=>{const l=!o||n;return(0,e.jsx)(t.PageVisibilityContext.Consumer,null,(t=>{var o,n,r,i;return(0,e.jsx)("div",{className:"widget-search jimu-widget"},(0,e.jsx)("div",{className:`d-flex w-100 align-items-center search-con-${a.arrangementStyle}`,css:kt,ref:m},(0,e.jsx)("div",null,Z(E,f,null==a?void 0:a.allowSearchSourceSelection)&&(0,e.jsx)(Se,{showLoading:E,className:"h-100",config:a,dsStatus:L,datasourceConfig:f,id:u,useDataSources:c,onDatasourceConfigChange:A,synchronizeSettings:null===(n=null===(o=null==a?void 0:a.dataSourceConfigWithMapCentric)||void 0===o?void 0:o[null==D?void 0:D.id])||void 0===n?void 0:n.synchronizeSettings})),(0,e.jsx)(ut,{showSearchSetting:Z(E,f,null==a?void 0:a.allowSearchSourceSelection),id:u,className:"flex-grow-1 h-100",reference:m,config:a,isShowSearchInput:B(),onShowSearchInputChange:_,isInCurrentView:l,isWidgetInCurrentPage:t,handleServiceListChange:G,searchResult:j,serviceList:I,clearSearchResult:H,selectionList:R,jimuMapView:D,datasourceConfig:f,loadingServiceList:E}),(0,e.jsx)(vt,{id:u,config:a,serviceList:I,dsStatus:L,jimuMapView:D,handleSearchResultChange:q,handleSelectionListChange:Q,handleDsStatusChange:X,synchronizeSettings:null===(i=null===(r=null==a?void 0:a.dataSourceConfigWithMapCentric)||void 0===r?void 0:r[null==D?void 0:D.id])||void 0===i?void 0:i.synchronizeSettings}),(null==a?void 0:a.sourceType)===d.MapCentric&&(0,e.jsx)(w.JimuMapViewComponent,{useMapWidgetId:null==v?void 0:v[0],onActiveViewChange:Y})))}))}))};Et.versionManager=Lt;const Ot=Et;function Ft(e){s.p=e}})(),a})())}}}));